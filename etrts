[1mdiff --git a/README.md b/README.md[m
[1mindex 722d60f..3efce3f 100644[m
[1m--- a/README.md[m
[1m+++ b/README.md[m
[36m@@ -110,15 +110,13 @@[m [m$ nextnextping[m
   - `python mybuild.py` ã‚’å®Ÿè¡Œã™ã‚‹ã€‚â€» pyinstaller ãŒå‹•ãã¾ã™[m
   - `pytest -s` ã‚’å®Ÿè¡Œã™ã‚‹[m
       - ã™ã¹ã¦ã® test ã«ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹[m
[31m-      - å†…éƒ¨ã§ Mock ã® ssh ã‚„ scp ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™[m
[31m-      - Layer4 port 2200 ã‚’å æœ‰ã—ã¾ã™[m
[32m+[m[32m      - å†…éƒ¨ã§ Mock ã® ssh ã‚„ scp ã€telnetã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™[m
   - `wsl` ã‚’èµ·å‹•ã™ã‚‹[m
       - `wsl` ã®ä¸­ã§ `pytest -s` ã‚’å®Ÿè¡Œã™ã‚‹[m
       - ã™ã¹ã¦ã® test ã«ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹[m
[31m-      - `wsl` ã®ä¸­ã§ `python3 test/test_nextnextping.py` ã‚’èµ·å‹•ã—ã£ã±ãªã«ã™ã‚‹[m
[32m+[m[32m      - `wsl` ã®ä¸­ã§ `python3 test/ttlbackground.py` ã‚’èµ·å‹•ã—ã£ã±ãªã«ã™ã‚‹[m
           - `wsl` ã®ä¸­ã§å®Ÿè¡Œã—ãªã„ã¨å¾Œç¶šã® `site.yml` ãŒæ­£å¸¸å‹•ä½œã—ã¾ã›ã‚“[m
[31m-          - Mock ã® ssh ã‚„ scp ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™[m
[31m-          - Layer4 port 2200 ã‚’å æœ‰ã—ã¾ã™[m
[32m+[m[32m          - Mock ã® ssh ã‚„ scp  ã€telnetã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™[m
   - ã‚‚ã†ä¸€æšã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’èµ·å‹•ã—ã¦ `wsl` ã‚’èµ·å‹•ã™ã‚‹[m
       - `cd ../bin` ã«ç§»å‹•ã™ã‚‹[m
       - `nextnextping` ã‚’å®Ÿè¡Œã—ã¦å‹•ä½œã«å•é¡Œãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹[m
[36m@@ -127,6 +125,7 @@[m [m$ nextnextping[m
       - `cd ./forwsl2` ã«ç§»å‹•ã™ã‚‹[m
       - `wsl` ã®ä¸­ã§ `ansible-playbook site.yml` ã‚’å®Ÿè¡Œã™ã‚‹[m
       - ã™ã¹ã¦ã® test ã«ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹[m
[32m+[m[32m  - ã“ã“ã‹ã‚‰ãƒªãƒªãƒ¼ã‚¹ã®ãƒ•ã‚§ãƒ¼ã‚ºã«ãªã‚Šã¾ã™[m
       - `wsl` ã®ä¸­ã§ `ansible-playbook site_pypi.yml` ã‚’å®Ÿè¡Œã—ã¦ PyPi ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ [m
       - `./dest` é…ä¸‹ã«å…¬é–‹ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ãŒã§ãã‚ãŒã‚‹[m
       - 2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ `wsl` ã‚’ `exit` ã§æŠœã‘ã‚‹[m
[1mdiff --git a/docs/command.md b/docs/command.md[m
[1mindex f319e65..692323b 100644[m
[1m--- a/docs/command.md[m
[1m+++ b/docs/command.md[m
[36m@@ -50,16 +50,16 @@[m [mCommand index[m
   <!-- - [sendlnmulticast](https://teratermproject.github.io/manual/5/en/macro/command/sendlnmulticast.html) -->[m
   - [sendtext](https://teratermproject.github.io/manual/5/en/macro/command/sendtext.html)[m
   <!-- - [sendmulticast](https://teratermproject.github.io/manual/5/en/macro/command/sendmulticast.html) -->[m
[31m-  <!-- - [setbaud](https://teratermproject.github.io/manual/5/en/macro/command/setbaud.html) -->[m
[32m+[m[32m  - [setbaud](https://teratermproject.github.io/manual/5/en/macro/command/setbaud.html)[m
   <!-- - [setdebug](https://teratermproject.github.io/manual/5/en/macro/command/setdebug.html) -->[m
   - [setdtr](https://teratermproject.github.io/manual/5/en/macro/command/setdtr.html)[m
   <!-- - [setecho](https://teratermproject.github.io/manual/5/en/macro/command/setecho.html) -->[m
[31m-  <!-- - [setflowctrl](https://teratermproject.github.io/manual/5/en/macro/command/setflowctrl.html) -->[m
[32m+[m[32m  - [setflowctrl](https://teratermproject.github.io/manual/5/en/macro/command/setflowctrl.html)[m
   <!-- - [setmulticastname](https://teratermproject.github.io/manual/5/en/macro/command/setmulticastname.html) -->[m
[31m-  <!-- - [setrts](https://teratermproject.github.io/manual/5/en/macro/command/setrts.html) -->[m
[32m+[m[32m  - [setrts](https://teratermproject.github.io/manual/5/en/macro/command/setrts.html)[m
   <!-- - [setserialdelaychar](https://teratermproject.github.io/manual/5/en/macro/command/setserialdelaychar.html) -->[m
   <!-- - [setserialdelayline](https://teratermproject.github.io/manual/5/en/macro/command/setserialdelayline.html) -->[m
[31m-  <!-- - [setspeed](https://teratermproject.github.io/manual/5/en/macro/command/setspeed.html) -->[m
[32m+[m[32m  - [setspeed](https://teratermproject.github.io/manual/5/en/macro/command/setspeed.html)[m
   <!-- - [setsync](https://teratermproject.github.io/manual/5/en/macro/command/setsync.html) -->[m
   - [settitle](https://teratermproject.github.io/manual/5/en/macro/command/settitle.html)[m
   <!-- - [showtt](https://teratermproject.github.io/manual/5/en/macro/command/showtt.html) -->[m
[36m@@ -237,13 +237,28 @@[m [mconnect <command line parameters>[m
 - SSH connection. Telnet connection, SSH1 connection, and COM port connection are not possible.[m
   - SSHæ¥ç¶šã—ã¾ã™ã€‚telnetæ¥ç¶šã‚„SSH1æ¥ç¶šã€COMãƒãƒ¼ãƒˆæ¥ç¶šã¯ã§ãã¾ã›ã‚“ã€‚[m
 [m
[32m+[m
[32m+[m[32m### telnet connection[m
[32m+[m
[32m+[m[32m- The following example shows a telnet connection.[m
[32m+[m[32m- If the `nossh` option is not specified, an SSH2 connection will be used.[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32mconnect 'myserver:22 /noss /T=1'  ; telnet and telnet negotiation[m
[32m+[m[32mconnect 'myserver:22 /noss /T=0'  ; telnet and telnet NOT negotiation[m
[32m+[m[32mconnect 'myserver:22 /noss'  ; telnet and telnet NOT negotiation[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### SSH1 connection[m
[32m+[m
 ### SSH2 connection[m
[31m-- Connect using python paramiko.[m
[31m-    - pythonã®paramikoã‚’ä½¿ã£ã¦æ¥ç¶šã—ã¾ã™ã€‚[m
[32m+[m
[32m+[m[32m- SSH2 connect using python paramiko.[m
 - `/ask4passwd` cannot be used.[m
     - `/ask4passwd` ã¯ä½¿ãˆã¾ã›ã‚“ã€‚[m
 - SSH1 cannot be used due to security issues.[m
 - telnet cannot be used due to security issues.[m
[32m+[m[32m- If you specify `/1`, it is not supported due to Paramiko security reasons.[m
 - If you omit `/2`, you will connect using SSH2.[m
 - To make an ssh connection, you need a server to connect to.[m
   - sshæ¥ç¶šã‚’ã™ã‚‹ã«ã¯æ¥ç¶šå…ˆã®ã‚µãƒ¼ãƒãŒå¿…è¦ã§ã™ã€‚[m
[36m@@ -255,6 +270,26 @@[m [mconnect 'myserver /ssh    /user=username /passwd=password /keyfile=private-key-f[m
 connect 'myserver /ssh /2 /user=username /passwd=password /keyfile=private-key-file'[m
 ```[m
 [m
[32m+[m[32m### Serial connection[m
[32m+[m
[32m+[m[32m- Serial connect using python paramiko.[m
[32m+[m[32m    - pythonã® pyserial ã‚’ä½¿ã£ã¦æ¥ç¶šã—ã¾ã™ã€‚[m
[32m+[m[32m- Because of the pyserial specification, the parameters passed are different from those of teraterm macros.[m
[32m+[m[32m    - pyserial ã®ä»•æ§˜ã«ã‚ˆã‚Šã€æ¸¡ã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ teraterm ãƒã‚¯ãƒ­ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚[m
[32m+[m[32m    - Linuxã®å ´åˆã¯ `/dev/pts/*` ã‚„ `/dev/ttyS*` ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚[m
[32m+[m[32m    - Windowsã®å ´åˆã¯ `COM0` ã¾ãŸã¯ `0` ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚[m
[32m+[m[32m    - Windowsã®å ´åˆã§å…ˆé ­æ–‡å­—ãŒæ•°å­—ã®å ´åˆ `COM0` ã®ã‚ˆã†ã«å†…éƒ¨ã§ `COM` ã‚’ä»˜ä¸ã—ã¾ã™ã€‚[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32mFor Linux:[m
[32m+[m[32mconnect '/C=/dev/pts/8'[m
[32m+[m
[32m+[m[32mFor Windows:[m
[32m+[m[32mconnect '/C=COM4'[m
[32m+[m[32mor[m
[32m+[m[32mconnect '/C=4'[m
[32m+[m[32m```[m
[32m+[m
 ### command line connection[m
 - '/cmd' goes into the command line.[m
     - '/cmd'ã¯command lineã«å…¥ã‚Šã¾ã™ã€‚[m
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/docs/command.md b/forwsl2/collections/ansible_collections/tand0/ttl/docs/command.md[m
[1mindex f319e65..692323b 100644[m
[1m--- a/forwsl2/collections/ansible_collections/tand0/ttl/docs/command.md[m
[1m+++ b/forwsl2/collections/ansible_collections/tand0/ttl/docs/command.md[m
[36m@@ -50,16 +50,16 @@[m [mCommand index[m
   <!-- - [sendlnmulticast](https://teratermproject.github.io/manual/5/en/macro/command/sendlnmulticast.html) -->[m
   - [sendtext](https://teratermproject.github.io/manual/5/en/macro/command/sendtext.html)[m
   <!-- - [sendmulticast](https://teratermproject.github.io/manual/5/en/macro/command/sendmulticast.html) -->[m
[31m-  <!-- - [setbaud](https://teratermproject.github.io/manual/5/en/macro/command/setbaud.html) -->[m
[32m+[m[32m  - [setbaud](https://teratermproject.github.io/manual/5/en/macro/command/setbaud.html)[m
   <!-- - [setdebug](https://teratermproject.github.io/manual/5/en/macro/command/setdebug.html) -->[m
   - [setdtr](https://teratermproject.github.io/manual/5/en/macro/command/setdtr.html)[m
   <!-- - [setecho](https://teratermproject.github.io/manual/5/en/macro/command/setecho.html) -->[m
[31m-  <!-- - [setflowctrl](https://teratermproject.github.io/manual/5/en/macro/command/setflowctrl.html) -->[m
[32m+[m[32m  - [setflowctrl](https://teratermproject.github.io/manual/5/en/macro/command/setflowctrl.html)[m
   <!-- - [setmulticastname](https://teratermproject.github.io/manual/5/en/macro/command/setmulticastname.html) -->[m
[31m-  <!-- - [setrts](https://teratermproject.github.io/manual/5/en/macro/command/setrts.html) -->[m
[32m+[m[32m  - [setrts](https://teratermproject.github.io/manual/5/en/macro/command/setrts.html)[m
   <!-- - [setserialdelaychar](https://teratermproject.github.io/manual/5/en/macro/command/setserialdelaychar.html) -->[m
   <!-- - [setserialdelayline](https://teratermproject.github.io/manual/5/en/macro/command/setserialdelayline.html) -->[m
[31m-  <!-- - [setspeed](https://teratermproject.github.io/manual/5/en/macro/command/setspeed.html) -->[m
[32m+[m[32m  - [setspeed](https://teratermproject.github.io/manual/5/en/macro/command/setspeed.html)[m
   <!-- - [setsync](https://teratermproject.github.io/manual/5/en/macro/command/setsync.html) -->[m
   - [settitle](https://teratermproject.github.io/manual/5/en/macro/command/settitle.html)[m
   <!-- - [showtt](https://teratermproject.github.io/manual/5/en/macro/command/showtt.html) -->[m
[36m@@ -237,13 +237,28 @@[m [mconnect <command line parameters>[m
 - SSH connection. Telnet connection, SSH1 connection, and COM port connection are not possible.[m
   - SSHæ¥ç¶šã—ã¾ã™ã€‚telnetæ¥ç¶šã‚„SSH1æ¥ç¶šã€COMãƒãƒ¼ãƒˆæ¥ç¶šã¯ã§ãã¾ã›ã‚“ã€‚[m
 [m
[32m+[m
[32m+[m[32m### telnet connection[m
[32m+[m
[32m+[m[32m- The following example shows a telnet connection.[m
[32m+[m[32m- If the `nossh` option is not specified, an SSH2 connection will be used.[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32mconnect 'myserver:22 /noss /T=1'  ; telnet and telnet negotiation[m
[32m+[m[32mconnect 'myserver:22 /noss /T=0'  ; telnet and telnet NOT negotiation[m
[32m+[m[32mconnect 'myserver:22 /noss'  ; telnet and telnet NOT negotiation[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### SSH1 connection[m
[32m+[m
 ### SSH2 connection[m
[31m-- Connect using python paramiko.[m
[31m-    - pythonã®paramikoã‚’ä½¿ã£ã¦æ¥ç¶šã—ã¾ã™ã€‚[m
[32m+[m
[32m+[m[32m- SSH2 connect using python paramiko.[m
 - `/ask4passwd` cannot be used.[m
     - `/ask4passwd` ã¯ä½¿ãˆã¾ã›ã‚“ã€‚[m
 - SSH1 cannot be used due to security issues.[m
 - telnet cannot be used due to security issues.[m
[32m+[m[32m- If you specify `/1`, it is not supported due to Paramiko security reasons.[m
 - If you omit `/2`, you will connect using SSH2.[m
 - To make an ssh connection, you need a server to connect to.[m
   - sshæ¥ç¶šã‚’ã™ã‚‹ã«ã¯æ¥ç¶šå…ˆã®ã‚µãƒ¼ãƒãŒå¿…è¦ã§ã™ã€‚[m
[36m@@ -255,6 +270,26 @@[m [mconnect 'myserver /ssh    /user=username /passwd=password /keyfile=private-key-f[m
 connect 'myserver /ssh /2 /user=username /passwd=password /keyfile=private-key-file'[m
 ```[m
 [m
[32m+[m[32m### Serial connection[m
[32m+[m
[32m+[m[32m- Serial connect using python paramiko.[m
[32m+[m[32m    - pythonã® pyserial ã‚’ä½¿ã£ã¦æ¥ç¶šã—ã¾ã™ã€‚[m
[32m+[m[32m- Because of the pyserial specification, the parameters passed are different from those of teraterm macros.[m
[32m+[m[32m    - pyserial ã®ä»•æ§˜ã«ã‚ˆã‚Šã€æ¸¡ã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ teraterm ãƒã‚¯ãƒ­ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚[m
[32m+[m[32m    - Linuxã®å ´åˆã¯ `/dev/pts/*` ã‚„ `/dev/ttyS*` ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚[m
[32m+[m[32m    - Windowsã®å ´åˆã¯ `COM0` ã¾ãŸã¯ `0` ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚[m
[32m+[m[32m    - Windowsã®å ´åˆã§å…ˆé ­æ–‡å­—ãŒæ•°å­—ã®å ´åˆ `COM0` ã®ã‚ˆã†ã«å†…éƒ¨ã§ `COM` ã‚’ä»˜ä¸ã—ã¾ã™ã€‚[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32mFor Linux:[m
[32m+[m[32mconnect '/C=/dev/pts/8'[m
[32m+[m
[32m+[m[32mFor Windows:[m
[32m+[m[32mconnect '/C=COM4'[m
[32m+[m[32mor[m
[32m+[m[32mconnect '/C=4'[m
[32m+[m[32m```[m
[32m+[m
 ### command line connection[m
 - '/cmd' goes into the command line.[m
     - '/cmd'ã¯command lineã«å…¥ã‚Šã¾ã™ã€‚[m
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/galaxy.yml b/forwsl2/collections/ansible_collections/tand0/ttl/galaxy.yml[m
[1mindex e615f68..2f25739 100644[m
[1m--- a/forwsl2/collections/ansible_collections/tand0/ttl/galaxy.yml[m
[1m+++ b/forwsl2/collections/ansible_collections/tand0/ttl/galaxy.yml[m
[36m@@ -9,7 +9,7 @@[m [mnamespace: tand0[m
 name: ttl[m
 [m
 # The version of the collection. Must be compatible with semantic versioning[m
[31m-version: "1.26.1"[m
[32m+[m[32mversion: "1.27.1"[m
 [m
 # The path to the Markdown (.md) readme file. This path is relative to the root of the collection[m
 readme: README.md[m
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/ttl_parser_worker.py b/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/ttl_parser_worker.py[m
[1mindex 77fa95f..f23a3c4 100644[m
[1m--- a/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/ttl_parser_worker.py[m
[1m+++ b/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/ttl_parser_worker.py[m
[36m@@ -14,6 +14,8 @@[m [mimport base64[m
 import platform[m
 import getpass[m
 from abc import ABC, abstractmethod[m
[32m+[m[32mimport serial[m
[32m+[m[32mimport typing[m
 [m
 IMP_ERR = None[m
 try:[m
[36m@@ -61,12 +63,12 @@[m [mclass MyFindfirst:[m
         pass[m
 [m
     def readline(self) -> str:[m
[31m-        ans = b""[m
[32m+[m[32m        ans = b''[m
         if 0 < len(self.my_list):[m
             ans = self.my_list[0][m
             self.my_list = self.my_list[1:][m
             # print(f"MyFindfirst {str(self.my_list)}")[m
[31m-            ans = ans.encode("utf-8")[m
[32m+[m[32m            ans = ans.encode('utf-8')[m
         else:[m
             raise OSError("readline exception")[m
         return ans[m
[36m@@ -90,7 +92,7 @@[m [mclass MyAbstractShell(ABC):[m
         pass[m
 [m
     @abstractmethod[m
[31m-    def recv(self, length: int) -> str:[m
[32m+[m[32m    def recv(self, length: int):[m
         pass[m
 [m
     @abstractmethod[m
[36m@@ -101,13 +103,17 @@[m [mclass MyAbstractShell(ABC):[m
     def isActive(self) -> int:[m
         pass[m
 [m
[32m+[m[32m    @abstractmethod[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
 [m
 class MyShell(MyAbstractShell):[m
     def __init__(self, command=None):[m
         if command is None:[m
             command = ['cmd'][m
         # print("MyShell __init__ start")[m
[31m-        self.data = ""[m
[32m+[m[32m        self.data = ''[m
         self.lock = threading.Lock()[m
         self.active = 1[m
         self.process = subprocess.Popen([m
[36m@@ -118,16 +124,21 @@[m [mclass MyShell(MyAbstractShell):[m
             text=True,[m
             shell=True,[m
         )[m
[31m-        thread = MyThread(self, "stdout", self.process.stdout)[m
[32m+[m[32m        thread = MyShellThread(self, "stdout", self.process.stdout)[m
         thread.start()[m
         # print("MyShell __init__ end")[m
 [m
[32m+[m[32m    def get_lock(self) -> threading.Lock:[m
[32m+[m[32m        return self.lock[m
[32m+[m
[32m+[m[32m    @typing.override[m
     def send_ready(self) -> bool:[m
         # print("send_ready")[m
         if self.active == 0:[m
             return 0[m
         return self.process.stdin.writable()[m
 [m
[32m+[m[32m    @typing.override[m
     def send(self, message):[m
         # print(f"send /{message.strip()}/")[m
         if self.active == 0:[m
[36m@@ -135,29 +146,31 @@[m [mclass MyShell(MyAbstractShell):[m
         self.process.stdin.write(message)[m
         self.process.stdin.flush()[m
 [m
[32m+[m[32m    @typing.override[m
     def recv_ready(self) -> bool:[m
[31m-        self.process.stdout.flush()[m
[31m-        # self.process.stderr.flush()[m
[31m-        ans = False[m
         if 0 < len(self.data):[m
[31m-            ans = True[m
[31m-        # print(f"recv_ready {len(self.data)} / {ans}")[m
[31m-        return ans[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
[32m+[m[32m        if self.active == 0:[m
[32m+[m[32m            return False[m
[32m+[m[32m        self.process.stdout.flush()[m
[32m+[m[32m        return False[m
 [m
[31m-    def recv(self, length: int) -> str:[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
         # print(f"recv d=/{self.data.strip()}/")[m
         if len(self.data) <= 0:[m
[31m-            return[m
[31m-        local_data = ""[m
[31m-        with self.lock:[m
[32m+[m[32m            return b''[m
[32m+[m[32m        local_data = ''[m
[32m+[m[32m        with self.get_lock():[m
             local_data = self.data[0][m
             self.data = self.data[1:][m
[31m-        return local_data.encode("utf-8")[m
[32m+[m[32m        return local_data.encode('utf-8')[m
 [m
[32m+[m[32m    @typing.override[m
     def close(self):[m
         # print("client close")[m
         self.active = 0[m
[31m-        self.data = ""[m
[32m+[m[32m        self.data = ''[m
         local_process = self.process[m
         self.local_process = None[m
         if local_process is not None:[m
[36m@@ -167,61 +180,75 @@[m [mclass MyShell(MyAbstractShell):[m
                 # anything delete[m
                 pass[m
 [m
[32m+[m[32m    @typing.override[m
     def isActive(self) -> int:[m
         return self.active[m
 [m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
 [m
 class MyPexpect(MyAbstractShell):[m
     def __init__(self):[m
         shell_name = os.getenv("SHELL", "/bin/sh")[m
         self.child = pexpect.spawn(shell_name, timeout=0, encoding='utf-8')[m
[31m-        self.result = None[m
[32m+[m[32m        self.result = ''[m
 [m
[32m+[m[32m    @typing.override[m
     def send_ready(self) -> bool:[m
         return True[m
 [m
[32m+[m[32m    @typing.override[m
     def send(self, message):[m
         child = self.child[m
         if child is None:[m
             return[m
         child.send(message)[m
 [m
[32m+[m[32m    @typing.override[m
     def recv_ready(self) -> bool:[m
[32m+[m[32m        if self.result != "":[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
         child = self.child[m
         if child is None:[m
             return False[m
[31m-        if self.result is not None:[m
[31m-            return True[m
[31m-        index = child.expect([r".", pexpect.EOF, pexpect.TIMEOUT])[m
[31m-        if index == 0:[m
[32m+[m[32m        self.result = ""[m
[32m+[m[32m        target = ""[m
[32m+[m[32m        while True:[m
[32m+[m[32m            index = child.expect([r".", pexpect.EOF, pexpect.TIMEOUT])[m
[32m+[m[32m            if index == 2:[m
[32m+[m[32m                break  # timeout[m
[32m+[m[32m            elif index == 1:[m
[32m+[m[32m                self.close()[m
[32m+[m[32m                break  # EOF[m
[32m+[m[32m            #[m
             # child.after ã§ãƒãƒƒãƒã—ãŸæ–‡å­—åˆ—å…¨ä½“ã‚’å–å¾—[m
[31m-            self.result = child.before + child.after[m
[31m-            if 0 < len(self.result):[m
[31m-                return True[m
[31m-            else:[m
[31m-                return False[m
[31m-        elif index == 1:  # EOF[m
[31m-            self.close()[m
[31m-            return False[m
[31m-        return False  # Timeout[m
[31m-[m
[31m-    def recv(self, length: int) -> str:[m
[31m-        if self.child is None:[m
[31m-            return None[m
[31m-        work = ''[m
[31m-        if self.result is not None:[m
[31m-            if len(self.result) <= length:[m
[31m-                work = self.result[m
[31m-                self.result = None[m
[31m-            else:[m
[31m-                work = self.result[:self.result][m
[31m-                self.result = self.result[self.result + 1:][m
[31m-        elif self.recv_ready():[m
[31m-            work = self.recv(length)[m
[31m-        if self.child is None:[m
[31m-            return None[m
[31m-        return work.encode("utf-8")[m
[32m+[m[32m            target = child.before + child.after[m
[32m+[m[32m            if len(target) <= 0:[m
[32m+[m[32m                break  # åé›†ã§ããªã‹ã£ãŸ[m
[32m+[m[32m            #[m
[32m+[m[32m            # æ–‡å­—åˆ—ã‚’åŠ ç®—[m
[32m+[m[32m            self.result = self.result + target[m
[32m+[m[32m        #[m
[32m+[m[32m        return 0 < len(target)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
[32m+[m[32m        if self.result == '' and not self.recv_ready():[m
[32m+[m[32m            return ''[m
[32m+[m[32m        if self.result == '':[m
[32m+[m[32m            return ''[m
[32m+[m[32m        if len(self.result) <= length:[m
[32m+[m[32m            work = self.result[m
[32m+[m[32m            self.result = ''[m
[32m+[m[32m        else:[m
[32m+[m[32m            work = self.result[:length][m
[32m+[m[32m            self.result = self.result[length + 1:][m
[32m+[m[32m        work = work.replace("\r", "")[m
[32m+[m[32m        return work.encode('utf-8')[m
 [m
[32m+[m[32m    @typing.override[m
     def close(self):[m
         child = self.child.close()[m
         self.child = None[m
[36m@@ -230,30 +257,448 @@[m [mclass MyPexpect(MyAbstractShell):[m
         except Exception:[m
             pass[m
 [m
[32m+[m[32m    @typing.override[m
     def isActive(self) -> int:[m
         if self.child is not None:[m
             return 1[m
         return 0[m
 [m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
 [m
[31m-class MyThread(threading.Thread):[m
[32m+[m
[32m+[m[32mclass MySerial(MyAbstractShell):[m
[32m+[m[32m    def __init__(self, command: str, rate: int, flowctrl=3, flowctrl_dtr=False, flowctrl_rts=False):[m
[32m+[m[32m        self.readSer = None[m
[32m+[m[32m        if platform.system().lower() != "linux":[m
[32m+[m[32m            # for Windows[m
[32m+[m[32m            if 0 < len(command) and "0" <= command[0] and command[0] <= "9":[m
[32m+[m[32m                # 1æ–‡å­—ä»¥ä¸Šã§ 0-9ã®é–“ãªã‚‰COMã‚’è¿½åŠ ã™ã‚‹[m
[32m+[m[32m                command = "COM" + command[m
[32m+[m[32m        if flowctrl is None:[m
[32m+[m[32m            self.readSer = serial.Serial(command, rate, timeout=0.1)[m
[32m+[m[32m        else:[m
[32m+[m[32m            xonxoff = flowctrl == 1  # default False[m
[32m+[m[32m            rtscts = flowctrl == 2 or (flowctrl == 3 and flowctrl_rts)  # default False[m
[32m+[m[32m            dsrdtr = flowctrl == 4 or (flowctrl == 3 and flowctrl_dtr)  # default False[m
[32m+[m[32m            self.readSer = serial.Serial(command, rate, timeout=0.1, xonxoff=xonxoff, rtscts=rtscts, dsrdtr=dsrdtr)[m
[32m+[m[32m        self.active = True[m
[32m+[m[32m        self.data = b''[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send_ready(self) -> bool:[m
[32m+[m[32m        if not self.active:[m
[32m+[m[32m            return False[m
[32m+[m[32m        return self.readSer.writable()[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send(self, message):[m
[32m+[m[32m        if not self.active:[m
[32m+[m[32m            return[m
[32m+[m[32m        self.readSer.write(message.encode('utf-8'))[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv_ready(self) -> bool:[m
[32m+[m[32m        if 0 < len(self.data):[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
[32m+[m[32m        if not self.active:[m
[32m+[m[32m            return False[m
[32m+[m[32m        self.readSer.flush()[m
[32m+[m[32m        if not self.readSer.readable():[m
[32m+[m[32m            return False[m
[32m+[m[32m        try:[m
[32m+[m[32m            self.data = self.readSer.read(size=256)[m
[32m+[m[32m        except Exception:[m
[32m+[m[32m            self.close()  # ã‚¨ãƒ©ãƒ¼ ãŒã§ãŸã®ã§å¼·åˆ¶çµ‚äº†[m
[32m+[m[32m            return False[m
[32m+[m[32m        return 0 < len(self.data)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
[32m+[m[32m        # if not self.active:[m
[32m+[m[32m        #    return None  # EOFã®ã¨ãã¯ã¾ã èª­ã¿è¾¼ã‚ã‚‹[m
[32m+[m[32m        self.recv_ready()[m
[32m+[m[32m        if len(self.data) < length:[m
[32m+[m[32m            result = self.data[m
[32m+[m[32m            self.data = b''[m
[32m+[m[32m            return result[m
[32m+[m[32m        result = self.data[0:length][m
[32m+[m[32m        self.data = self.data[length:][m
[32m+[m[32m        return result[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def close(self):[m
[32m+[m[32m        self.active = False[m
[32m+[m[32m        try:[m
[32m+[m[32m            localReadSer = self.readSer[m
[32m+[m[32m            self.readSer = None[m
[32m+[m[32m            if localReadSer is not None:[m
[32m+[m[32m                localReadSer.close()[m
[32m+[m[32m        except Exception:[m
[32m+[m[32m            pass[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def isActive(self) -> int:[m
[32m+[m[32m        if self.active:[m
[32m+[m[32m            return 1[m
[32m+[m[32m        return 0[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
[32m+[m[32m    def exit_status_ready(self):[m
[32m+[m[32m        return not self.active[m
[32m+[m
[32m+[m
[32m+[m[32mclass MyTelnetT0(MyAbstractShell):[m
[32m+[m
[32m+[m[32m    def __init__(self, client: socket.socket):[m
[32m+[m[32m        self.client = client[m
[32m+[m[32m        self.data = b''[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send_ready(self) -> bool:[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return False[m
[32m+[m[32m        return True[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send(self, message: str):[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return[m
[32m+[m[32m        self.send_binary(message.encode('utf-8'))[m
[32m+[m
[32m+[m[32m    def send_binary(self, message):[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return[m
[32m+[m[32m        self.client.sendall(message)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv_ready(self) -> bool:[m
[32m+[m[32m        if 0 < len(self.data):[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return False[m
[32m+[m[32m        try:[m
[32m+[m[32m            self.client.settimeout(0.1)[m
[32m+[m[32m            recv_data = self.client.recv(1024)[m
[32m+[m[32m            if recv_data is None or recv_data == b'':[m
[32m+[m[32m                self.close()[m
[32m+[m[32m                return False[m
[32m+[m[32m            self.data = self.change_stream(recv_data)[m
[32m+[m[32m        except ConnectionResetError:[m
[32m+[m[32m            self.close()[m
[32m+[m[32m            return False[m
[32m+[m[32m        except socket.timeout:[m
[32m+[m[32m            return False[m
[32m+[m[32m        return 0 < len(self.data)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def change_stream(self, recv_data):[m
[32m+[m[32m        return recv_data[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
[32m+[m[32m        if 0 == len(self.data):  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒãªã„[m
[32m+[m[32m            if self.client is None:  # closeã§ã‚ã‚‹[m
[32m+[m[32m                return None[m
[32m+[m[32m        self.recv_ready()[m
[32m+[m[32m        if len(self.data) < length:[m
[32m+[m[32m            result = self.data[m
[32m+[m[32m            self.data = b''[m
[32m+[m[32m            return result[m
[32m+[m[32m        result = self.data[0:length][m
[32m+[m[32m        self.data = self.data[length:][m
[32m+[m[32m        return result[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def close(self):[m
[32m+[m[32m        local_client = self.client[m
[32m+[m[32m        self.client = None[m
[32m+[m[32m        if local_client is not None:[m
[32m+[m[32m            try:[m
[32m+[m[32m                local_client.close()[m
[32m+[m[32m            except Exception:[m
[32m+[m[32m                pass[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def isActive(self) -> int:[m
[32m+[m[32m        if self.client is not None:[m
[32m+[m[32m            return 1[m
[32m+[m[32m        return 0[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
[32m+[m[32m    def exit_status_ready(self):[m
[32m+[m[32m        return self.client is None[m
[32m+[m
[32m+[m
[32m+[m[32mclass MyTelnetT1(MyTelnetT0):[m
[32m+[m
[32m+[m[32m    _CR = b'\r'[m
[32m+[m[32m    _LF = b'\n'[m
[32m+[m
[32m+[m[32m    _NULL = b'\x00'                 # 0	Binary Transmission	[RFC856][m
[32m+[m[32m    _ECHO = b'\x01'                 # 1	Echo	[RFC857][m
[32m+[m[32m    _Reconnection = b'\x02'         # 2	Reconnection	[NIC 15391 of 1973][m
[32m+[m[32m    _Suppress_Go_Ahead = b'\x03'    # 3	Suppress Go Ahead	[RFC858][m
[32m+[m[32m    _AMSize_Negotiation = b'\x04'   # 4	Approx Message Size Negotiation	[NIC 15393 of 1973][m
[32m+[m[32m    _Status = b'\x05'               # 5	Status	[RFC859][m
[32m+[m[32m    _Timing_Mark = b'\x06'          # 6	Timing Mark	[RFC860][m
[32m+[m[32m    _RCTrans_and_Echo = b'\x07'     # 7	Remote Controlled Trans and Echo	[RFC726][m
[32m+[m[32m    _Output_Line_Width = b'\x08'    # 8	Output Line Width	[NIC 20196 of August 1978][m
[32m+[m[32m    _Output_Page_Size = b'\x09'     # 9	Output Page Size	[NIC 20197 of August 1978][m
[32m+[m[32m    _OCRDisposition = b'\x0a'       # 10	Output Carriage-Return Disposition	[RFC652][m
[32m+[m[32m    _OHTStops = b'\x0b'             # 11	Output Horizontal Tab Stops	[RFC653][m
[32m+[m[32m    _OHTDisposition = b'\x0c'       # 12	Output Horizontal Tab Disposition	[RFC654][m
[32m+[m[32m    _OFDisposition = b'\x0d'        # 13	Output Formfeed Disposition	[RFC655][m
[32m+[m[32m    _OVTabstops = b'\x0e'           # 14	Output Vertical Tabstops	[RFC656][m
[32m+[m[32m    _OVTab_Disposition = b'\x0f'    # 15	Output Vertical Tab Disposition	[RFC657][m
[32m+[m[32m    _OLDisposition = b'\x10'        # 16	Output Linefeed Disposition	[RFC658][m
[32m+[m[32m    _Extended_ASCII = b'\x11'       # 17	Extended ASCII	[RFC698][m
[32m+[m[32m    _Logout = b'\x12'               # 18	Logout	[RFC727][m
[32m+[m[32m    _Byte_Macro = b'\x13'           # 19	Byte Macro	[RFC735][m
[32m+[m[32m    _Data_Entry_Terminal = b'\x14'  # 20	Data Entry Terminal	[RFC1043][RFC732][m
[32m+[m[32m    _SUPDUP = b'\x15'               # 21	SUPDUP	[RFC736][RFC734][m
[32m+[m[32m    _SUPDUP_Output = b'\x16'        # 22	SUPDUP Output	[RFC749][m
[32m+[m[32m    _Send_Location = b'\x17'        # 23	Send Location	[RFC779][m
[32m+[m[32m    _Terminal_Type = b'\x18'        # 24	Terminal Type	[RFC1091][m
[32m+[m[32m    _End_of_Record = b'\x19'        # 25	End of Record	[RFC885][m
[32m+[m[32m    _TACACS_UI = b'\x1a'            # 26	TACACS User Identification	[RFC927][m
[32m+[m[32m    _Output_Marking = b'\x1b'       # 27	Output Marking	[RFC933][m
[32m+[m[32m    _TLocation_Number = b'\x1c'     # 28	Terminal Location Number	[RFC946][m
[32m+[m[32m    _Telnet_3270_Regime = b'\x1d'   # 29	Telnet 3270 Regime	[RFC1041][m
[32m+[m[32m    _X_3_PAD = b'\x1e'              # 30	X.3 PAD	[RFC1053][m
[32m+[m[32m    _NAWS = b'\x1f'                 # 31	Negotiate About Window Size	[RFC1073][m
[32m+[m[32m    _Terminal_Speed = b'\x20'       # 32	Terminal Speed	[RFC1079][m
[32m+[m[32m    _RFC = b'\x21'                  # 33	Remote Flow Control	[RFC1372][m
[32m+[m[32m    _Linemode = b'\x22'             # 34	Linemode	[RFC1184][m
[32m+[m[32m    _X_Display_Location = b'\x23'   # 35	X Display Location	[RFC1096][m
[32m+[m[32m    _EnvironmentOpt = b'\x24'       # 36	Environment Option	[RFC1408][m
[32m+[m[32m    _Authentication_Opt = b'\25'    # 37	Authentication Option	[RFC2941][m
[32m+[m[32m    _EncryptionOpt = b'\x26'        # 38	Encryption Option	[RFC2946][m
[32m+[m[32m    _New_EnvironmentOpt = b'\x27'   # 39	New Environment Option	[RFC1572][m
[32m+[m
[32m+[m[32m    _EOF = b'\xF6'   # 236 [RFC1184][m
[32m+[m[32m    _SE = b'\xF0'    # 240 [RFC854][RFC855][m
[32m+[m[32m    _SB = b'\xFA'    # 250 [RFC854][RFC855][m
[32m+[m[32m    _WILL = b'\xFB'  # 251 [RFC854][RFC855][m
[32m+[m[32m    _WONT = b'\xFC'  # 252 [RFC854][RFC855][m
[32m+[m[32m    _DO = b'\xFD'    # 253 [RFC854][RFC855][m
[32m+[m[32m    _DONT = b'\xFe'  # 254 [RFC854][RFC855][m
[32m+[m[32m    _IAC = b'\xff'   # 255 [RFC854][RFC855][m
[32m+[m
[32m+[m[32m    _IS = b'\x00'     # [RFC2941][m
[32m+[m[32m    _SEND = b'\x01'   # [RFC2941][m
[32m+[m[32m    _REPLY = b'\x02'  # [RFC2941][m
[32m+[m[32m    _NAME = b'\x03'   # [RFC2941][m
[32m+[m
[32m+[m[32m    def __init__(self, client: socket.socket):[m
[32m+[m[32m        super().__init__(client)[m
[32m+[m[32m        self.recv_data = b''[m
[32m+[m[32m        self.state = MyTelnetT1._NULL  # text[m
[32m+[m[32m        self.sb_se_op = b''[m
[32m+[m[32m        self.sb_se = b''[m
[32m+[m[32m        self.alread_flag = {}[m
[32m+[m[32m        self.init_sender()[m
[32m+[m
[32m+[m[32m    def init_sender(self):[m
[32m+[m[32m        """ echo """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DO + MyTelnetT1._ECHO)[m
[32m+[m
[32m+[m[32m    def is_alread_flag(self, bynary_data, do_or_will) -> bool:[m
[32m+[m[32m        key = bynary_data[m
[32m+[m[32m        if do_or_will:[m
[32m+[m[32m            key = key + b'd'[m
[32m+[m[32m        else:[m
[32m+[m[32m            key = key + b'w'[m
[32m+[m[32m        flag = False[m
[32m+[m[32m        if key in self.alread_flag:[m
[32m+[m[32m            flag = True[m
[32m+[m[32m        else:[m
[32m+[m[32m            self.alread_flag[key] = True[m
[32m+[m[32m        return flag[m
[32m+[m
[32m+[m[32m    def print(self, text):[m
[32m+[m[32m        """ for debug """[m
[32m+[m[32m        # print(text)[m
[32m+[m[32m        pass[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def change_stream(self, recv_data):[m
[32m+[m[32m        self.recv_data = self.recv_data + recv_data[m
[32m+[m[32m        mess = b''[m
[32m+[m[32m        # print(f"change_stream start {self.recv_data}")[m
[32m+[m[32m        while 0 < len(self.recv_data):[m
[32m+[m[32m            # print(f"xx {mess} / {self.recv_data} / {len(self.recv_data)} /s={self.state} / {MyTelnetT1._NULL}")[m
[32m+[m[32m            char_data = self.recv_data[0:1][m
[32m+[m[32m            self.recv_data = self.recv_data[1:][m
[32m+[m[32m            if self.state == MyTelnetT1._NULL:[m
[32m+[m[32m                if char_data == MyTelnetT1._IAC:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._CR:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._EOF:[m
[32m+[m[32m                    pass[m
[32m+[m[32m                else:[m
[32m+[m[32m                    mess = mess + char_data[m
[32m+[m[32m            elif self.state == MyTelnetT1._IAC:[m
[32m+[m[32m                if char_data == MyTelnetT1._IAC:[m
[32m+[m[32m                    # IACã‚’é€ã‚ŠãŸã„å ´åˆã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æƒ…å ±ã€‚[m
[32m+[m[32m                    # ã ãŒé€ã‚‹ã¨ UTF-8 ãŒå£Šã‚Œã‚‹ã®ã§é€ã‚‰ãªã„[m
[32m+[m[32m                    self.state = MyTelnetT1._NULL[m
[32m+[m[32m                elif char_data == MyTelnetT1._WILL:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._WONT:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._DO:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._DONT:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._SB:[m
[32m+[m[32m                    self.state = MyTelnetT1._SB + b'op'[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.state = MyTelnetT1._NULL[m
[32m+[m[32m                    mess = mess + b'IAC_Unkown'[m
[32m+[m[32m            elif self.state == MyTelnetT1._WILL:[m
[32m+[m[32m                self.print(f"IAC WILL {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, True):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                elif char_data == MyTelnetT1._ECHO:[m
[32m+[m[32m                    self.do_iac_will_echo(char_data)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_will_any(char_data)[m
[32m+[m[32m                    # ä¸Šè¨˜ä»¥å¤–ã¯ _WONT ã‚’è¿”ã™[m
[32m+[m[32m                    self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DONT + char_data)[m
[32m+[m[32m                    self.print(f"res IAC DONT {char_data[0]}")[m
[32m+[m[32m            elif self.state == MyTelnetT1._WONT:[m
[32m+[m[32m                self.print(f"IAC WONT {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, True):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_do_any(char_data)  # WONTã«å¯¾ã—ã¦ã¯WONTã—ã‹è¿”ã›ãªã„[m
[32m+[m[32m            elif self.state == MyTelnetT1._DO:[m
[32m+[m[32m                self.print(f"IAC DO {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, False):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                elif char_data == MyTelnetT1._ECHO:[m
[32m+[m[32m                    self.do_iac_do_echo(char_data)[m
[32m+[m[32m                elif char_data == MyTelnetT1._NAWS:[m
[32m+[m[32m                    self.do_iac_do_NAWS(char_data)[m
[32m+[m[32m                elif char_data == MyTelnetT1._Terminal_Type:[m
[32m+[m[32m                    self.do_iac_do_Terminal_Type(char_data)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_do_any(char_data)  # ä¸Šè¨˜ä»¥å¤–ã¯ _WONT ã‚’è¿”ã™[m
[32m+[m[32m            elif self.state == MyTelnetT1._DONT:[m
[32m+[m[32m                self.print(f"IAC DONT {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, False):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_will_any(char_data)  # WONTã«å¯¾ã—ã¦ã¯WONTã—ã‹è¿”ã›ãªã„[m
[32m+[m[32m            elif self.state == MyTelnetT1._SB + b'op':[m
[32m+[m[32m                # IAC SB option ã® optionå—ä»˜[m
[32m+[m[32m                self.sb_se = b''[m
[32m+[m[32m                self.sb_se_op = char_data[m
[32m+[m[32m                self.state = MyTelnetT1._SB[m
[32m+[m[32m                self.print(f"IAC1 SB {self.sb_se_op} / {char_data}")[m
[32m+[m[32m            elif self.state == MyTelnetT1._SB:[m
[32m+[m[32m                # IAC SB option å¾Œã®ãƒ‡ãƒ¼ã‚¿å—ä»˜[m
[32m+[m[32m                if char_data == MyTelnetT1._IAC:[m
[32m+[m[32m                    # IAC SB option å¾Œã®ãƒ‡ãƒ¼ã‚¿å†…ã« IAC ã‚’è¦‹ã¤ã‘ãŸ[m
[32m+[m[32m                    self.state = MyTelnetT1._IAC + MyTelnetT1._SB[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.sb_se = self.sb_se + char_data[m
[32m+[m[32m                self.print(f"IAC2 SB {self.sb_se_op} {self.sb_se} {self.sb_se_op}")[m
[32m+[m[32m            elif self.state == MyTelnetT1._IAC + MyTelnetT1._SB:[m
[32m+[m[32m                self.print(f"IAC SB {self.sb_se_op} IAC")[m
[32m+[m[32m                # IAC SB option å¾Œã®ãƒ‡ãƒ¼ã‚¿å†…ã« IAC ã‚’è¦‹ã¤ã‘ãŸæ¬¡ã®æ–‡å­—[m
[32m+[m[32m                if char_data == MyTelnetT1._SE:[m
[32m+[m[32m                    # IAC SB ... IAC SE ã¾ã§å®Œäº†ã—ãŸ[m
[32m+[m[32m                    self.state = MyTelnetT1._NULL[m
[32m+[m[32m                    self.do_iac_sb_se()[m
[32m+[m[32m                else:[m
[32m+[m[32m                    # IACã®å¾Œç¶šãŒ SBã§ãªã‹ã£ãŸã®ã§ ãƒ‡ãƒ¼ã‚¿å—ä»˜ç¶™ç¶š[m
[32m+[m[32m                    # self.print(f"IAC SB {self.sb_se_op} IAC {char_data[0]}")[m
[32m+[m[32m                    self.state = MyTelnetT1._SB[m
[32m+[m[32m                    self.sb_se = self.sb_se + MyTelnetT1._IAC + char_data[m
[32m+[m[32m            elif self.state == MyTelnetT1._CR:[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if char_data == MyTelnetT1._CR:[m
[32m+[m[32m                    mess = mess + MyTelnetT1._CR  # CR ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã§ã™[m
[32m+[m[32m                elif char_data == MyTelnetT1._NULL:  # teraterm ã ã¨ã“ã‚Œ[m
[32m+[m[32m                    mess = mess + MyTelnetT1._CR[m
[32m+[m[32m                elif char_data == MyTelnetT1._LF:  # windowsã®telnetã ã¨ã“ã‚Œ[m
[32m+[m[32m                    mess = mess + MyTelnetT1._CR[m
[32m+[m[32m                else:[m
[32m+[m[32m                    mess = mess + char_data  # CR ã‚’é™¤ã„ãŸã‚‚ã®ã‚’å…¥ã‚Œã¾ã™[m
[32m+[m[32m            else:[m
[32m+[m[32m                raise TypeError(f"Stateus error {int(self.state)}/{char_data[0]}")[m
[32m+[m[32m        # print(f"change_stream end /{mess}/")[m
[32m+[m[32m        return mess[m
[32m+[m
[32m+[m[32m    def do_iac_will_echo(self, char_data):[m
[32m+[m[32m        """ ã‚µãƒ¼ãƒãŒ echo ã«ãªã‚‹ã“ã¨ã¯å—ã‘å…¥ã‚Œã‚‹ """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DO + char_data)[m
[32m+[m[32m        self.print(f"res IAC DONT {char_data[0]}")[m
[32m+[m
[32m+[m[32m    def do_iac_do_echo(self, char_data):[m
[32m+[m[32m        """ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ echo ã«ã¯ãªã‚ŠãŸããªã„ """[m
[32m+[m[32m        self.do_iac_do_any(char_data)[m
[32m+[m
[32m+[m[32m    def do_iac_will_any(self, char_data):[m
[32m+[m[32m        """ åŸºæœ¬ DONT ã‚’è¿”ã™ """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DONT + char_data)[m
[32m+[m[32m        self.print(f"res IAC DONT {char_data[0]}")[m
[32m+[m
[32m+[m[32m    def do_iac_do_any(self, char_data):[m
[32m+[m[32m        """ åŸºæœ¬ WONT ã‚’è¿”ã™ """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._WONT + char_data)[m
[32m+[m[32m        self.print(f"res IAC WONT {char_data[0]}")[m
[32m+[m
[32m+[m[32m    def do_iac_do_NAWS(self, char_data):[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._WILL + char_data[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SB + char_data[m
[32m+[m[32m                         + b'\0' + b'\x50' + b'\0' + b'\x18'[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SE)[m
[32m+[m[32m        self.print("res IAC WILL NAWS IAC SB NAWS 80x24 IAC SE")[m
[32m+[m
[32m+[m[32m    def do_iac_do_Terminal_Type(self, char_data):[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._WILL + char_data[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SB + char_data[m
[32m+[m[32m                         + MyTelnetT1._IS + b'VT100'[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SE)[m
[32m+[m
[32m+[m[32m    def do_iac_sb_se(self):[m
[32m+[m[32m        self.print(f"IAC SB {self.sb_se_op} / {self.sb_se} IAC SE")[m
[32m+[m[32m        # TODO:[m
[32m+[m
[32m+[m
[32m+[m[32mclass MyShellThread(threading.Thread):[m
     def __init__(self, myShell: MyShell, name: str, stream):[m
[31m-        # print("MyThread __init__ start")[m
[32m+[m[32m        # print("MyShellThread __init__ start")[m
         super().__init__()[m
         self.name = name[m
         self.myShell = myShell[m
         self.stream = stream[m
[31m-        # print("MyThread __init__ end")[m
[32m+[m[32m        # print("MyShellThread __init__ end")[m
 [m
     def run(self):[m
         """å¤–éƒ¨ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã®èª­ã¿è¾¼ã¿"""[m
[31m-        # print(f"MyThread_run() start f={type(self.myShell)} n={self.name}")[m
[32m+[m[32m        # print(f"MyShellThread_run() start f={type(self.myShell)} n={self.name}")[m
         while self.myShell.isActive() != 0:[m
             ans = self.stream.read(1)[m
             # print(f"start n={self.name} a=/{ans}/")[m
[31m-            with self.myShell.lock:[m
[32m+[m[32m            with self.myShell.get_lock():[m
                 self.myShell.data = self.myShell.data + ans[m
[31m-        # print(f"MyThread_run() end n={self.name} a=/{ans}/")[m
[32m+[m[32m        # print(f"MyShellThread_run() end n={self.name} a=/{ans}/")[m
         #[m
         # activeã§ãªããªã£ãŸã®ã§å¿µã®ãŸã‚æ¶ˆã™[m
         try:[m
[36m@@ -324,9 +769,9 @@[m [mclass TtlParseTreeVisitor(ParseTreeVisitor):[m
 [m
     def visitChildren(self, node):[m
         result = {}[m
[31m-        result["name"] = node.__class__.__name__[m
[32m+[m[32m        result['name'] = node.__class__.__name__[m
         line_number = node.start.line[m
[31m-        result["line"] = line_number[m
[32m+[m[32m        result['line'] = line_number[m
         #[m
         n = node.getChildCount()[m
         if n == 0:[m
[36m@@ -338,7 +783,7 @@[m [mclass TtlParseTreeVisitor(ParseTreeVisitor):[m
             if childResult is not None:[m
                 worker_list.append(childResult)[m
         if worker_list != 0:[m
[31m-            result["child"] = worker_list[m
[32m+[m[32m            result['child'] = worker_list[m
         return result[m
 [m
     def visitTerminal(self, node):[m
[36m@@ -347,7 +792,7 @@[m [mclass TtlParseTreeVisitor(ParseTreeVisitor):[m
         if type < 0:[m
             return None[m
         x = TtlParserLexer.ruleNames[type - 1][m
[31m-        if x == "RN" or x == "WS":[m
[32m+[m[32m        if x == 'RN' or x == 'WS':[m
             return None[m
         return node.getText()[m
 [m
[36m@@ -364,7 +809,57 @@[m [mclass ThrowingErrorListener(ErrorListener):[m
         raise TypeError(f"### l={line}:{column} Token recognition error - {msg}")[m
 [m
 [m
[31m-class TtlPaserWolker(ABC):[m
[32m+[m[32mclass SplitEscape():[m
[32m+[m
[32m+[m[32m    split_escape_buffer = ''[m
[32m+[m[32m    split_escape_state = 0[m
[32m+[m
[32m+[m[32m    def split_escape(self, text: str) -> str:[m
[32m+[m[32m        '''[m
[32m+[m[32m        è£…ç½®ã‹ã‚‰åé›†ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãŒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã«ã‚ˆã‚Šè‰²ä»˜ã‘ã•ã‚Œã¦ã„ã‚‹ã¨[m
[32m+[m[32m        ãªã«ã‹ã¨å›°ã‚‹ã®ã§ ã“ã“ã§å–ã‚‹ã€‚[m
[32m+[m[32m        ãŸã ã—ã€æœ¬æ¥ã§ã‚ã‚Œã°ä»¥ä¸‹ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã¯ã¨ã‚Œã‚‹ã®ã ãŒã€[m
[32m+[m[32m        è¡Œé–“ã¾ãŸãã¨å–ã‚Œãªã„ã®ã§ç‹¬è‡ªå®Ÿè£…ã‚’å…¥ã‚ŒãŸ[m
[32m+[m[32m        ansi_escape = re.compile('\x1B\\[\\d+([;\\d]+){0,2}m')[m
[32m+[m[32m        return ansi_escape.sub('', text)[m
[32m+[m[32m        '''[m
[32m+[m[32m        result = ''[m
[32m+[m[32m        for char in text:[m
[32m+[m[32m            if self.split_escape_state == 0:[m
[32m+[m[32m                if char == "\x1b":[m
[32m+[m[32m                    self.split_escape_state = 1[m
[32m+[m[32m                    self.split_escape_buffer = char[m
[32m+[m[32m                else:[m
[32m+[m[32m                    result = result + char[m
[32m+[m[32m            elif self.split_escape_state == 1:[m
[32m+[m[32m                self.split_escape_buffer = self.split_escape_buffer + char[m
[32m+[m[32m                if char == '[':[m
[32m+[m[32m                    self.split_escape_state = 2[m
[32m+[m[32m                else:[m
[32m+[m[32m                    result = result + self.split_escape_buffer[m
[32m+[m[32m                    self.split_escape_state == 0[m
[32m+[m[32m                    self.split_escape_buffer = ''[m
[32m+[m[32m            else:[m
[32m+[m[32m                self.split_escape_buffer = self.split_escape_buffer + char[m
[32m+[m[32m                if '0' <= char and char <= '9':[m
[32m+[m[32m                    pass[m
[32m+[m[32m                elif char == ';':[m
[32m+[m[32m                    self.split_escape_state = self.split_escape_state + 1[m
[32m+[m[32m                    if 5 <= self.split_escape_state:[m
[32m+[m[32m                        result = result + self.split_escape_buffer[m
[32m+[m[32m                        self.split_escape_state = 0[m
[32m+[m[32m                        self.split_escape_buffer = ''[m
[32m+[m[32m                elif char == 'm':[m
[32m+[m[32m                    self.split_escape_state = 0[m
[32m+[m[32m                    self.split_escape_buffer = ''[m
[32m+[m[32m                else:[m
[32m+[m[32m                    result = result + self.split_escape_buffer[m
[32m+[m[32m                    self.split_escape_state = 0[m
[32m+[m[32m                    self.split_escape_buffer = ''[m
[32m+[m[32m        return result[m
[32m+[m
[32m+[m
[32m+[m[32mclass TtlPaserWolker(ABC, SplitEscape):[m
     """tera tekitou lang ã®å®Ÿè£…éƒ¨åˆ†(GUIé™¤ã)"""[m
 [m
     def __init__(self):[m
[36m@@ -376,9 +871,9 @@[m [mclass TtlPaserWolker(ABC):[m
         self.end_flag = False[m
         self.client = None[m
         self.shell = None[m
[31m-        self.stdout = ""[m
[32m+[m[32m        self.stdout = ''[m
         self.file_handle_list = {}[m
[31m-        self.title = "dummy"[m
[32m+[m[32m        self.title = 'dummy'[m
         self.title = self.getTitle()  # ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚ŒãŸã¨ãã«ã‚¿ã‚¤ãƒˆãƒ«ã‚’å·®ã—æ›¿ãˆã‚‹[m
         self.log_file_handle = None[m
         self.log_start = True[m
[36m@@ -390,12 +885,17 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         self.encrypt_file = {}[m
         self.exitcode = None[m
[32m+[m[32m        #[m
[32m+[m[32m        self.speed = 9600[m
[32m+[m[32m        self.flowctrl = 3[m
[32m+[m[32m        self.flowctrl_rts = False[m
[32m+[m[32m        self.flowctrl_dtr = False[m
 [m
     def stop(self, error=None):[m
         """å¼·åˆ¶åœæ­¢å‡¦ç†"""[m
         if error is not None:[m
[31m-            self.setValue("error", error)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('error', error)[m
[32m+[m[32m            self.setValue('result', 0)[m
         self.end_flag = True[m
         #[m
         # SSHæ¥ç¶šã—ã¦ã„ãŸã‚‰æ­¢ã‚ã‚‹[m
[36m@@ -414,7 +914,7 @@[m [mclass TtlPaserWolker(ABC):[m
     def closeClient(self):[m
         """close client"""[m
         # print("closeClient()")[m
[31m-        self.stdout = ""[m
[32m+[m[32m        self.stdout = ''[m
         self.log_connect_time = None[m
         #[m
         client = self.client[m
[36m@@ -437,17 +937,17 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def set_default_value(self, param_list: list):[m
         #[m
[31m-        self.setValue("error", "")[m
[31m-        self.setValue("result", 1)[m
[32m+[m[32m        self.setValue('error', "")[m
[32m+[m[32m        self.setValue('result', 1)[m
         #[m
         # print(f" data={json.dumps(param_list, indent=2)}")[m
         for i in range(10):[m
[31m-            self.setValue("param" + str(i + 1), "")[m
[31m-            self.setValue("param[" + str(i + 1) + "]", "")[m
[32m+[m[32m            self.setValue('param' + str(i + 1), '')[m
[32m+[m[32m            self.setValue('param[' + str(i + 1) + ']', '')[m
         #[m
         for i, param in enumerate(param_list):[m
[31m-            self.setValue("param" + str(i + 1), param)[m
[31m-            self.setValue("param[" + str(i + 1) + "]", param)[m
[32m+[m[32m            self.setValue('param' + str(i + 1), param)[m
[32m+[m[32m            self.setValue('param[' + str(i + 1) + ']', param)[m
 [m
     def execute(self, filename: str, param_list: list, data=None, ignore_result=False):[m
         try:[m
[36m@@ -457,7 +957,7 @@[m [mclass TtlPaserWolker(ABC):[m
             self.include(filename, data)[m
             #[m
             if self.exitcode is not None:[m
[31m-                self.setValue("result", self.exitcode)[m
[32m+[m[32m                self.setValue('result', self.exitcode)[m
             if not ignore_result:[m
                 result = int(self.getValue('result'))[m
                 error_data = self.getValue('error')[m
[36m@@ -475,7 +975,7 @@[m [mclass TtlPaserWolker(ABC):[m
             # print(f"filename={filename} param={self.result_file_json}")[m
             if filename not in self.result_file_json:[m
                 if data is None:[m
[31m-                    with open(filename, "r", encoding="utf-8") as f:[m
[32m+[m[32m                    with open(filename, 'r', encoding='utf-8') as f:[m
                         data = f.read()[m
                 result_json = self.include_data(data)[m
                 #[m
[36m@@ -503,7 +1003,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # å®Ÿå‡¦ç†ã“ã“ã‹ã‚‰[m
         try:[m
             #[m
[31m-            self.execute_result(self.result_file_json[filename]["child"])[m
[32m+[m[32m            self.execute_result(self.result_file_json[filename]['child'])[m
             #[m
         except TtlExitFlagException:[m
             # exitã‚³ãƒãƒ³ãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¨ãã¯æ­£å¸¸çµ‚äº†ã§ã™[m
[36m@@ -554,8 +1054,8 @@[m [mclass TtlPaserWolker(ABC):[m
         if strvar not in self.value_list:[m
             for k in self.value_list:[m
                 # print(k)[m
[31m-                if strvar + "[" in k:[m
[31m-                    return "ARRAY"  # é…åˆ—æŒ‡å®šãŒã‚ã‚‹[m
[32m+[m[32m                if strvar + '[' in k:[m
[32m+[m[32m                    return 'ARRAY'  # é…åˆ—æŒ‡å®šãŒã‚ã‚‹[m
             if error_stop:[m
                 raise TypeError(f"Value not found err v={strvar}")[m
             return None[m
[36m@@ -568,33 +1068,33 @@[m [mclass TtlPaserWolker(ABC):[m
         if self.end_flag:[m
             return[m
         for x in x_list:[m
[31m-            name = x["name"][m
[31m-            line = x["line"][m
[32m+[m[32m            name = x['name'][m
[32m+[m[32m            line = x['line'][m
             #[m
             # ã‚ˆãã‚ã‹ã‚‰ã‚“ãŒsleepå…¥ã‚Œãªã„ã¨ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ï¼Ÿ[m
             # time.sleep(0.01)[m
             #[m
[31m-            if "CommandlineContext" == name:[m
[32m+[m[32m            if 'CommandlineContext' == name:[m
                 if ifFlag != 0:[m
[31m-                    self.commandlineContext(x["child"])[m
[31m-            elif "ElseifContext" == name:[m
[32m+[m[32m                    self.commandlineContext(x['child'])[m
[32m+[m[32m            elif 'ElseifContext' == name:[m
                 if ifFlag == 0:[m
[31m-                    first = self.getDataInt(x["child"][1])[m
[32m+[m[32m                    first = self.getDataInt(x['child'][1])[m
                     if first != 0:[m
[31m-                        self.execute_result(x["child"][3:])[m
[32m+[m[32m                        self.execute_result(x['child'][3:])[m
                         ifFlag = 1[m
[31m-            elif "ElseContext" == name:[m
[32m+[m[32m            elif 'ElseContext' == name:[m
                 if ifFlag == 0:[m
[31m-                    self.execute_result(x["child"][1:])[m
[32m+[m[32m                    self.execute_result(x['child'][1:])[m
             else:[m
                 self.stop(error=f"### l={line} execute_result Unkown name={name} x={x}")[m
             if self.end_flag:[m
                 break[m
 [m
     def normpath(self, filename: str) -> str:[m
[31m-        filename = os.path.normpath(filename.replace("\\", "/"))[m
[31m-        if platform.system().lower() == "linux":[m
[31m-            result = re.search("^([a-zA-Z]):(.*)$", filename)[m
[32m+[m[32m        filename = os.path.normpath(filename.replace("\\", '/'))[m
[32m+[m[32m        if platform.system().lower() == 'linux':[m
[32m+[m[32m            result = re.search('^([a-zA-Z]):(.*)$', filename)[m
             if result:[m
                 filename = f"/mnt/{result.group(1)}/{result.group(2)}"[m
         return filename[m
[36m@@ -602,195 +1102,199 @@[m [mclass TtlPaserWolker(ABC):[m
     def commandlineContext(self, token_list):[m
         for x in token_list:[m
             # print(f"commandlineContext data={json.dumps(x, indent=2)}")[m
[31m-            name = x["name"][m
[31m-            line = x["line"][m
[31m-            if "InputContext" == name:[m
[31m-                strvar = self.getKeywordName(x["child"][0])[m
[31m-                data = x["child"][2][m
[32m+[m[32m            name = x['name'][m
[32m+[m[32m            line = x['line'][m
[32m+[m[32m            if 'InputContext' == name:[m
[32m+[m[32m                strvar = self.getKeywordName(x['child'][0])[m
[32m+[m[32m                data = x['child'][2][m
                 data = self.getData(data)[m
                 self.setValue(strvar, data)[m
[31m-            elif "CommandContext" == name:[m
[31m-                command_name = x["child"][0][m
[31m-                if "assert" == command_name:[m
[31m-                    self.doAssert(command_name, line, x["child"][1:])[m
[31m-                elif "break" == command_name:[m
[32m+[m[32m            elif 'CommandContext' == name:[m
[32m+[m[32m                command_name = x['child'][0][m
[32m+[m[32m                if 'assert' == command_name:[m
[32m+[m[32m                    self.doAssert(command_name, line, x['child'][1:])[m
[32m+[m[32m                elif 'break' == command_name:[m
                     raise TtlBreakFlagException(command_name)[m
[31m-                elif "continue" == command_name:[m
[32m+[m[32m                elif 'continue' == command_name:[m
                     raise TtlContinueFlagException(command_name)[m
[31m-                elif "end" == command_name:[m
[32m+[m[32m                elif 'end' == command_name:[m
                     self.end_flag = True[m
[31m-                elif "exit" == command_name:[m
[32m+[m[32m                elif 'exit' == command_name:[m
                     raise TtlExitFlagException(command_name)[m
[31m-                elif "return" == command_name:[m
[32m+[m[32m                elif 'return' == command_name:[m
                     raise TtlReturnFlagException(command_name)[m
[31m-                elif "include" == command_name:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif 'include' == command_name:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     self.include(p1)[m
[31m-                elif "call" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'call' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     # print(f"call label={p1}")[m
                     self.callContext(line, p1)[m
[31m-                elif "bplusrecv" == command_name:[m
[32m+[m[32m                elif 'bplusrecv' == command_name:[m
                     self.doBplusrecv(command_name, line)[m
[31m-                elif "bplussend" == command_name:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif 'bplussend' == command_name:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     self.doBplussend(command_name, line, p1)[m
[31m-                elif "callmenu" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'callmenu' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doCallmenu(command_name, line, p1)[m
[31m-                elif command_name in ["setdir", "changedir"]:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif command_name in ['setdir', 'changedir']:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     self.doChangedir(p1)[m
[31m-                elif "clearscreen" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'clearscreen' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doClearscreen(command_name, line, p1)[m
[31m-                elif command_name in ["closett", "disconnect", "unlink"]:[m
[32m+[m[32m                elif command_name in ['closett', 'disconnect', 'unlink']:[m
                     self.closeClient()[m
[31m-                elif "connect" == command_name:[m
[31m-                    self.doConnect(self.getData(x["child"][1]), line)[m
[31m-                elif "dispstr" == command_name:[m
[31m-                    self.doDispstr(x["child"][1:])[m
[31m-                elif "flushrecv" == command_name:[m
[32m+[m[32m                elif 'connect' == command_name:[m
[32m+[m[32m                    self.doConnect(self.getData(x['child'][1]), line)[m
[32m+[m[32m                elif 'dispstr' == command_name:[m
[32m+[m[32m                    self.doDispstr(x['child'][1:])[m
[32m+[m[32m                elif 'flushrecv' == command_name:[m
                     self.doFlushrecv()[m
[31m-                elif "enablekeyb" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'enablekeyb' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doEnablekeyb(command_name, line, p1)[m
[31m-                elif "getmodemstatus" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'getmodemstatus' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     self.doGetmodemstatus(command_name, line, p1)[m
[31m-                elif "gethostname" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'gethostname' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     self.doGethostname(p1)[m
[31m-                elif "gettitle" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'gettitle' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getTitle()[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "logautoclosemode" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'logautoclosemode' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doLogautoclosemode(command_name, line, p1)[m
[31m-                elif "logclose" == command_name:[m
[32m+[m[32m                elif 'logclose' == command_name:[m
                     self.doLogclose()[m
[31m-                elif "loginfo" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'loginfo' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     self.doLoginfo(command_name, line, p1)[m
[31m-                elif "logopen" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[31m-                    p_len = len(x["child"])[m
[32m+[m[32m                elif 'logopen' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
[32m+[m[32m                    p_len = len(x['child'])[m
                     p4 = 0[m
                     if 5 < p_len:[m
[31m-                        p4 = self.getDataInt(x["child"][4])[m
[32m+[m[32m                        p4 = self.getDataInt(x['child'][4])[m
                     p5 = 0[m
                     if 6 <= p_len:[m
[31m-                        p5 = self.getDataInt(x["child"][5])[m
[32m+[m[32m                        p5 = self.getDataInt(x['child'][5])[m
                     p6 = 0[m
                     if 7 <= p_len:[m
[31m-                        p6 = self.getDataInt(x["child"][6])[m
[32m+[m[32m                        p6 = self.getDataInt(x['child'][6])[m
                     p7 = 0[m
                     if 8 <= p_len:[m
[31m-                        p7 = self.getDataInt(x["child"][7])[m
[32m+[m[32m                        p7 = self.getDataInt(x['child'][7])[m
                     p8 = 0[m
                     if 9 <= p_len:[m
[31m-                        p8 = self.getDataInt(x["child"][8])[m
[32m+[m[32m                        p8 = self.getDataInt(x['child'][8])[m
                     self.doLogopen(p1, p2, p3, p4, p5, p6, p7, p8)[m
[31m-                elif "logpause" == command_name:[m
[32m+[m[32m                elif 'logpause' == command_name:[m
                     self.doLogpause()[m
[31m-                elif "logrotate" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p_len = len(self.getData(x["child"]))[m
[32m+[m[32m                elif 'logrotate' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p_len = len(self.getData(x['child']))[m
                     p2 = None[m
                     if 3 < p_len:[m
[31m-                        p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                        p2 = self.getDataInt(x['child'][2])[m
                     self.doLogrotate(command_name, line, p1, p2)[m
[31m-                elif "logstart" == command_name:[m
[32m+[m[32m                elif 'logstart' == command_name:[m
                     self.doLogstart()[m
[31m-                elif "logwrite" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'logwrite' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doLogwrite(p1)[m
[31m-                elif "recvln" == command_name:[m
[32m+[m[32m                elif 'recvln' == command_name:[m
                     self.doRecvln()[m
[31m-                elif "scprecv" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'scprecv' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     p2 = p1[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = str(self.getData(x['child'][2]))[m
                     self.doScprecv(p1, p2)[m
[31m-                elif "scpsend" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'scpsend' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     p2 = p1[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = str(self.getData(x['child'][2]))[m
                     self.doScpsend(p1, p2)[m
[31m-                elif command_name in ["send", "sendbinary", "sendtext"]:[m
[31m-                    self.doSend(x["child"][1:])[m
[31m-                elif "sendbreak" == command_name:[m
[32m+[m[32m                elif command_name in ['send', 'sendbinary', 'sendtext']:[m
[32m+[m[32m                    self.doSend(x['child'][1:])[m
[32m+[m[32m                elif 'sendbreak' == command_name:[m
                     self.doSendbreak()[m
[31m-                elif "sendln" == command_name:[m
[31m-                    self.doSendln(x["child"][1:])[m
[31m-                elif "settitle" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'sendln' == command_name:[m
[32m+[m[32m                    self.doSendln(x['child'][1:])[m
[32m+[m[32m                elif ('setbaud' == command_name) or ('setspeed' == command_name):[m
[32m+[m[32m                    self.speed = self.getDataInt(x['child'][1])[m
[32m+[m[32m                elif 'setflowctrl' == command_name:[m
[32m+[m[32m                    self.flowctrl = self.getDataInt(x['child'][1])[m
[32m+[m[32m                elif 'setdtr' == command_name:[m
[32m+[m[32m                    self.flowctrl_dtr = self.getDataInt(x['child'][1]) != 0[m
[32m+[m[32m                elif 'setrts' == command_name:[m
[32m+[m[32m                    self.flowctrl_rts = self.getDataInt(x['child'][1]) != 0[m
[32m+[m[32m                elif 'settitle' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.setTitle(p1)[m
[31m-                elif "testlink" == command_name:[m
[32m+[m[32m                elif 'testlink' == command_name:[m
                     self.doTestlink()[m
[31m-                elif command_name in ["wait", "wait4all"]:[m
[31m-                    self.doWait(x["child"][1:])[m
[31m-                elif "waitln" == command_name:[m
[31m-                    self.doWaitln(x["child"][1:])[m
[31m-                elif "execcmnd" == command_name:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif command_name in ['wait', 'wait4all']:[m
[32m+[m[32m                    self.doWait(x['child'][1:])[m
[32m+[m[32m                elif 'waitln' == command_name:[m
[32m+[m[32m                    self.doWaitln(x['child'][1:])[m
[32m+[m[32m                elif 'execcmnd' == command_name:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     result_json = self.include_data(p1)[m
[31m-                    self.execute_result(result_json["child"])[m
[31m-                elif "mpause" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                    self.execute_result(result_json['child'])[m
[32m+[m[32m                elif 'mpause' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doPause(p1 / 1000)[m
[31m-                elif "pause" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'pause' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doPause(p1)[m
[31m-                elif "code2str" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = x["child"][2][m
[32m+[m[32m                elif 'code2str' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = x['child'][2][m
                     p2 = self.getData(p2)[m
                     if p2 == 0:[m
[31m-                        self.setValue(p1, "")[m
[32m+[m[32m                        self.setValue(p1, '')[m
                     else:[m
                         p2 = self.getChrSharp(p2)[m
                         self.setValue(p1, p2)[m
[31m-                elif "expandenv" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = ""[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'expandenv' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = ''[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = self.getData(x['child'][2])[m
                     else:[m
                         p2 = self.getData(p1)[m
                     self.doExpandenv(p1, p2)[m
[31m-                elif "int2str" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'int2str' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.setValue(p1, p2)[m
[31m-                elif "sprintf" == command_name:[m
[31m-                    self.doSprintf("inputstr", x["child"][1:])[m
[31m-                elif "sprintf2" == command_name:[m
[31m-                    p1 = x["child"][1][m
[32m+[m[32m                elif 'sprintf' == command_name:[m
[32m+[m[32m                    self.doSprintf('inputstr', x['child'][1:])[m
[32m+[m[32m                elif 'sprintf2' == command_name:[m
[32m+[m[32m                    p1 = x['child'][1][m
                     p1 = self.getKeywordName(p1)[m
[31m-                    self.doSprintf(p1, x["child"][2:])[m
[31m-                elif "str2code" == command_name:[m
[31m-                    # print("str2code")[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = x["child"][2][m
[31m-                    # print(f"p2A={p2}")[m
[32m+[m[32m                    self.doSprintf(p1, x['child'][2:])[m
[32m+[m[32m                elif 'str2code' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = x['child'][2][m
                     p2 = self.getData(p2)[m
[31m-                    # print(f"p2B={p2}")[m
                     p2 = self.getSharpChr(p2)[m
[31m-                    # print(f"p2C={p2}")[m
                     self.setValue(p1, p2)[m
[31m-                elif "str2int" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'str2int' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     self.setValue(p1, p2)[m
[31m-                elif "strcompare" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'strcompare' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     result = 0[m
                     if p1 == p2:[m
                         result = 0[m
[36m@@ -798,410 +1302,410 @@[m [mclass TtlPaserWolker(ABC):[m
                         result = -1[m
                     else:[m
                         result = 1[m
[31m-                    self.setValue("result", result)[m
[31m-                elif "strconcat" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                    self.setValue('result', result)[m
[32m+[m[32m                elif 'strconcat' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_str = self.getValue(p1)[m
[31m-                    p2_str = x["child"][2][m
[32m+[m[32m                    p2_str = x['child'][2][m
                     p1_str = p1_str + self.getData(p2_str)[m
                     self.setValue(p1, p1_str)[m
[31m-                elif "strcopy" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[31m-                    p4 = self.getKeywordName(x["child"][4])[m
[32m+[m[32m                elif 'strcopy' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
[32m+[m[32m                    p4 = self.getKeywordName(x['child'][4])[m
                     if p2 < 0:[m
                         p2 = 0[m
                     p1 = p1[p2: p2 + p3][m
                     self.setValue(p4, p1)[m
[31m-                elif "strinsert" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[32m+[m[32m                elif 'strinsert' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
                     p1_val = self.getData(p1)[m
                     # print(f"### l={line} {command_name} {p1} {p2} {p3} {p1_val}")[m
                     p1_val = p1_val[:p2] + p3 + p1_val[p2:][m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strjoin" == command_name:[m
[32m+[m[32m                elif 'strjoin' == command_name:[m
                     # print(f"### l={line} {command_name}")[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p3 = 9[m
                     # print(f"len {len(x['child'])}")[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p3 = self.getDataInt(x["child"][3])[m
[31m-                    p1_val = ""[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p3 = self.getDataInt(x['child'][3])[m
[32m+[m[32m                    p1_val = ''[m
                     for i in range(p3):[m
                         if i != 0:[m
                             p1_val = p1_val + p2[m
[31m-                        p1_val = p1_val + self.getValue("groupmatchstr" + str(i + 1))[m
[32m+[m[32m                        p1_val = p1_val + self.getValue('groupmatchstr' + str(i + 1))[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strlen" == command_name:[m
[31m-                    p1 = len(self.getData(x["child"][1]))[m
[31m-                    self.setValue("result", p1)[m
[31m-                elif "strmatch" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'strlen' == command_name:[m
[32m+[m[32m                    p1 = len(self.getData(x['child'][1]))[m
[32m+[m[32m                    self.setValue('result', p1)[m
[32m+[m[32m                elif 'strmatch' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doStrmatch(p1, p2)[m
[31m-                elif "strremove" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[32m+[m[32m                elif 'strremove' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
                     p1_val = self.getData(p1)[m
                     # print(f"### l={line} {command_name} {p1} {p2} {p3} {p1_val}")[m
                     p1_val = p1_val[:p2] + p1_val[p2 + p3:][m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strreplace" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'strreplace' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getData(p1)[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[31m-                    p4 = str(self.getData(x["child"][4]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
[32m+[m[32m                    p4 = str(self.getData(x['child'][4]))[m
                     self.doStrreplace(p1, p1_val, p2, p3, p4)[m
[31m-                elif "strscan" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'strscan' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     index = p1.find(p2)[m
                     if index < 0:[m
                         index = 0[m
                     else:[m
                         index = index + 1[m
                     # print(f"strscan {index}")[m
[31m-                    self.setValue("result", index)[m
[31m-                elif "strspecial" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                    self.setValue('result', index)[m
[32m+[m[32m                elif 'strspecial' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getData(p1)[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p1_val = str(self.getData(x["child"][2]))[m
[31m-                    p1_val = p1_val.encode().decode("unicode_escape")[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p1_val = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p1_val = p1_val.encode().decode('unicode_escape', errors='xmlcharrefreplace')[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strsplit" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'strsplit' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getData(p1)[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p3 = 10[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p3 = self.getDataInt(x["child"][3])[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p3 = self.getDataInt(x['child'][3])[m
                     for i in range(9):[m
[31m-                        self.setValue("groupmatchstr" + str(i + 1), "")[m
[32m+[m[32m                        self.setValue('groupmatchstr' + str(i + 1), '')[m
                     i = 0[m
                     while i < p3 - 1:[m
                         index = p1_val.find(p2)[m
                         if 0 <= index:[m
                             # print(f"aa i{i + 1} {p3} /{p1_val[0:index]}/ /{p1_val[index + len(p2):]}/")[m
[31m-                            self.setValue("groupmatchstr" + str(i + 1), p1_val[0:index])[m
[32m+[m[32m                            self.setValue('groupmatchstr' + str(i + 1), p1_val[0:index])[m
                             p1_val = p1_val[index + len(p2):][m
                         else:[m
                             break[m
                         i = i + 1[m
                     if 0 < len(p1_val):[m
                         # print(f"bb i{i + 1} {p3} /{p1_val}/")[m
[31m-                        self.setValue("groupmatchstr" + str(i + 1), p1_val)[m
[32m+[m[32m                        self.setValue('groupmatchstr' + str(i + 1), p1_val)[m
                     i = i + 1[m
                     # print(f"i={i}")[m
[31m-                    self.setValue("result", i)[m
[31m-                elif "strtrim" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                    self.setValue('result', i)[m
[32m+[m[32m                elif 'strtrim' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_var = self.getData(p1)[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     p1_var = self.doStrtrim(p1_var, p2)[m
                     self.setValue(p1, p1_var)[m
[31m-                elif "tolower" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'tolower' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = p2.lower()[m
                     self.setValue(p1, p2)[m
[31m-                elif "toupper" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'toupper' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = p2.upper()[m
                     self.setValue(p1, p2)[m
[31m-                elif "basename" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'basename' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = self.normpath(p2)[m
                     p2 = os.path.basename(p2)[m
                     self.setValue(p1, str(p2))[m
[31m-                elif "dirname" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'dirname' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = self.normpath(p2)[m
                     # print(f"p2a={p2}")[m
[31m-                    p2 = re.sub(r"[\/]$", "", p2)[m
[32m+[m[32m                    p2 = re.sub(r'[\/]$', '', p2)[m
                     p2 = pathlib.Path(p2)[m
                     # print(f"p2b={p2}")[m
                     p2 = str(p2.parent)[m
                     # print(f"p2c={p2}")[m
                     self.setValue(p1, str(p2))[m
[31m-                elif command_name in ["fileclose", "findclose"]:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif command_name in ['fileclose', 'findclose']:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     self.doFileclose(p1)[m
[31m-                elif "fileconcat" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'fileconcat' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doFileconcat(p1, p2)[m
[31m-                elif "filecopy" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'filecopy' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doFilecopy(p1, p2)[m
[31m-                elif "filecreate" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'filecreate' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doFileopen(p1, p2, 0, 0)[m
[31m-                elif "filedelete" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'filedelete' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFiledelete(p1)[m
[31m-                elif "fileopen" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[32m+[m[32m                elif 'fileopen' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
                     p4 = 0[m
[31m-                    if 5 <= len(x["child"]):[m
[31m-                        p4 = self.getData(x["child"][4])[m
[32m+[m[32m                    if 5 <= len(x['child']):[m
[32m+[m[32m                        p4 = self.getData(x['child'][4])[m
                     self.doFileopen(p1, p2, p3, p4)[m
[31m-                elif "filereadln" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'filereadln' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doFilereadln(line, p1, p2)[m
[31m-                elif "fileread" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[31m-                    p3 = self.getKeywordName(x["child"][3])[m
[32m+[m[32m                elif 'fileread' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
[32m+[m[32m                    p3 = self.getKeywordName(x['child'][3])[m
                     self.doFileread(line, p1, p2, p3)[m
[31m-                elif "filerename" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'filerename' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doFilerename(p1, p2)[m
[31m-                elif "filesearch" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'filesearch' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFilesearch(p1)[m
[31m-                elif "filestat" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'filestat' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     p3 = None[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p3 = str(self.getKeywordName(x["child"][3]))[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p3 = str(self.getKeywordName(x['child'][3]))[m
                     p4 = None[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p4 = str(self.getKeywordName(x["child"][4]))[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p4 = str(self.getKeywordName(x['child'][4]))[m
                     self.doFilestat(p1, p2, p3, p4)[m
[31m-                elif "filetruncate" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'filetruncate' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     self.doFiletruncate(p1, p2)[m
[31m-                elif "filewrite" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'filewrite' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doFilewrite(line, p1, p2)[m
[31m-                elif "filewriteln" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2]) + "\n"[m
[32m+[m[32m                elif 'filewriteln' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2]) + "\n"[m
                     self.doFilewrite(line, p1, p2)[m
[31m-                elif "findfirst" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = self.getKeywordName(x["child"][3])[m
[32m+[m[32m                elif 'findfirst' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = self.getKeywordName(x['child'][3])[m
                     self.doFindfirst(line, p1, p2, p3)[m
[31m-                elif "findnext" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'findnext' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doFindnext(line, p1, p2)[m
[31m-                elif "foldercreate" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'foldercreate' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFoldercreate(p1)[m
[31m-                elif "folderdelete" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'folderdelete' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFolderdelete(p1)[m
[31m-                elif "foldersearch" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'foldersearch' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFoldersearch(p1)[m
[31m-                elif "getdir" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'getdir' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     path = pathlib.Path.cwd()[m
                     self.setValue(p1, str(path))[m
[31m-                elif "makepath" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[32m+[m[32m                elif 'makepath' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
                     self.doMakepath(p1, p2, p3)[m
[31m-                elif command_name in ["setpassword", "setpassword2"]:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[31m-                    p4 = "anonymouse"[m
[31m-                    if 5 <= len(x["child"]):[m
[31m-                        p4 = str(self.getData(x["child"][4]))[m
[32m+[m[32m                elif command_name in ['setpassword', 'setpassword2']:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
[32m+[m[32m                    p4 = 'anonymouse'[m
[32m+[m[32m                    if 5 <= len(x['child']):[m
[32m+[m[32m                        p4 = str(self.getData(x['child'][4]))[m
                     self.doSetpassword(p1, p2, p3, p4)[m
[31m-                elif command_name in ["getpassword", "getpassword2"]:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = str(self.getKeywordName(x["child"][3]))[m
[31m-                    p4 = "anonymouse"[m
[31m-                    if 5 <= len(x["child"]):[m
[31m-                        p4 = str(self.getData(x["child"][4]))[m
[32m+[m[32m                elif command_name in ['getpassword', 'getpassword2']:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = str(self.getKeywordName(x['child'][3]))[m
[32m+[m[32m                    p4 = 'anonymouse'[m
[32m+[m[32m                    if 5 <= len(x['child']):[m
[32m+[m[32m                        p4 = str(self.getData(x['child'][4]))[m
                     self.doGetpassword(p1, p2, p3, p4)[m
[31m-                elif command_name in ["ispassword", "ispassword2"]:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif command_name in ['ispassword', 'ispassword2']:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doIspassword(p1, p2)[m
[31m-                elif command_name in ["delpassword", "delpassword2"]:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif command_name in ['delpassword', 'delpassword2']:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doDelpassword(p1, p2)[m
[31m-                elif "checksum8" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum8' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum8(p1, p2)[m
[31m-                elif "checksum8file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum8file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum8file(p1, p2)[m
[31m-                elif "checksum16" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum16' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum16(p1, p2)[m
[31m-                elif "checksum16file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum16file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum16file(p1, p2)[m
[31m-                elif "checksum32" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum32' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum32(p1, p2)[m
[31m-                elif "checksum32file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum32file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum32file(p1, p2)[m
[31m-                elif "crc16" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc16' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc16(p1, p2)[m
[31m-                elif "crc16file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc16file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc16file(p1, p2)[m
[31m-                elif "crc32" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc32' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc32(p1, p2)[m
[31m-                elif "crc32file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc32file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc32file(p1, p2)[m
[31m-                elif "exec" == command_name:[m
[31m-                    self.doExec(line, x["child"][1:])[m
[31m-                elif "getdate" == command_name:[m
[31m-                    self.doGetdate(x["child"][1:])[m
[31m-                elif "getenv" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getKeywordName(x["child"][2])[m
[32m+[m[32m                elif 'exec' == command_name:[m
[32m+[m[32m                    self.doExec(line, x['child'][1:])[m
[32m+[m[32m                elif 'getdate' == command_name:[m
[32m+[m[32m                    self.doGetdate(x['child'][1:])[m
[32m+[m[32m                elif 'getenv' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getKeywordName(x['child'][2])[m
                     # print(f"getenv1 c=({command_name}) l={p1} r={p2}")[m
                     p1 = os.getenv(p1)[m
                     if p1 is None:[m
[31m-                        p1 = ""[m
[32m+[m[32m                        p1 = ''[m
                     # print(f"getenv2 c=({command_name}) l={p1} r={p2}")[m
                     self.setValue(p2, p1)[m
[31m-                elif "getipv4addr" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'getipv4addr' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doGetipv4addr(p1, p2)[m
[31m-                elif "getipv6addr" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'getipv6addr' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doGetipv6addr(p1, p2)[m
[31m-                elif "gettime" == command_name:[m
[31m-                    self.doGetdate(x["child"][1:], format="%H:%M:%S")[m
[31m-                elif "getttdir" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'gettime' == command_name:[m
[32m+[m[32m                    self.doGetdate(x['child'][1:], format='%H:%M:%S')[m
[32m+[m[32m                elif 'getttdir' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     self.setValue(p1, self.current_dir)[m
[31m-                elif "getver" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'getver' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     p2 = None[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = float(self.getData(x["child"][2]))[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = float(self.getData(x['child'][2]))[m
                     self.doGetver(p1, p2)[m
[31m-                elif "ifdefined" == command_name:[m
[31m-                    p1 = str(x["child"][1])[m
[32m+[m[32m                elif 'ifdefined' == command_name:[m
[32m+[m[32m                    p1 = str(x['child'][1])[m
                     self.doIfdefined(p1)[m
[31m-                elif "intdim" == command_name:[m
[31m-                    p1 = x["child"][1][m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'intdim' == command_name:[m
[32m+[m[32m                    p1 = x['child'][1][m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     for i in range(p2):[m
[31m-                        self.setValue(p1 + "[" + str(i) + "]", 0)[m
[31m-                elif "random" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                        self.setValue(p1 + '[' + str(i) + ']', 0)[m
[32m+[m[32m                elif 'random' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     p1_val = random.randint(0, p2)[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "setenv" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'setenv' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     os.environ[p1] = p2[m
                     # print(f"setenv2 c=({command_name}) l={p1} r={p2}")[m
[31m-                elif "setexitcode" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'setexitcode' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doSetexitcode(p1)[m
[31m-                elif "strdim" == command_name:[m
[31m-                    p1 = x["child"][1][m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'strdim' == command_name:[m
[32m+[m[32m                    p1 = x['child'][1][m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     for i in range(p2):[m
[31m-                        self.setValue(p1 + "[" + str(i) + "]", "")[m
[31m-                elif "uptime" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                        self.setValue(p1 + '[' + str(i) + ']', '')[m
[32m+[m[32m                elif 'uptime' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     self.setValue(p1, int(uptime.uptime() * 1000))[m
                 else:[m
                     # print(f"### l={line} ã‚³ãƒãƒ³ãƒ‰ãŒåˆ†ã‹ã‚‰ãªã„{name}")[m
[31m-                    self.commandContext(command_name, line, x["child"][1:])[m
[31m-            elif "ForNextContext" == name:[m
[31m-                self.forNextContext(x["child"])[m
[31m-            elif "WhileEndwhileContext" == name:[m
[31m-                self.whileEndwhileContext(x["child"])[m
[31m-            elif "UntilEnduntilContext" == name:[m
[31m-                self.untilEnduntilContext(x["child"])[m
[31m-            elif "DoLoopContext" == name:[m
[31m-                self.doLoopContext(x["child"])[m
[31m-            elif "If1Context" == name:[m
[31m-                self.if1Context(x["child"])[m
[31m-            elif "If2Context" == name:[m
[31m-                self.if2Context(x["child"])[m
[31m-            elif "LabelContext" != name:[m
[32m+[m[32m                    self.commandContext(command_name, line, x['child'][1:])[m
[32m+[m[32m            elif 'ForNextContext' == name:[m
[32m+[m[32m                self.forNextContext(x['child'])[m
[32m+[m[32m            elif 'WhileEndwhileContext' == name:[m
[32m+[m[32m                self.whileEndwhileContext(x['child'])[m
[32m+[m[32m            elif 'UntilEnduntilContext' == name:[m
[32m+[m[32m                self.untilEnduntilContext(x['child'])[m
[32m+[m[32m            elif 'DoLoopContext' == name:[m
[32m+[m[32m                self.doLoopContext(x['child'])[m
[32m+[m[32m            elif 'If1Context' == name:[m
[32m+[m[32m                self.if1Context(x['child'])[m
[32m+[m[32m            elif 'If2Context' == name:[m
[32m+[m[32m                self.if2Context(x['child'])[m
[32m+[m[32m            elif 'LabelContext' != name:[m
                 pass[m
             else:[m
[31m-                self.stop(error=f"### l={line} Unkown name={name}")[m
[32m+[m[32m                self.stop(error=f'### l={line} Unkown name={name}')[m
             if self.end_flag:[m
                 break[m
 [m
     def commandContext(self, name, line, data_list):[m
         """(GUIç³»ã‚’)ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã›ã¦ä½¿ã†"""[m
         # GUIã§ã—ã‹ã§ããªã„ã®ã§ãƒ€ãƒ‹ãƒ¼ã‚’å…¥ã‚Œã¦ãŠã[m
[31m-        if name in ["passwordbox", "inputbox", "listbox"]:[m
[32m+[m[32m        if name in ['passwordbox', 'inputbox', 'listbox']:[m
             # print(f"super.commandContext {name} start")[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("inputstr", "aaa")[m
[32m+[m[32m            self.setValue('inputstr', 'aaa')[m
             # print(f"super.commandContext {name} end")[m
         elif name in [[m
[31m-            "bringupbox",[m
[31m-            "closesbox",[m
[31m-            "messagebox",[m
[31m-            "statusbox",[m
[31m-            "setdlgpos",[m
[32m+[m[32m            'bringupbox',[m
[32m+[m[32m            'closesbox',[m
[32m+[m[32m            'messagebox',[m
[32m+[m[32m            'statusbox',[m
[32m+[m[32m            'setdlgpos',[m
         ]:[m
             self.printCommand(name, line, data_list)[m
[31m-        elif "dirnamebox" == name:[m
[32m+[m[32m        elif 'dirnamebox' == name:[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("result", 1)[m
[31m-            self.setValue("inputstr", str(os.getcwd()))[m
[31m-        elif "filenamebox" == name:[m
[32m+[m[32m            self.setValue('result', 1)[m
[32m+[m[32m            self.setValue('inputstr', str(os.getcwd()))[m
[32m+[m[32m        elif 'filenamebox' == name:[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("result", 0)[m
[31m-            self.setValue("inputstr", "tmp.txt")[m
[31m-        elif name in ["yesnobox"]:[m
[32m+[m[32m            self.setValue('result', 0)[m
[32m+[m[32m            self.setValue('inputstr', 'tmp.txt')[m
[32m+[m[32m        elif name in ['yesnobox']:[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("result", 1)[m
[31m-        elif name in ["showtt"]:[m
[32m+[m[32m            self.setValue('result', 1)[m
[32m+[m[32m        elif name in ['showtt']:[m
             self.printCommand(name, line, data_list)[m
             self.setValue(self.getKeywordName(data_list[0]), 0)[m
[31m-        elif name in ["setdlgpos", "show", "callmenu", "enablekeyb"]:[m
[32m+[m[32m        elif name in ['setdlgpos', 'show', 'callmenu', 'enablekeyb']:[m
             pass[m
         else:[m
             self.printCommand(name, line, data_list)[m
[36m@@ -1220,12 +1724,12 @@[m [mclass TtlPaserWolker(ABC):[m
             if isinstance(result, int):[m
                 result = str(result)[m
             elif isinstance(result, Label):[m
[31m-                result = "LABEL"[m
[32m+[m[32m                result = 'LABEL'[m
             if keywordName is None:[m
                 message = message + f" p({result})"[m
             else:[m
                 message = message + f" p({keywordName}/{result})"[m
[31m-        self.setLog(message + "\n")[m
[32m+[m[32m        self.setLogInner(message + "\n")[m
         return message[m
 [m
     def correctLabel(self):[m
[36m@@ -1237,20 +1741,20 @@[m [mclass TtlPaserWolker(ABC):[m
         i = -1[m
         for token_dict in token_list_list:[m
             i = i + 1[m
[31m-            name = token_dict["name"]  # StatementContext[m
[32m+[m[32m            name = token_dict['name']  # StatementContext[m
             # print(f"correctLabelAll i={i} {name}")[m
             if "StatementContext" == name:[m
                 # print("hit")[m
[31m-                self.correctLabelAll(token_dict["child"])  # StatementContext[m
[31m-            elif "CommandlineContext" == name:[m
[32m+[m[32m                self.correctLabelAll(token_dict['child'])  # StatementContext[m
[32m+[m[32m            elif 'CommandlineContext' == name:[m
                 # print("hit2")[m
                 j = -1[m
[31m-                next_list = token_dict["child"][m
[32m+[m[32m                next_list = token_dict['child'][m
                 for next in next_list:[m
                     j = j + 1[m
[31m-                    if "LabelContext" == next["name"]:[m
[32m+[m[32m                    if 'LabelContext' == next['name']:[m
                         # print(f"hot3 {next['child']}")[m
[31m-                        label_name = next["child"][1][m
[32m+[m[32m                        label_name = next['child'][1][m
                         # print("hit4")[m
                         label = Label(token_list_list[i + 1:])[m
                         # print(f"xxx data={label_name} // {label.getTokenList()}")[m
[36m@@ -1341,7 +1845,7 @@[m [mclass TtlPaserWolker(ABC):[m
                         # do/loop[m
                         # print(f"do/loop={data}")[m
                         pass[m
[31m-                    elif "CommandlineContext" == data["name"]:[m
[32m+[m[32m                    elif 'CommandlineContext' == data['name']:[m
                         # print(f"LineContext={data}")[m
                         self.execute_result([data])[m
                     else:[m
[36m@@ -1373,7 +1877,7 @@[m [mclass TtlPaserWolker(ABC):[m
             result = int(result)[m
         except (TypeError, ValueError) as e:[m
             if isinstance(data, dict):[m
[31m-                if "line" in data:[m
[32m+[m[32m                if 'line' in data:[m
                     raise TypeError(f"### l={data['line']} {type(e).__name__} e={e}")[m
             raise  # ãã®ã¾ã¾ä¸Šæµã¸é€ã‚‹[m
         return result[m
[36m@@ -1383,39 +1887,39 @@[m [mclass TtlPaserWolker(ABC):[m
         result = ""[m
         if isinstance(data, str):[m
             result = self.getValue(data)[m
[31m-        elif "name" not in data:[m
[32m+[m[32m        elif 'name' not in data:[m
             raise TypeError(f"unkown name data={str(data)}")[m
[31m-        elif "P11ExpressionContext" == data["name"]:[m
[31m-            result = self.p11ExpressionContext(data["child"])[m
[31m-        elif "P10ExpressionContext" == data["name"]:[m
[31m-            result = self.p10ExpressionContext(data["child"])[m
[31m-        elif "P9ExpressionContext" == data["name"]:[m
[31m-            result = self.p9ExpressionContext(data["child"])[m
[31m-        elif "P8ExpressionContext" == data["name"]:[m
[31m-            result = self.p8ExpressionContext(data["child"])[m
[31m-        elif "P7ExpressionContext" == data["name"]:[m
[31m-            result = self.p7ExpressionContext(data["child"])[m
[31m-        elif "P6ExpressionContext" == data["name"]:[m
[31m-            result = self.p6ExpressionContext(data["child"])[m
[31m-        elif "P5ExpressionContext" == data["name"]:[m
[31m-            result = self.p5ExpressionContext(data["child"])[m
[31m-        elif "P4ExpressionContext" == data["name"]:[m
[31m-            result = self.p4ExpressionContext(data["child"])[m
[31m-        elif "P3ExpressionContext" == data["name"]:[m
[31m-            result = self.p3ExpressionContext(data["child"])[m
[31m-        elif "P2ExpressionContext" == data["name"]:[m
[31m-            result = self.p2ExpressionContext(data["child"])[m
[31m-        elif "P1ExpressionContext" == data["name"]:[m
[31m-            result = self.p1ExpressionContext(data["child"])[m
[31m-        elif "IntExpressionContext" == data["name"]:[m
[31m-            result = self.intExpressionContext(data["child"])[m
[31m-        elif "StrExpressionContext" == data["name"]:[m
[31m-            result = self.strExpressionContext(data["child"])[m
[31m-        elif "IntContextContext" == data["name"]:[m
[31m-            result = self.intContext(data["child"])[m
[31m-        elif "StrContextContext" == data["name"]:[m
[31m-            result = self.strContext(data["child"])[m
[31m-        elif "KeywordContext" == data["name"]:[m
[32m+[m[32m        elif 'P11ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p11ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P10ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p10ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P9ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p9ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P8ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p8ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P7ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p7ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P6ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p6ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P5ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p5ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P4ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p4ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P3ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p3ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P2ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p2ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P1ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p1ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'IntExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.intExpressionContext(data['child'])[m
[32m+[m[32m        elif 'StrExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.strExpressionContext(data['child'])[m
[32m+[m[32m        elif 'IntContextContext' == data['name']:[m
[32m+[m[32m            result = self.intContext(data['child'])[m
[32m+[m[32m        elif 'StrContextContext' == data['name']:[m
[32m+[m[32m            result = self.strContext(data['child'])[m
[32m+[m[32m        elif 'KeywordContext' == data['name']:[m
             result = self.keywordContext(data)[m
         else:[m
             raise TypeError(f"unkown keyword n={data['name']}")[m
[36m@@ -1454,7 +1958,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # print(f"p9ExpressionContext count={2} data={data[2]['name']} child={data[2]['child']} ")[m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "==" == oper or "=" == oper:[m
[32m+[m[32m        if '==' == oper or '=' == oper:[m
             result = val1 == val2[m
         else:  # <> or !=[m
             result = val1 != val2[m
[36m@@ -1470,11 +1974,11 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "<" == oper:[m
[32m+[m[32m        if '<' == oper:[m
             result = val1 < val2[m
[31m-        elif "<=" == oper:[m
[32m+[m[32m        elif '<=' == oper:[m
             result = val1 <= val2[m
[31m-        elif ">" == oper:[m
[32m+[m[32m        elif '>' == oper:[m
             result = val1 > val2[m
         else:  # '>='[m
             result = val1 >= val2[m
[36m@@ -1523,11 +2027,11 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if ">>>" == oper:[m
[32m+[m[32m        if '>>>' == oper:[m
             result = val1 >> val2[m
[31m-        elif ">>" == oper:[m
[32m+[m[32m        elif '>>' == oper:[m
             result = val1 >> val2[m
[31m-        elif "<<" == oper:[m
[32m+[m[32m        elif '<<' == oper:[m
             result = val1 << val2[m
         return result[m
 [m
[36m@@ -1539,9 +2043,9 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "+" == oper:[m
[32m+[m[32m        if '+' == oper:[m
             result = val1 + val2[m
[31m-        elif "-" == oper:[m
[32m+[m[32m        elif '-' == oper:[m
             result = val1 - val2[m
         return result[m
 [m
[36m@@ -1553,14 +2057,14 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "*" == oper:[m
[32m+[m[32m        if '*' == oper:[m
             result = val1 * val2[m
[31m-        elif "/" == oper:[m
[32m+[m[32m        elif '/' == oper:[m
             try:[m
                 result = val1 // val2[m
             except ZeroDivisionError as e:[m
                 raise TypeError(f"ZeroDivisionError e={str(e)}")[m
[31m-        elif "%" == oper:[m
[32m+[m[32m        elif '%' == oper:[m
             try:[m
                 result = val1 % val2[m
             except ZeroDivisionError as e:[m
[36m@@ -1589,10 +2093,10 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def strContext(self, data_list):[m
         # print(f"str={data_list}")[m
[31m-        result = ""[m
[32m+[m[32m        result = ''[m
         for data in data_list:[m
             state = 0[m
[31m-            old = ""[m
[32m+[m[32m            old = ''[m
             for i in range(len(data)):[m
                 hit_flag = False[m
                 ch0 = data[i][m
[36m@@ -1604,14 +2108,14 @@[m [mclass TtlPaserWolker(ABC):[m
                     elif ch0 == '"':[m
                         state = 2[m
                         hit_flag = True[m
[31m-                    elif ch0 == "#":[m
[32m+[m[32m                    elif ch0 == '#':[m
                         hit_flag = True[m
                     else:[m
                         old = old + ch0[m
                     if hit_flag:[m
                         result = result + self.getChrSharp_str(old)[m
[31m-                        old = ""  # clear[m
[31m-                        if ch0 == "#":[m
[32m+[m[32m                        old = ''  # clear[m
[32m+[m[32m                        if ch0 == '#':[m
                             old = ch0[m
                 elif state == 1:[m
                     if ch0 == "'":[m
[36m@@ -1629,21 +2133,21 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def getChrSharp_str(self, base) -> str:[m
         if len(base) <= 0:[m
[31m-            return ""[m
[32m+[m[32m            return ''[m
         #[m
         # print(f"\tbaseB={base}")[m
[31m-        if "#" == base[0]:[m
[32m+[m[32m        if '#' == base[0]:[m
             # print(f"\tbaseC={base} data={base[1:]}")[m
             base = self.getChrSharp(self.getAsciiNum(base[1:]))[m
             # print(f"\tbaseD={base} data={base[1:]}")[m
[31m-        elif "$" == base[0]:[m
[32m+[m[32m        elif '$' == base[0]:[m
             base = self.getAsciiNum(base)[m
         return base[m
 [m
     def getChrSharp(self, data: int) -> str:[m
         if data <= 0:[m
             return chr(data & 0xFF)[m
[31m-        result = ""[m
[32m+[m[32m        result = ''[m
         while 0 < data:[m
             result = chr(data & 0xFF) + result[m
             data = data >> 8[m
[36m@@ -1652,9 +2156,9 @@[m [mclass TtlPaserWolker(ABC):[m
     def getSharpChr(self, data: str) -> int:[m
         # print(f"getSharpChr {data}")[m
         if len(data) <= 0:[m
[31m-            return ""[m
[32m+[m[32m            return ''[m
         result = 0[m
[31m-        while "" != data:[m
[32m+[m[32m        while '' != data:[m
             result = (result * 256) + ord(data[0])[m
             data = data[1:][m
         return result[m
[36m@@ -1663,7 +2167,7 @@[m [mclass TtlPaserWolker(ABC):[m
         result = 0[m
         data = data_list[0][m
         # print(f"intContext={data}")[m
[31m-        if 0 < len(data) and data[0] == "$":[m
[32m+[m[32m        if 0 < len(data) and data[0] == '$':[m
             result = self.getAsciiNum(data)[m
         else:[m
             result = int(data)[m
[36m@@ -1671,7 +2175,7 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def getAsciiNum(self, data: str) -> int:[m
         # print(f"getAsciiNum={data} len={len(data)} data[0]={data[0]}")[m
[31m-        if (0 < len(data)) and ("$" == data[0]):[m
[32m+[m[32m        if (0 < len(data)) and ('$' == data[0]):[m
             ans = int(data[1:], 16)[m
             # print(f"data[1:]={data[1:]} ans={ans}")[m
             return ans[m
[36m@@ -1680,7 +2184,7 @@[m [mclass TtlPaserWolker(ABC):[m
     def getKeywordName(self, data):[m
         """æ§‹æ–‡å†…ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åã‚’å–å¾—ã™ã‚‹"""[m
         # print(f"keywordName {data}")[m
[31m-        if "name" not in data:[m
[32m+[m[32m        if 'name' not in data:[m
             if isinstance(data, str):[m
                 return data[m
             elif isinstance(data, list):[m
[36m@@ -1688,14 +2192,14 @@[m [mclass TtlPaserWolker(ABC):[m
             raise TypeError("keywordName name not in data")[m
         #[m
         # this is dict[m
[31m-        if "StrExpressionContext" == data["name"]:[m
[31m-            return self.getKeywordName(data["child"][0])[m
[31m-        elif "KeywordContext" != data["name"]:[m
[32m+[m[32m        if 'StrExpressionContext' == data['name']:[m
[32m+[m[32m            return self.getKeywordName(data['child'][0])[m
[32m+[m[32m        elif 'KeywordContext' != data['name']:[m
             raise TypeError([m
                 f"### l={data['line']} keywordName name is not KeywordContext {data}"[m
             )[m
         #[m
[31m-        data = data["child"][m
[32m+[m[32m        data = data['child'][m
         # print(f"data={data} len={len(data)}")[m
         if len(data) == 1:[m
             # å˜ç´”æŒ‡å®š[m
[36m@@ -1704,7 +2208,7 @@[m [mclass TtlPaserWolker(ABC):[m
             # é…åˆ—å¯¾ç­–[m
             index = data[2][m
             index = self.getData(index)[m
[31m-            return data[0] + "[" + str(int(index)) + "]"[m
[32m+[m[32m            return data[0] + '[' + str(int(index)) + ']'[m
 [m
     def keywordContext(self, data):[m
         """æ§‹æ–‡å†…ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰å€¤ã‚’æŠ½å‡ºã™ã‚‹"""[m
[36m@@ -1749,74 +2253,119 @@[m [mclass TtlPaserWolker(ABC):[m
         """æ¥ç¶šã™ã‚‹"""[m
         # print(f"do connect data={data}")[m
         if self.client is not None:[m
[31m-            self.setValue("error", "Already connected")[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('error', 'Already connected')[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         param_list = re.split(r"[ \t]+", data)[m
[31m-        server = "localhost"[m
[32m+[m[32m        server = 'localhost'[m
         user = None[m
         passwd = None[m
         keyfile = None[m
[31m-        port_number = 22[m
[32m+[m[32m        com_key = None[m
[32m+[m[32m        port_number = None[m
         param_cmd = False[m
[32m+[m[32m        telnet = False[m
[32m+[m[32m        telnet_t = 0[m
         for param in param_list:[m
             if len(param) <= 0:[m
                 continue[m
[31m-            if param[0] != "/":[m
[31m-                server = param.split(":")[m
[32m+[m[32m            if param[0] != '/':[m
[32m+[m[32m                server = param.split(':')[m
                 if len(server) == 1:[m
                     server = server[0][m
                 elif len(server) == 2:[m
                     port_number = int(server[1])[m
                     server = server[0][m
                 else:[m
[31m-                    self.setValue("error", "Invalid server name")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                    self.setValue('error', 'Invalid server name')[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
             else:[m
[31m-                user_string = "user="[m
[31m-                passwd_string = "passwd="[m
[31m-                keyfile_string = "keyfile="[m
[32m+[m[32m                user_string = 'user='[m
[32m+[m[32m                passwd_string = 'passwd='[m
[32m+[m[32m                keyfile_string = 'keyfile='[m
[32m+[m[32m                com_string = 'C='[m
                 param = param[1:][m
                 # print(f"\tparam={param}")[m
                 if "ssh" == param:[m
                     pass[m
[31m-                elif "1" == param:[m
[31m-                    self.setValue("error", "SSH1 not support")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                elif '1' == param:[m
[32m+[m[32m                    self.setValue('error', 'SSH1 not support')[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
[31m-                elif "2" == param:[m
[32m+[m[32m                elif '2' == param:[m
                     pass  # SSH2[m
[31m-                elif "cmd" == param:[m
[32m+[m[32m                elif 'cmd' == param:[m
                     param_cmd = True[m
[31m-                elif "ask4passwd" == param:[m
[31m-                    self.setValue("error", "Not Support ask4passwd error!")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                elif 't=0' == param.lower():[m
[32m+[m[32m                    telnet_t = 0[m
[32m+[m[32m                elif 't=1' == param.lower():[m
[32m+[m[32m                    telnet_t = 1[m
[32m+[m[32m                elif 'nossh' == param.lower():[m
[32m+[m[32m                    telnet = True[m
[32m+[m[32m                elif 'ask4passwd' == param:[m
[32m+[m[32m                    self.setValue('error', 'Not Support ask4passwd error!')[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
[31m-                elif "auth=password" == param:[m
[32m+[m[32m                elif 'auth=password' == param:[m
                     pass  # ã‚ã‹ã‚‰ã‚“[m
[31m-                elif "auth=publickey" == param:[m
[32m+[m[32m                elif 'auth=publickey' == param:[m
                     pass  # ã‚ã‹ã‚‰ã‚“[m
[31m-                elif "auth=challenge" == param:[m
[32m+[m[32m                elif 'auth=challenge' == param:[m
                     pass  # ã‚ã‹ã‚‰ã‚“[m
[31m-                elif re.search("^" + user_string, param):[m
[32m+[m[32m                elif re.search('^' + user_string, param):[m
                     user = param[len(user_string):][m
[31m-                elif re.search("^" + passwd_string, param):[m
[32m+[m[32m                elif re.search('^' + passwd_string, param):[m
                     passwd = param[len(passwd_string):][m
[31m-                elif re.search("^" + keyfile_string, param):[m
[32m+[m[32m                elif re.search('^' + keyfile_string, param):[m
                     keyfile = param[len(keyfile_string):][m
                     keyfile = self.normpath(keyfile)[m
[32m+[m[32m                elif re.search('^' + com_string, param):[m
[32m+[m[32m                    com_key = param[len(com_string):][m
[32m+[m[32m                    com_key = self.normpath(com_key)[m
                 else:[m
                     # çŸ¥ã‚‰ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¥ãŸã‚‰åœæ­¢ã™ã‚‹[m
[31m-                    self.setValue("error", f"unkown paramater={param}")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                    self.setValue('error', f"unkown paramater={param}")[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
         #[m
         # å‰ã®æ¥ç¶šã¯å‰Šé™¤[m
         self.closeClient()[m
[32m+[m[32m        #[m
[32m+[m[32m        if port_number is None:  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å¤‰ãˆã¦ã„ãªã„å ´åˆ[m
[32m+[m[32m            if telnet:[m
[32m+[m[32m                port_number = 23[m
[32m+[m[32m            else:[m
[32m+[m[32m                port_number = 22[m
[32m+[m
         #[m
         # ã“ã“ã‹ã‚‰æ¥ç¶šå‡¦ç†[m
[31m-        if not param_cmd:[m
[32m+[m[32m        if com_key is not None:[m
[32m+[m[32m            try:[m
[32m+[m[32m                self.shell = MySerial([m
[32m+[m[32m                    com_key, self.speed,[m
[32m+[m[32m                    flowctrl=self.flowctrl,[m
[32m+[m[32m                    flowctrl_dtr=self.flowctrl_dtr,[m
[32m+[m[32m                    flowctrl_rts=self.flowctrl_rts)[m
[32m+[m[32m                self.setValue('result', 2)[m
[32m+[m[32m            except Exception as e:[m
[32m+[m[32m                self.setValue('error', f"### l={line} {type(e).__name__} e={e}")[m
[32m+[m[32m                self.setValue('result', 0)[m
[32m+[m[32m                self.closeClient()[m
[32m+[m[32m        elif telnet:[m
[32m+[m[32m            try:[m
[32m+[m[32m                client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)[m
[32m+[m[32m                client.connect((server, port_number))[m
[32m+[m[32m                if telnet_t == 0:[m
[32m+[m[32m                    self.shell = MyTelnetT0(client)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.shell = MyTelnetT1(client)[m
[32m+[m[32m                self.setValue('result', 2)[m
[32m+[m[32m            except Exception as e:[m
[32m+[m[32m                self.setValue('error', f"### l={line} {type(e).__name__} e={e}")[m
[32m+[m[32m                self.setValue('result', 0)[m
[32m+[m[32m                self.closeClient()[m
[32m+[m[32m        elif not param_cmd:[m
             try:[m
                 self.client = paramiko.SSHClient()[m
                 self.client.set_missing_host_key_policy(paramiko.AutoAddPolicy())[m
[36m@@ -1838,7 +2387,7 @@[m [mclass TtlPaserWolker(ABC):[m
                 #[m
                 # æ¥ç¶šæˆåŠŸ[m
                 #[m
[31m-                self.setValue("result", 2)[m
[32m+[m[32m                self.setValue('result', 2)[m
                 self.log_connect_time = time.time()[m
                 # print("connect OK !")[m
                 #[m
[36m@@ -1848,8 +2397,8 @@[m [mclass TtlPaserWolker(ABC):[m
                 paramiko.AuthenticationException,[m
                 paramiko.SSHException,[m
             ) as e:[m
[31m-                self.setValue("error", f"### l={line} {type(e).__name__} e={e}")[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('error', f"### l={line} {type(e).__name__} e={e}")[m
[32m+[m[32m                self.setValue('result', 0)[m
                 self.closeClient()[m
         else:[m
             if platform.system().lower() == "linux":[m
[36m@@ -1860,7 +2409,7 @@[m [mclass TtlPaserWolker(ABC):[m
                 self.shell = MyShell()[m
             #[m
             # æ¥ç¶šæˆåŠŸ[m
[31m-            self.setValue("result", 2)[m
[32m+[m[32m            self.setValue('result', 2)[m
 [m
     def doDispstr(self, data_list):[m
         for data in data_list:[m
[36m@@ -1877,7 +2426,7 @@[m [mclass TtlPaserWolker(ABC):[m
         """getmodemstatus å‡¦ç†ç”¨"""[m
         # print(f"{p1}")[m
         self.setValue(p1, 0)[m
[31m-        self.setValue("result", 1)  # å¿…ãšå¤±æ•—[m
[32m+[m[32m        self.setValue('result', 1)  # å¿…ãšå¤±æ•—[m
 [m
     def doGethostname(self, p1):[m
         """ãƒ›ã‚¹ãƒˆåã®å–å¾—"""[m
[36m@@ -1893,9 +2442,9 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def doTestlink(self):[m
         if self.shell is None or not self.shell.active:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         else:[m
[31m-            self.setValue("result", 2)[m
[32m+[m[32m            self.setValue('result', 2)[m
 [m
     def doSend(self, data_list):[m
         # print(f"doSend() d={data_list}")[m
[36m@@ -1951,7 +2500,7 @@[m [mclass TtlPaserWolker(ABC):[m
     def doFlushrecv(self):[m
         """do flush"""[m
         # ã™ã§ã«èª­ã‚“ã ã‚‚ã®ã‚’ç©ºã«ã™ã‚‹[m
[31m-        self.stdout = ""[m
[32m+[m[32m        self.stdout = ''[m
         #[m
         # ã¾ã èª­ã‚ã¦ãªã„ã‚‚ã®ã‚’ç©ºã«ã™ã‚‹[m
         while not self.end_flag:[m
[36m@@ -1963,9 +2512,10 @@[m [mclass TtlPaserWolker(ABC):[m
             if not local_ssh.recv_ready():[m
                 break[m
             #[m
[31m-            output = local_ssh.recv(1024).decode("utf-8")[m
[32m+[m[32m            output = local_ssh.recv(1024).decode('utf-8', errors='xmlcharrefreplace')[m
             if output is None:[m
                 break[m
[32m+[m[32m            output = self.split_escape(output)  # escapeæ–‡å­—ã‚’å¹ãé£›ã°ã™[m
             self.setLogInner(output)[m
 [m
     def doWaitAll(self, result_list):[m
[36m@@ -1974,7 +2524,7 @@[m [mclass TtlPaserWolker(ABC):[m
         now_time = time.time()[m
         result = 0[m
         hit_flag = False[m
[31m-        self.setValue("result", 0)[m
[32m+[m[32m        self.setValue('result', 0)[m
         while not self.end_flag and not hit_flag:[m
             #[m
             if m_timeout != 0:[m
[36m@@ -2006,7 +2556,7 @@[m [mclass TtlPaserWolker(ABC):[m
                 # print(f"remain1=/{self.stdout}/ cutlen={max + result_len}")[m
                 self.stdout = self.stdout[max + result_len:][m
                 # print(f"remain2=/{self.stdout.strip()}/")[m
[31m-                self.setValue("result", result)[m
[32m+[m[32m                self.setValue('result', result)[m
                 # ãƒ’ãƒƒãƒˆã—ã¦ã„ãŸã‚‰çµ‚äº†[m
                 break[m
             #[m
[36m@@ -2018,10 +2568,12 @@[m [mclass TtlPaserWolker(ABC):[m
             if local_ssh.recv_ready():[m
                 now_time = time.time()  # æœ€å¾Œã®æ™‚é–“æ›´æ–°[m
                 # print("recv start! ============")[m
[31m-                output = local_ssh.recv(1024).decode("utf-8")[m
[32m+[m[32m                output = local_ssh.recv(1024)[m
                 # print(f"recv! end {output} ============")[m
                 if output is None:[m
                     break[m
[32m+[m[32m                output = output.decode('utf-8', errors='xmlcharrefreplace')[m
[32m+[m[32m                output = self.split_escape(output)  # escapeæ–‡å­—ã‚’å¹ãé£›ã°ã™[m
                 self.setLogInner(output)[m
                 self.stdout = self.stdout + output[m
                 #[m
[36m@@ -2031,10 +2583,10 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def getTimer(self) -> float:[m
         m_timeout = 0.0[m
[31m-        x = self.getValue("timeout", error_stop=False)[m
[32m+[m[32m        x = self.getValue('timeout', error_stop=False)[m
         if x is not None:[m
             m_timeout = int(x)[m
[31m-        x = self.getValue("mtimeout", error_stop=False)[m
[32m+[m[32m        x = self.getValue('mtimeout', error_stop=False)[m
         if x is not None:[m
             m_timeout = m_timeout + (int(x) / 1000)[m
         return m_timeout[m
[36m@@ -2093,7 +2645,7 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚ã‚Šãªã‚‰æœ€åˆã«æ›¸ãè¾¼ã‚€[m
         if self.log_timestamp_type != -1:[m
[31m-            self.log_file_handle.write(self.getTimestamp().encode("utf-8"))[m
[32m+[m[32m            self.log_file_handle.write(self.getTimestamp().encode('utf-8'))[m
 [m
     def doLogpause(self):[m
         self.log_start = False[m
[36m@@ -2106,7 +2658,7 @@[m [mclass TtlPaserWolker(ABC):[m
         self.log_start = True[m
 [m
     def doLogwrite(self, strvar: str):[m
[31m-        """ç„¡æ¡ä»¶ã§æ›¸ãè¾¼ã‚€"""[m
[32m+[m[32m        """ log write """[m
         if self.log_file_handle is None:[m
             # ãƒ­ã‚°ãŒé–‹ã‹ã‚Œã¦ã„ãªã„[m
             return[m
[36m@@ -2114,34 +2666,34 @@[m [mclass TtlPaserWolker(ABC):[m
         if self.log_timestamp_type == -1:[m
             # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ä¸è¦[m
             if isinstance(strvar, str):[m
[31m-                strvar = strvar.encode("utf-8")[m
[32m+[m[32m                strvar = strvar.encode('utf-8')[m
             self.log_file_handle.write(strvar)[m
         else:[m
             # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹[m
             while True:[m
[31m-                if strvar == "":[m
[32m+[m[32m                if strvar == '':[m
                     break[m
                 index = strvar.find("\n")[m
                 if index < 0:[m
                     if isinstance(strvar, str):[m
[31m-                        strvar = strvar.encode("utf-8")[m
[32m+[m[32m                        strvar = strvar.encode('utf-8')[m
                     self.log_file_handle.write(strvar)[m
                     break[m
                 target = strvar[: index + 1][m
                 if isinstance(target, str):[m
[31m-                    target = target.encode("utf-8")[m
[32m+[m[32m                    target = target.encode('utf-8')[m
                 self.log_file_handle.write(target)[m
[31m-                self.log_file_handle.write(self.getTimestamp().encode("utf-8"))[m
[32m+[m[32m                self.log_file_handle.write(self.getTimestamp().encode('utf-8'))[m
                 strvar = strvar[index + 1:][m
 [m
     def getTimestamp(self) -> str:[m
         """ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å…¥ã‚Œã‚‹"""[m
         if self.log_timestamp_type == 0:[m
             # ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ [m
[31m-            return "[" + datetime.now().strftime("%Y-%m-%d %H:%M:%S") + "]"[m
[32m+[m[32m            return '[' + datetime.now().strftime('%Y-%m-%d %H:%M:%S') + ']'[m
         elif self.log_timestamp_type == 1:[m
             # UTC[m
[31m-            return "[" + datetime.now(timezone.utc).strftime("%Y-%m-%d %H:%M:%S") + "]"[m
[32m+[m[32m            return '[' + datetime.now(timezone.utc).strftime('%Y-%m-%d %H:%M:%S') + ']'[m
         elif self.log_timestamp_type == 2:[m
             # çµŒéæ™‚é–“ (Logging)[m
             return self.getTimestampElapsed(self.log_login_time)[m
[36m@@ -2161,8 +2713,12 @@[m [mclass TtlPaserWolker(ABC):[m
         return f"[{day} {hours:02}:{minutes:02}:{seconds:02}]"[m
 [m
     def setLogInner(self, strvar: str):[m
[31m-        """ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ãŒå¿…è¦ãªã‚‰ã“ã¡ã‚‰ã‚’ä½¿ã„ã¾ã™"""[m
[32m+[m[32m        """ ãƒ­ã‚°æ›¸ãè¾¼ã¿å‰ã«äº‹å‰å‡¦ç†ã‚’è¡Œã„ã¾ã™ """[m
         #[m
[32m+[m[32m        strvar = strvar.replace("\r\n", "\n")[m
[32m+[m[32m        strvar = strvar.replace("\r", "\n")[m
[32m+[m[32m        if "\n" != os.linesep:[m
[32m+[m[32m            strvar = strvar.replace("\n", os.linesep)[m
         # ãƒ­ã‚°å‡ºåŠ›/ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹æ–¹ã«æ¸¡ã™[m
         self.setLog(strvar)[m
         #[m
[36m@@ -2176,46 +2732,46 @@[m [mclass TtlPaserWolker(ABC):[m
         pass[m
 [m
     def doChecksum8(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.getChecksum(p1, p2_byte, 0x0F)[m
 [m
     def doChecksum8file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.getChecksum(p1, p2_byte, 0x0F)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doChecksum16(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.getChecksum(p1, p2_byte, 0xFF)[m
 [m
     def doChecksum16file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.getChecksum(p1, p2_byte, 0xFF)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doChecksum32(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.getChecksum(p1, p2_byte, 0xFFFF)[m
 [m
     def doChecksum32file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.getChecksum(p1, p2_byte, 0xFFFF)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def getChecksum(self, p1: str, p2_byte, mask: int):[m
         sum = 0[m
[36m@@ -2225,18 +2781,18 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(p1, sum)[m
 [m
     def doCrc16(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.crc16_IBM_SDLC(p1, p2_byte)[m
 [m
     def doCrc16file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.crc16_IBM_SDLC(p1, p2_byte)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def crc16_IBM_SDLC(self, p1: str, data: bytes):[m
         r = 0xFFFF[m
[36m@@ -2251,18 +2807,18 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(p1, r)[m
 [m
     def doCrc32(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.crc32_IBM_SDLC(p1, p2_byte)[m
 [m
     def doCrc32file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.crc32_IBM_SDLC(p1, p2_byte)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def crc32_IBM_SDLC(self, p1: str, data: bytes):[m
         r = 0xFFFFFFFF[m
[36m@@ -2284,31 +2840,31 @@[m [mclass TtlPaserWolker(ABC):[m
         show = 1  # SW_SHOWNORMAL[m
         if 2 <= (data_len):[m
             show = self.getData(data_line[1]).lower()[m
[31m-            if "show" == show:[m
[32m+[m[32m            if 'show' == show:[m
                 pass[m
[31m-            elif "minimize" == show:[m
[32m+[m[32m            elif 'minimize' == show:[m
                 show = 6  # SW_MINIMIZE[m
[31m-            elif "maximize" == show:[m
[32m+[m[32m            elif 'maximize' == show:[m
                 show = 3  # SW_MAXIMIZE[m
[31m-            elif "hide" == show:[m
[32m+[m[32m            elif 'hide' == show:[m
                 show = 0  # SW_HIDE[m
             else:[m
                 raise TypeError(f"### l={line} doExec type error")[m
         wait = 0[m
         if 3 <= (data_len):[m
             wait = self.getDataInt(data_line[2])[m
[31m-        base_directory = "."[m
[32m+[m[32m        base_directory = '.'[m
         if 4 <= (data_len):[m
             base_directory = self.getData(data_line[3])[m
             if not os.path.isdir(base_directory):[m
[31m-                base_directory = "."[m
[32m+[m[32m                base_directory = '.'[m
         # print(f"\tcommand_list={command_list}")[m
         # print(f"\tshow={show}")[m
         # print(f"\twait={wait}")[m
         # print(f"\tbase_directory={base_directory}")[m
         #[m
         si = None[m
[31m-        if platform.system().lower() != "linux":[m
[32m+[m[32m        if platform.system().lower() != 'linux':[m
             si = subprocess.STARTUPINFO()[m
             si.dwFlags |= subprocess.STARTF_USESHOWWINDOW[m
             si.wShowWindow = 0  # SW_HIDE[m
[36m@@ -2317,9 +2873,9 @@[m [mclass TtlPaserWolker(ABC):[m
         )[m
         if wait != 0:[m
             p.wait()  # ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚äº†ã™ã‚‹ã¾ã§å¾…æ©Ÿ[m
[31m-            self.setValue("result", p.returncode)[m
[32m+[m[32m            self.setValue('result', p.returncode)[m
 [m
[31m-    def doGetdate(self, data_line, format="%Y-%m-%d"):[m
[32m+[m[32m    def doGetdate(self, data_line, format='%Y-%m-%d'):[m
         date = self.getKeywordName(data_line[0])[m
         data_len = len(data_line)[m
         if 2 <= data_len:[m
[36m@@ -2329,7 +2885,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # print(f"timezone={local_timezone}")[m
         if 3 <= data_len:[m
             local_timezone = self.getData(data_line[2])[m
[31m-        date_str = ""[m
[32m+[m[32m        date_str = ''[m
         if local_timezone is None:[m
             local_now = datetime.now()[m
         else:[m
[36m@@ -2338,25 +2894,25 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(date, date_str)[m
 [m
     def doExpandenv(self, p1, p2):[m
[31m-        if platform.system().lower() != "linux":[m
[32m+[m[32m        if platform.system().lower() != 'linux':[m
             p2 = os.path.expandvars(p2)[m
         else:[m
             pattern = r"%(.*?)%"[m
             p2 = re.sub(pattern, lambda match: f"%{match.group(1).lower()}%", p2)[m
[31m-            p2 = p2.replace("%windir%", "c:\\windows")[m
[31m-            p2 = p2.replace("%systemroot%", "/root")[m
[31m-            p2 = p2.replace("%programfiles%", "/usr/local")[m
[31m-            p2 = p2.replace("%programfiles(x86)%", "/usr/local")[m
[31m-            p2 = p2.replace("%userprofile%", os.environ.get("HOME"))[m
[31m-            p2 = p2.replace("%appdata%", "/usr/local")[m
[31m-            p2 = p2.replace("%localappdata%", "/usr/local")[m
[31m-            p2 = p2.replace("%temp%", "/tmp")[m
[31m-            p2 = p2.replace("%tmp%", "/tmp")[m
[31m-            p2 = p2.replace("%computerprogramfiles%", "/usr/local")[m
[31m-            p2 = p2.replace("%public%", os.environ.get("HOME"))[m
[31m-            p2 = p2.replace("%computername%", socket.gethostname())[m
[31m-            p2 = p2.replace("%username%", getpass.getuser())[m
[31m-            p2 = p2.replace("%path%", os.environ.get("PATH"))[m
[32m+[m[32m            p2 = p2.replace('%windir%', 'c:\\windows')[m
[32m+[m[32m            p2 = p2.replace('%systemroot%', '/root')[m
[32m+[m[32m            p2 = p2.replace('%programfiles%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%programfiles(x86)%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%userprofile%', os.environ.get('HOME'))[m
[32m+[m[32m            p2 = p2.replace('%appdata%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%localappdata%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%temp%', '/tmp')[m
[32m+[m[32m            p2 = p2.replace('%tmp%', '/tmp')[m
[32m+[m[32m            p2 = p2.replace('%computerprogramfiles%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%public%', os.environ.get('HOME'))[m
[32m+[m[32m            p2 = p2.replace('%computername%', socket.gethostname())[m
[32m+[m[32m            p2 = p2.replace('%username%', getpass.getuser())[m
[32m+[m[32m            p2 = p2.replace('%path%', os.environ.get('PATH'))[m
         #[m
         self.setValue(p1, p2)[m
 [m
[36m@@ -2370,7 +2926,7 @@[m [mclass TtlPaserWolker(ABC):[m
         strvar = format % tuple(data_new)[m
         # print(f"strvar={strvar}")[m
         self.setValue(inputstr, strvar)[m
[31m-        self.setValue("result", 0)[m
[32m+[m[32m        self.setValue('result', 0)[m
 [m
     def doPause(self, p1):[m
         """æŒ‡å®šã•ã‚ŒãŸç§’æ•°å¾…ã¤"""[m
[36m@@ -2391,7 +2947,7 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def doStrtrim(self, p1_var: str, p2: str) -> str:[m
         # ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’å¤‰æ›ã™ã‚‹[m
[31m-        p2 = p2.encode().decode("unicode_escape")[m
[32m+[m[32m        p2 = p2.encode().decode('unicode_escape', errors='xmlcharrefreplace')[m
 [m
         # å‰æ–¹æ–¹å‘[m
         while 0 < len(p1_var):[m
[36m@@ -2414,24 +2970,24 @@[m [mclass TtlPaserWolker(ABC):[m
         worker = {}[m
         filename = self.normpath(filename)[m
         worker = self.get_encrypt_file(filename)[m
[31m-        encrypt_byte = encrypt_str.encode("utf-8")[m
[32m+[m[32m        encrypt_byte = encrypt_str.encode('utf-8')[m
         encrypt_byte = encrypt_byte.ljust(32, b"\0")  # 32byteä»¥ä¸‹ãªã‚‰å¢—ã‚„ã™[m
         encrypt_byte = encrypt_byte[:32]  # 32byteä»¥ä¸Šã‚’ç„¡è¦–ã™ã‚‹[m
         encrypt_byte = base64.urlsafe_b64encode(encrypt_byte)[m
         cipher = Fernet(encrypt_byte)[m
         #[m
[31m-        target_0 = password.encode("utf-8")  # æ–‡å­—ã‚’ã‚»ãƒƒãƒˆ[m
[31m-        target_1 = f"{password}_{encrypt_str}".encode("utf-8")[m
[32m+[m[32m        target_0 = password.encode('utf-8')  # æ–‡å­—ã‚’ã‚»ãƒƒãƒˆ[m
[32m+[m[32m        target_1 = f"{password}_{encrypt_str}".encode('utf-8')[m
         # print(f"d {password_name} {password} 0={target_0}")[m
         target_0 = cipher.encrypt(target_0)  # byteåˆ—ã«å¤‰æ›´ã—ã¦æš—å·åŒ–[m
         target_1 = cipher.encrypt(target_1)[m
[31m-        target_0 = base64.b64encode(target_0).decode()  # base64ã«å¤‰æ›´ã—ã¦æ–‡å­—ã«ã™ã‚‹[m
[31m-        target_1 = base64.b64encode(target_1).decode()[m
[32m+[m[32m        target_0 = base64.b64encode(target_0).decode('utf-8', errors='xmlcharrefreplace')  # base64ã«å¤‰æ›´ã—ã¦æ–‡å­—ã«ã™ã‚‹[m
[32m+[m[32m        target_1 = base64.b64encode(target_1).decode('utf-8', errors='xmlcharrefreplace')[m
         worker[password_name] = [target_0, target_1][m
         # print(f"c {password_name} {password}  0={target_0}")[m
         result = self.set_encrypt_file(filename, worker)[m
         # print(f"doSetpassword2 str={filename} p={password_name} p={password} w={worker}")[m
[31m-        self.setValue("result", result)[m
[32m+[m[32m        self.setValue('result', result)[m
         # print(f"doSetpassword3 str={filename} p={password_name} p={password} w={worker}")[m
 [m
     def doGetpassword([m
[36m@@ -2442,7 +2998,7 @@[m [mclass TtlPaserWolker(ABC):[m
         worker = self.get_encrypt_file(filename)[m
         # print(f"doGetpassword worker={worker}")[m
         if password_name in worker and 2 <= len(worker[password_name]):[m
[31m-            encrypt_byte = encrypt_str.encode("utf-8")[m
[32m+[m[32m            encrypt_byte = encrypt_str.encode('utf-8')[m
             encrypt_byte = encrypt_byte.ljust(32, b"\0")  # 32byteä»¥ä¸‹ãªã‚‰å¢—ã‚„ã™[m
             encrypt_byte = encrypt_byte[:32]  # 32byteä»¥ä¸Šã‚’ç„¡è¦–ã™ã‚‹[m
             encrypt_byte = base64.urlsafe_b64encode(encrypt_byte)[m
[36m@@ -2452,22 +3008,22 @@[m [mclass TtlPaserWolker(ABC):[m
             target_0 = base64.b64decode(worker[password_name][0].encode())[m
             target_1 = base64.b64decode(worker[password_name][1].encode())[m
             try:[m
[31m-                target_0 = cipher.decrypt(target_0).decode("utf-8")[m
[31m-                target_1 = cipher.decrypt(target_1).decode("utf-8")[m
[32m+[m[32m                target_0 = cipher.decrypt(target_0).decode('utf-8', errors='xmlcharrefreplace')[m
[32m+[m[32m                target_1 = cipher.decrypt(target_1).decode('utf-8', errors='xmlcharrefreplace')[m
             except InvalidToken:[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
                 return[m
             # print(f"e {password_name} 0={target_0}")[m
             # print(f"e {password_name} 0={target_1}")[m
             #[m
             if f"{target_0}_{encrypt_str}" == target_1:[m
                 self.setValue(p3, target_0)[m
[31m-                self.setValue("result", 1)[m
[32m+[m[32m                self.setValue('result', 1)[m
             else:[m
                 # encriptãŒä¸€è‡´ã—ãªã‹ã£ãŸ[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doIspassword(self, filename: str, password_name: str):[m
         # print(f"doGetpassword p3={p3}")[m
[36m@@ -2475,9 +3031,9 @@[m [mclass TtlPaserWolker(ABC):[m
         worker = self.get_encrypt_file(filename)[m
         # print(f"doGetpassword worker={worker}")[m
         if password_name in worker:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doDelpassword(self, filename: str, password_name: str):[m
         # print(f"doGetpassword p3={p3}")[m
[36m@@ -2498,7 +3054,7 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         # ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿[m
         try:[m
[31m-            with open(filename, "wt") as f:[m
[32m+[m[32m            with open(filename, 'wt') as f:[m
                 f.write(original_text)[m
         except (FileNotFoundError, IOError):[m
             return 0[m
[36m@@ -2516,7 +3072,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã™ã‚‹[m
         worker = {}[m
         try:[m
[31m-            with open(filename, "rt") as f:[m
[32m+[m[32m            with open(filename, 'rt') as f:[m
                 worker = json.loads(f.read())[m
                 self.encrypt_file[filename] = worker[m
         except (FileNotFoundError, IOError, json.decoder.JSONDecodeError):[m
[36m@@ -2531,30 +3087,30 @@[m [mclass TtlPaserWolker(ABC):[m
             self.doFileClose(file_handle)[m
         filename = self.normpath(filename)[m
         self.file_handle_list[file_handle] = {}[m
[31m-        self.file_handle_list[file_handle]["file_handle"] = None[m
[31m-        self.file_handle_list[file_handle]["filename"] = filename[m
[31m-        self.file_handle_list[file_handle]["append_flag"] = append_flag[m
[31m-        self.file_handle_list[file_handle]["readonly_flag"] = readonly_flag[m
[31m-        self.getValue("result", 0)[m
[32m+[m[32m        self.file_handle_list[file_handle]['file_handle'] = None[m
[32m+[m[32m        self.file_handle_list[file_handle]['filename'] = filename[m
[32m+[m[32m        self.file_handle_list[file_handle]['append_flag'] = append_flag[m
[32m+[m[32m        self.file_handle_list[file_handle]['readonly_flag'] = readonly_flag[m
[32m+[m[32m        self.getValue('result', 0)[m
 [m
     def doFindfirst(self, line, file_handle, file_name: str, strvar: str):[m
         """ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ³ãƒ‰ãƒ«ã‚’ä½œã‚‹"""[m
         if file_handle in self.file_handle_list:[m
             self.doFileClose(file_handle)[m
         self.file_handle_list[file_handle] = {}[m
[31m-        self.file_handle_list[file_handle]["file_handle"] = MyFindfirst(file_name)[m
[31m-        self.file_handle_list[file_handle]["filename"] = file_name[m
[31m-        self.file_handle_list[file_handle]["append_flag"] = False[m
[31m-        self.file_handle_list[file_handle]["readonly_flag"] = True[m
[32m+[m[32m        self.file_handle_list[file_handle]['file_handle'] = MyFindfirst(file_name)[m
[32m+[m[32m        self.file_handle_list[file_handle]['filename'] = file_name[m
[32m+[m[32m        self.file_handle_list[file_handle]['append_flag'] = False[m
[32m+[m[32m        self.file_handle_list[file_handle]['readonly_flag'] = True[m
         self.doFindnext(line, file_handle, strvar)[m
 [m
     def doFindnext(self, line, file_handle, strvar: str):[m
         """æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã™ã‚‹"""[m
         self.doFilereadln(line, file_handle, strvar)[m
[31m-        if self.getValue("result") == 0:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m        if self.getValue('result') == 0:[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFileclose(self, file_handle):[m
         """ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ³ãƒ‰ãƒ«ãŒã„ãŸã‚‰æ¶ˆã™"""[m
[36m@@ -2565,7 +3121,7 @@[m [mclass TtlPaserWolker(ABC):[m
         self.file_handle_list[file_handle] = None[m
         del self.file_handle_list[file_handle][m
         #[m
[31m-        file_handle_file = file_handle_base["file_handle"][m
[32m+[m[32m        file_handle_file = file_handle_base['file_handle'][m
         if file_handle_file is None:[m
             return[m
         try:[m
[36m@@ -2577,23 +3133,23 @@[m [mclass TtlPaserWolker(ABC):[m
         if file_handle not in self.file_handle_list:[m
             raise TypeError(f"### l={line} file_handle not found f={file_handle}")[m
         file_handle_base = self.file_handle_list[file_handle][m
[31m-        file_handle_file = file_handle_base["file_handle"][m
[32m+[m[32m        file_handle_file = file_handle_base['file_handle'][m
         if file_handle_file is None:[m
             option = 'wb'[m
[31m-            if file_handle_base["append_flag"] != 0:[m
[32m+[m[32m            if file_handle_base['append_flag'] != 0:[m
                 option = 'ab'[m
[31m-            file_handle_file = open(file_handle_base["filename"], option)[m
[31m-            file_handle_base["file_handle"] = file_handle_file[m
[31m-        file_handle_file.write(data.encode("utf-8"))[m
[32m+[m[32m            file_handle_file = open(file_handle_base['filename'], option)[m
[32m+[m[32m            file_handle_base['file_handle'] = file_handle_file[m
[32m+[m[32m        file_handle_file.write(data.encode('utf-8'))[m
 [m
     def openHandle(self, line, file_handle):[m
         if file_handle not in self.file_handle_list:[m
             raise TypeError(f"### l={line} file_handle not found f={file_handle}")[m
         file_handle_base = self.file_handle_list[file_handle][m
[31m-        file_handle_file = file_handle_base["file_handle"][m
[32m+[m[32m        file_handle_file = file_handle_base['file_handle'][m
         if file_handle_file is None:[m
[31m-            file_handle_file = open(file_handle_base["filename"], "rb")[m
[31m-            file_handle_base["file_handle"] = file_handle_file[m
[32m+[m[32m            file_handle_file = open(file_handle_base['filename'], 'rb')[m
[32m+[m[32m            file_handle_base['file_handle'] = file_handle_file[m
         return file_handle_file[m
 [m
     def doFileread(self, line, file_handle, read_byte, strvar):[m
[36m@@ -2601,61 +3157,63 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         text = file_handle_file.read(read_byte)[m
         if text is not None:[m
[31m-            self.setValue(strvar, text.decode())[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue(strvar, text.decode('utf-8', errors='xmlcharrefreplace'))[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue(strvar, "")[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue(strvar, '')[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilereadln(self, line, file_handle, strvar):[m
         file_handle_file = self.openHandle(line, file_handle)[m
         #[m
         try:[m
             text = file_handle_file.readline()[m
[31m-            self.setValue(strvar, text.decode())[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            text = text.decode('utf-8', errors='xmlcharrefreplace')[m
[32m+[m[32m            text = text.rstrip('\n').rstrip('\r')[m
[32m+[m[32m            self.setValue(strvar, text)[m
[32m+[m[32m            self.setValue('result', 0)[m
         except OSError:[m
[31m-            self.setValue(strvar, "")[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue(strvar, '')[m
[32m+[m[32m            self.setValue('result', 1)[m
 [m
     def doFileconcat(self, p1, p2):[m
         p1 = self.normpath(p1)[m
         p2 = self.normpath(p2)[m
         if p1 == p2:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
[31m-            with open(p1, "ab") as f1:[m
[31m-                with open(p2, "rb") as f2:[m
[32m+[m[32m            with open(p1, 'ab') as f1:[m
[32m+[m[32m                with open(p2, 'rb') as f2:[m
                     f1.write(f2.read())[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilecopy(self, p1, p2):[m
         p1 = self.normpath(p1)[m
         p2 = self.normpath(p2)[m
         if p1 == p2:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
[31m-            with open(p1, "rb") as f1:[m
[31m-                with open(p2, "wb") as f2:[m
[32m+[m[32m            with open(p1, 'rb') as f1:[m
[32m+[m[32m                with open(p2, 'wb') as f2:[m
                     f2.write(f1.read())[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFiledelete(self, filename):[m
         filename = self.normpath(filename)[m
         if not os.path.exists(filename):[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
             os.remove(filename)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilerename(self, p1, p2):[m
         p1 = self.normpath(p1)[m
[36m@@ -2663,18 +3221,18 @@[m [mclass TtlPaserWolker(ABC):[m
         # print(f"doFilerename0 {p1} {p2}")[m
         if p1 == p2:[m
             # print(f"doFilerename1 {p1} {p2}")[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
             return[m
         if not os.path.exists(p1):[m
             # print(f"doFilerename2 {p1} {p2}")[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
             return[m
         self.doFiledelete(p2)[m
         try:[m
             os.rename(p1, p2)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         except OSError:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
 [m
     def doStrreplace(self, strvar, strvar_val, index, regex, newstr):[m
         strvar_pre = strvar_val[0:index][m
[36m@@ -2682,31 +3240,31 @@[m [mclass TtlPaserWolker(ABC):[m
         strvar_val = strvar_pre + re.sub(regex, newstr, strvar_val)[m
         try:[m
             self.setValue(strvar, strvar_val)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except (re.error, TypeError, ValueError):[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doStrmatch(self, target_string, string_with_regular_expressio):[m
         # print(f"strmatch {target_string} {string_with_regular_expressio}")[m
         match = re.search(string_with_regular_expressio, target_string)[m
         if match:[m
             # print(f"hit strmatch {target_string} {string_with_regular_expressio}")[m
[31m-            self.setValue("result", match.start() + 1)[m
[32m+[m[32m            self.setValue('result', match.start() + 1)[m
             i = 0[m
             for grp in match.groups():[m
[31m-                self.setValue("groupmatchstr" + str(i + 1), grp)[m
[32m+[m[32m                self.setValue('groupmatchstr' + str(i + 1), grp)[m
                 i = i + 1[m
                 if 10 <= i:[m
                     break[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilesearch(self, filename):[m
         filename = self.normpath(filename)[m
         if os.path.exists(filename):[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilestat(self, filename, size, mtime, drive):[m
         try:[m
[36m@@ -2720,14 +3278,14 @@[m [mclass TtlPaserWolker(ABC):[m
             if drive is not None:[m
                 drive_val, xx = os.path.splitdrive(filename)[m
                 self.setValue(drive, drive_val)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         except FileNotFoundError:[m
             self.setValue(size, 0)[m
             if mtime is not None:[m
[31m-                self.setValue(mtime, "")[m
[32m+[m[32m                self.setValue(mtime, '')[m
             if drive is not None:[m
[31m-                self.setValue(drive, "")[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m                self.setValue(drive, '')[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doFiletruncate(self, filename: str, size: int):[m
         size_val = 0[m
[36m@@ -2742,41 +3300,41 @@[m [mclass TtlPaserWolker(ABC):[m
         try:[m
             if size < size_val:[m
                 # åˆ‡ã‚Šè©°ã‚ãŒå¿…è¦[m
[31m-                with open(filename, "r+b") as f:[m
[32m+[m[32m                with open(filename, 'r+b') as f:[m
                     fd = f.fileno()[m
                     os.truncate(fd, size)[m
             else:[m
                 # ã‚¼ãƒ­ãƒã‚¤ãƒˆåŠ ç®—[m
[31m-                with open(filename, "ab") as f:[m
[32m+[m[32m                with open(filename, 'ab') as f:[m
                     f.write(bytes(size - size_val))[m
         except OSError:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doFoldercreate(self, folder_name):[m
         try:[m
             folder_name = self.normpath(folder_name)[m
             os.mkdir(folder_name)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except FileNotFoundError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFolderdelete(self, folder_path):[m
         folder_path = self.normpath(folder_path)[m
         if not os.path.isdir(folder_path):[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
             os.rmdir(folder_path)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFoldersearch(self, folder_path):[m
         folder_path = self.normpath(folder_path)[m
         if os.path.isdir(folder_path):[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doMakepath(self, strvar, dir, name):[m
         dir = self.normpath(dir)[m
[36m@@ -2789,7 +3347,7 @@[m [mclass TtlPaserWolker(ABC):[m
         if ip is None:[m
             self.setValue(intvar, 0)[m
             return[m
[31m-        self.setValue(string_array + "[0]", ip)[m
[32m+[m[32m        self.setValue(string_array + '[0]', ip)[m
         self.setValue(intvar, 1)[m
 [m
     def doGetipv6addr(self, string_array, intvar):[m
[36m@@ -2797,7 +3355,7 @@[m [mclass TtlPaserWolker(ABC):[m
         i = 0[m
         if infos is None:[m
             self.setValue(intvar, 0)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         for info in infos:[m
             ipv6 = info[4][0][m
[36m@@ -2806,9 +3364,9 @@[m [mclass TtlPaserWolker(ABC):[m
             i = i + 1[m
         self.setValue(intvar, i)[m
         if 0 < i:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doGetver(self, strvar: str, target_version: float):[m
         """ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ± ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ä½¿ã£ã¦ãã ã•ã„"""[m
[36m@@ -2817,11 +3375,11 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(strvar, str(now_version))[m
         if target_version is not None:[m
             if now_version == target_version:[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
             elif now_version < target_version:[m
[31m-                self.setValue("result", -1)[m
[32m+[m[32m                self.setValue('result', -1)[m
             else:[m
[31m-                self.setValue("result", 1)[m
[32m+[m[32m                self.setValue('result', 1)[m
         # print("doGetver end")[m
 [m
     def setTitle(self, title: str):[m
[36m@@ -2846,15 +3404,15 @@[m [mclass TtlPaserWolker(ABC):[m
         else:[m
             for value in self.value_list:[m
                 # print(f"hit2 {value}/{strvar}")[m
[31m-                if strvar + "[" in value:[m
[32m+[m[32m                if strvar + '[' in value:[m
                     if isinstance(self.getValue(value), int):[m
                         result = 5[m
                     else:[m
                         result = 6[m
                     break[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         # print(f"doIfdefined v={strvar} d={result}")[m
[31m-        self.setValue("result", result)[m
[32m+[m[32m        self.setValue('result', result)[m
 [m
     def doScprecv(self, p1, p2):[m
         """SCP å—ä¿¡"""[m
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/version.py b/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/version.py[m
[1mindex 19be6cd..9f03427 100644[m
[1m--- a/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/version.py[m
[1m+++ b/forwsl2/collections/ansible_collections/tand0/ttl/plugins/module_utils/version.py[m
[36m@@ -1,2 +1,2 @@[m
 [m
[31m-VERSION = 1.26[m
[32m+[m[32mVERSION = 1.27[m
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/requirements.txt b/forwsl2/collections/ansible_collections/tand0/ttl/requirements.txt[m
[1mindex b1aa22e..6f355fd 100644[m
[1m--- a/forwsl2/collections/ansible_collections/tand0/ttl/requirements.txt[m
[1m+++ b/forwsl2/collections/ansible_collections/tand0/ttl/requirements.txt[m
[36m@@ -3,3 +3,4 @@[m [mantlr4-python3-runtime[m
 uptime[m
 pexpect[m
 cryptography[m
[32m+[m[32mpyserial[m
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/module_utils.version_1.stats b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/module_utils.version_1.stats[m
[1mindex 4d2d926..86f5595 100644[m
Binary files a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/module_utils.version_1.stats and b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/module_utils.version_1.stats differ
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/version_1.stats b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/version_1.stats[m
[1mindex 966d5e9..da6f44a 100644[m
Binary files a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/version_1.stats and b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/.tmp/pylint/version_1.stats differ
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-import-python-3.12.json b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-import-python-3.12.json[m
[1mindex a1d8b39..f1c4514 100644[m
[1m--- a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-import-python-3.12.json[m
[1m+++ b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-import-python-3.12.json[m
[36m@@ -3,7 +3,7 @@[m
     "results": [[m
         {[m
             "message": "The test `ansible-test sanity --test import --python 3.12` [[explain](https://docs.ansible.com/ansible-core/2.20/dev_guide/testing/sanity/import.html)] failed with 5 errors:", [m
[31m-            "output": "plugins/module_utils/ttl_parser_lexer.py:2:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_listener.py:2:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_parser.py:3:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_visitor.py:2:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_worker.py:362:0: traceback: NameError: name 'ErrorListener' is not defined"[m
[32m+[m[32m            "output": "plugins/module_utils/ttl_parser_lexer.py:2:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_listener.py:2:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_parser.py:3:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_visitor.py:2:0: traceback: ModuleNotFoundError: No module named 'antlr4'\nplugins/module_utils/ttl_parser_worker.py:17:0: traceback: ModuleNotFoundError: No module named 'serial'"[m
         }[m
     ], [m
     "verified": false[m
[1mdiff --git a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-pylint.json b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-pylint.json[m
[1mindex 94cfa4c..7cd1044 100644[m
[1m--- a/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-pylint.json[m
[1m+++ b/forwsl2/collections/ansible_collections/tand0/ttl/tests/output/bot/ansible-test-sanity-pylint.json[m
[36m@@ -3,7 +3,7 @@[m
     "results": [[m
         {[m
             "message": "The test `ansible-test sanity --test pylint` [[explain](https://docs.ansible.com/ansible-core/2.20/dev_guide/testing/sanity/pylint.html)] failed with 1 error:", [m
[31m-            "output": "plugins/modules/ttl.py:236:52: syntax-error: Parsing failed: 'unindent does not match any outer indentation level (ttl, line 236)'"[m
[32m+[m[32m            "output": "plugins/module_utils/ttl_parser_worker.py:848:20: ansible-bad-function: Call module.log or module.debug instead of builtins.print"[m
         }[m
     ], [m
     "verified": false[m
[1mdiff --git a/forwsl2/site_import.yml b/forwsl2/site_import.yml[m
[1mindex 658a459..119e881 100644[m
[1m--- a/forwsl2/site_import.yml[m
[1m+++ b/forwsl2/site_import.yml[m
[36m@@ -7936,7 +7936,455 @@[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-233 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-233 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    filename: 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: False[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-failed-233 True 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: (not ansible_check_mode) and (ttl_output.failed == True)[m
[32m+[m[32m- name: debug-stdout 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-234 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    cmd: |[m
[32m+[m[32m      command = "%systemroot%"[m
[32m+[m[32m      expandenv str command[m
[32m+[m[32m      strcompare str "/root"[m
[32m+[m[32m      if 0!=result then[m
[32m+[m[32m      assert 1 "this is not Linux" command[m
[32m+[m[32m      result = 1[m
[32m+[m[32m      end[m
[32m+[m[32m      endif[m
[32m+[m[32m      ; test for speed[m
[32m+[m[32m      setbaud  921600[m
[32m+[m[32m      setspeed 460800[m
[32m+[m[32m      setbaud  230400[m
[32m+[m[32m      setspeed 9600[m
[32m+[m[32m      ; RTS on[m
[32m+[m[32m      setrts 1[m
[32m+[m[32m      ; RTS off[m
[32m+[m[32m      setrts 0[m
[32m+[m[32m      ; DTR on[m
[32m+[m[32m      setdtr 1[m
[32m+[m[32m      ; DTR off[m
[32m+[m[32m      setdtr 0[m
[32m+[m[32m      ; test for flowcontrol[m
[32m+[m[32m      setflowctrl 1[m
[32m+[m[32m      setflowctrl 2[m
[32m+[m[32m      setflowctrl 4[m
[32m+[m[32m      setflowctrl 3[m
[32m+[m[32m      fileopen IN '../test_pty.key' 0[m
[32m+[m[32m      filereadln IN ttl_filename[m
[32m+[m[32m      fileclose IN[m
[32m+[m[32m      command = "/C="[m
[32m+[m[32m      strconcat command ttl_filename[m
[32m+[m[32m      connect command[m
[32m+[m[32m      assert result == 2 "connect serial fail test" command[m
[32m+[m[32m      sendln "ping localhost"[m
[32m+[m[32m      wait "$"[m
[32m+[m[32m      assert result == 1 "wait test"[m
[32m+[m[32m      sendln "exit"[m
[32m+[m[32m      closett[m
[32m+[m[32m      assert 1 "OK"[m
[32m+[m[32m      retult = 1[m
[32m+[m[32m      end[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: False[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-failed-234 True 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: (not ansible_check_mode) and (ttl_output.failed == True)[m
[32m+[m[32m- name: debug-stdout 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-235 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    filename: 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: True[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-changed-235 True 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: ttl_output.changed == True[m
[32m+[m[32m- name: debug-stdout 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-236 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    cmd: |[m
[32m+[m[32m      command = "%systemroot%"[m
[32m+[m[32m      expandenv str command[m
[32m+[m[32m      strcompare str "/root"[m
[32m+[m[32m      if 0!=result then[m
[32m+[m[32m      assert 1 "this is not Linux" command[m
[32m+[m[32m      result = 1[m
[32m+[m[32m      end[m
[32m+[m[32m      endif[m
[32m+[m[32m      ; test for speed[m
[32m+[m[32m      setbaud  921600[m
[32m+[m[32m      setspeed 460800[m
[32m+[m[32m      setbaud  230400[m
[32m+[m[32m      setspeed 9600[m
[32m+[m[32m      ; RTS on[m
[32m+[m[32m      setrts 1[m
[32m+[m[32m      ; RTS off[m
[32m+[m[32m      setrts 0[m
[32m+[m[32m      ; DTR on[m
[32m+[m[32m      setdtr 1[m
[32m+[m[32m      ; DTR off[m
[32m+[m[32m      setdtr 0[m
[32m+[m[32m      ; test for flowcontrol[m
[32m+[m[32m      setflowctrl 1[m
[32m+[m[32m      setflowctrl 2[m
[32m+[m[32m      setflowctrl 4[m
[32m+[m[32m      setflowctrl 3[m
[32m+[m[32m      fileopen IN '../test_pty.key' 0[m
[32m+[m[32m      filereadln IN ttl_filename[m
[32m+[m[32m      fileclose IN[m
[32m+[m[32m      command = "/C="[m
[32m+[m[32m      strconcat command ttl_filename[m
[32m+[m[32m      connect command[m
[32m+[m[32m      assert result == 2 "connect serial fail test" command[m
[32m+[m[32m      sendln "ping localhost"[m
[32m+[m[32m      wait "$"[m
[32m+[m[32m      assert result == 1 "wait test"[m
[32m+[m[32m      sendln "exit"[m
[32m+[m[32m      closett[m
[32m+[m[32m      assert 1 "OK"[m
[32m+[m[32m      retult = 1[m
[32m+[m[32m      end[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: True[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-changed-236 True 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: ttl_output.changed == True[m
[32m+[m[32m- name: debug-stdout 0058_ok_linux_serial_test.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-237 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    filename: 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: False[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-failed-237 True 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: (not ansible_check_mode) and (ttl_output.failed == True)[m
[32m+[m[32m- name: debug-stdout 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-238 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    cmd: |[m
[32m+[m[32m      ; ãªã‚“ã‹ã„ãŸã‚‰æ¶ˆã™[m
[32m+[m[32m      testlink[m
[32m+[m[32m      if result == 2 then[m
[32m+[m[32m      closett[m
[32m+[m[32m      endif[m
[32m+[m[32m      ; æ¥ç¶šã™ã‚‹[m
[32m+[m[32m      error=''[m
[32m+[m[32m      assert 1  "connect start"[m
[32m+[m[32m      connect 'localhost:2201 /nossh /T=0'[m
[32m+[m[32m      assert result ==2  "connect start" error result[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '$'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      sendln 'test'[m
[32m+[m[32m      wait 'test'[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '$' '#'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      sendln 'work'[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '#' '$'[m
[32m+[m[32m      assert result ==2  "wait test" error result[m
[32m+[m[32m      ; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹[m
[32m+[m[32m      timeout = 1[m
[32m+[m[32m      wait 'xxxx'[m
[32m+[m[32m      assert result ==0  "timeout test" error result[m
[32m+[m[32m      gethostname hostname[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      sendbreak[m
[32m+[m[32m      ; exit[m
[32m+[m[32m      send 'exit'[m
[32m+[m[32m      sendln[m
[32m+[m[32m      pause 2[m
[32m+[m[32m      disconnect[m
[32m+[m[32m      testlink[m
[32m+[m[32m      assert result != 2  "exit test" error ; ã¾ã æ¥ç¶šã§ãã¦ã„ã‚‹[m
[32m+[m[32m      closett[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      error=''[m
[32m+[m[32m      result = 1[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: False[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-failed-238 True 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: (not ansible_check_mode) and (ttl_output.failed == True)[m
[32m+[m[32m- name: debug-stdout 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-239 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    filename: 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: True[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-changed-239 True 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: ttl_output.changed == True[m
[32m+[m[32m- name: debug-stdout 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-240 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    cmd: |[m
[32m+[m[32m      ; ãªã‚“ã‹ã„ãŸã‚‰æ¶ˆã™[m
[32m+[m[32m      testlink[m
[32m+[m[32m      if result == 2 then[m
[32m+[m[32m      closett[m
[32m+[m[32m      endif[m
[32m+[m[32m      ; æ¥ç¶šã™ã‚‹[m
[32m+[m[32m      error=''[m
[32m+[m[32m      assert 1  "connect start"[m
[32m+[m[32m      connect 'localhost:2201 /nossh /T=0'[m
[32m+[m[32m      assert result ==2  "connect start" error result[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '$'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      sendln 'test'[m
[32m+[m[32m      wait 'test'[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '$' '#'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      sendln 'work'[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '#' '$'[m
[32m+[m[32m      assert result ==2  "wait test" error result[m
[32m+[m[32m      ; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹[m
[32m+[m[32m      timeout = 1[m
[32m+[m[32m      wait 'xxxx'[m
[32m+[m[32m      assert result ==0  "timeout test" error result[m
[32m+[m[32m      gethostname hostname[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      sendbreak[m
[32m+[m[32m      ; exit[m
[32m+[m[32m      send 'exit'[m
[32m+[m[32m      sendln[m
[32m+[m[32m      pause 2[m
[32m+[m[32m      disconnect[m
[32m+[m[32m      testlink[m
[32m+[m[32m      assert result != 2  "exit test" error ; ã¾ã æ¥ç¶šã§ãã¦ã„ã‚‹[m
[32m+[m[32m      closett[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      error=''[m
[32m+[m[32m      result = 1[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: True[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-changed-240 True 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: ttl_output.changed == True[m
[32m+[m[32m- name: debug-stdout 0059_ok_sendln_telnet_t0.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-241 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    filename: 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: False[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-failed-241 True 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: (not ansible_check_mode) and (ttl_output.failed == True)[m
[32m+[m[32m- name: debug-stdout 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-242 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    cmd: |[m
[32m+[m[32m      ; ãªã‚“ã‹ã„ãŸã‚‰æ¶ˆã™[m
[32m+[m[32m      testlink[m
[32m+[m[32m      if result == 2 then[m
[32m+[m[32m      closett[m
[32m+[m[32m      endif[m
[32m+[m[32m      ; æ¥ç¶šã™ã‚‹[m
[32m+[m[32m      error=''[m
[32m+[m[32m      ; assert 1  "connect start"[m
[32m+[m[32m      connect 'localhost:2202 /nossh /T=1'[m
[32m+[m[32m      assert result ==2  "connect start" error result[m
[32m+[m[32m      timeout = 20[m
[32m+[m[32m      command = 'ping -c 1 localhost'[m
[32m+[m[32m      sendln command[m
[32m+[m[32m      wait command[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      wait '$' '#'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      command = 'ping -c 1 localhost'[m
[32m+[m[32m      sendln command[m
[32m+[m[32m      wait command[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '$' '#'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      command = 'pwd'[m
[32m+[m[32m      sendln command[m
[32m+[m[32m      wait command[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '#' '$'[m
[32m+[m[32m      assert result ==2  "wait test" error result[m
[32m+[m[32m      ; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹[m
[32m+[m[32m      timeout = 1[m
[32m+[m[32m      wait 'xxxx'[m
[32m+[m[32m      assert result ==0  "timeout test" error result[m
[32m+[m[32m      gethostname hostname[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      sendbreak[m
[32m+[m[32m      ; exit[m
[32m+[m[32m      send 'exit'[m
[32m+[m[32m      sendln[m
[32m+[m[32m      pause 2[m
[32m+[m[32m      disconnect[m
[32m+[m[32m      testlink[m
[32m+[m[32m      assert result != 2  "exit test" error ; ã¾ã æ¥ç¶šã§ãã¦ã„ã‚‹[m
[32m+[m[32m      closett[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      error=''[m
[32m+[m[32m      result = 1[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: False[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-failed-242 True 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: (not ansible_check_mode) and (ttl_output.failed == True)[m
[32m+[m[32m- name: debug-stdout 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-243 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    filename: 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: True[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-changed-243 True 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: ttl_output.changed == True[m
[32m+[m[32m- name: debug-stdout 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-244 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  ttl:[m
[32m+[m[32m    cmd: |[m
[32m+[m[32m      ; ãªã‚“ã‹ã„ãŸã‚‰æ¶ˆã™[m
[32m+[m[32m      testlink[m
[32m+[m[32m      if result == 2 then[m
[32m+[m[32m      closett[m
[32m+[m[32m      endif[m
[32m+[m[32m      ; æ¥ç¶šã™ã‚‹[m
[32m+[m[32m      error=''[m
[32m+[m[32m      ; assert 1  "connect start"[m
[32m+[m[32m      connect 'localhost:2202 /nossh /T=1'[m
[32m+[m[32m      assert result ==2  "connect start" error result[m
[32m+[m[32m      timeout = 20[m
[32m+[m[32m      command = 'ping -c 1 localhost'[m
[32m+[m[32m      sendln command[m
[32m+[m[32m      wait command[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      wait '$' '#'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      command = 'ping -c 1 localhost'[m
[32m+[m[32m      sendln command[m
[32m+[m[32m      wait command[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '$' '#'[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      ; text[m
[32m+[m[32m      command = 'pwd'[m
[32m+[m[32m      sendln command[m
[32m+[m[32m      wait command[m
[32m+[m[32m      assert result ==1  "wait test" error result[m
[32m+[m[32m      result = 0[m
[32m+[m[32m      wait '#' '$'[m
[32m+[m[32m      assert result ==2  "wait test" error result[m
[32m+[m[32m      ; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹[m
[32m+[m[32m      timeout = 1[m
[32m+[m[32m      wait 'xxxx'[m
[32m+[m[32m      assert result ==0  "timeout test" error result[m
[32m+[m[32m      gethostname hostname[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      sendbreak[m
[32m+[m[32m      ; exit[m
[32m+[m[32m      send 'exit'[m
[32m+[m[32m      sendln[m
[32m+[m[32m      pause 2[m
[32m+[m[32m      disconnect[m
[32m+[m[32m      testlink[m
[32m+[m[32m      assert result != 2  "exit test" error ; ã¾ã æ¥ç¶šã§ãã¦ã„ã‚‹[m
[32m+[m[32m      closett[m
[32m+[m[32m      assert 1 "gethostname test" hostname[m
[32m+[m[32m      error=''[m
[32m+[m[32m      result = 1[m
[32m+[m[32m    chdir: ../test[m
[32m+[m[32m    ignore_result: False[m
[32m+[m[32m  check_mode: True[m
[32m+[m[32m  register: ttl_output[m
[32m+[m[32m  ignore_errors: False[m
[32m+[m[32m- name: assert-changed-244 True 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  fail:[m
[32m+[m[32m  when: ttl_output.changed == True[m
[32m+[m[32m- name: debug-stdout 0060_ok_sendln_telnet_t1.ttl[m
[32m+[m[32m  debug:[m
[32m+[m[32m     var: ttl_output.stdout_lines[m
[32m+[m
[32m+[m[32m- name: test-245 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -7944,14 +8392,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-233 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-245 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-234 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-246 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -7976,14 +8424,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-234 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-246 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-235 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-247 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -7991,14 +8439,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-235 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-247 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-236 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-248 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8023,14 +8471,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-236 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-248 True 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1008_ok_localhost-2200_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-237 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-249 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8038,14 +8486,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-237 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-249 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-238 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-250 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8070,14 +8518,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-238 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-250 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-239 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-251 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8085,14 +8533,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-239 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-251 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-240 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-252 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8117,14 +8565,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-240 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-252 True 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1009_ok_localhost-2200_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-241 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: test-253 1010_ok_localhost-2200_show.ttl[m
   ttl:[m
     filename: 1010_ok_localhost-2200_show.ttl[m
     chdir: ../test[m
[36m@@ -8132,14 +8580,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-241 True 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: assert-failed-253 True 1010_ok_localhost-2200_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1010_ok_localhost-2200_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-242 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: test-254 1010_ok_localhost-2200_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8164,14 +8612,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-242 True 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: assert-failed-254 True 1010_ok_localhost-2200_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1010_ok_localhost-2200_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-243 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: test-255 1010_ok_localhost-2200_show.ttl[m
   ttl:[m
     filename: 1010_ok_localhost-2200_show.ttl[m
     chdir: ../test[m
[36m@@ -8179,14 +8627,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-243 True 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: assert-changed-255 True 1010_ok_localhost-2200_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1010_ok_localhost-2200_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-244 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: test-256 1010_ok_localhost-2200_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8211,14 +8659,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-244 True 1010_ok_localhost-2200_show.ttl[m
[32m+[m[32m- name: assert-changed-256 True 1010_ok_localhost-2200_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1010_ok_localhost-2200_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-245 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-257 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1011_ok_cisco1_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8226,14 +8674,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-245 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-257 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-246 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-258 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8258,14 +8706,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-246 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-258 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-247 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-259 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1011_ok_cisco1_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8273,14 +8721,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-247 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-259 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-248 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-260 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8305,14 +8753,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-248 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-260 True 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1011_ok_cisco1_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-249 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-261 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1012_ok_cisco1_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8320,14 +8768,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-249 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-261 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-250 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-262 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8352,14 +8800,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-250 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-262 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-251 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-263 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1012_ok_cisco1_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8367,14 +8815,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-251 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-263 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-252 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-264 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8399,14 +8847,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-252 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-264 True 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1012_ok_cisco1_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-253 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: test-265 1013_ok_cisco1_show.ttl[m
   ttl:[m
     filename: 1013_ok_cisco1_show.ttl[m
     chdir: ../test[m
[36m@@ -8414,14 +8862,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-253 True 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: assert-failed-265 True 1013_ok_cisco1_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1013_ok_cisco1_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-254 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: test-266 1013_ok_cisco1_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8446,14 +8894,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-254 True 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: assert-failed-266 True 1013_ok_cisco1_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1013_ok_cisco1_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-255 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: test-267 1013_ok_cisco1_show.ttl[m
   ttl:[m
     filename: 1013_ok_cisco1_show.ttl[m
     chdir: ../test[m
[36m@@ -8461,14 +8909,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-255 True 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: assert-changed-267 True 1013_ok_cisco1_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1013_ok_cisco1_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-256 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: test-268 1013_ok_cisco1_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8493,14 +8941,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-256 True 1013_ok_cisco1_show.ttl[m
[32m+[m[32m- name: assert-changed-268 True 1013_ok_cisco1_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1013_ok_cisco1_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-257 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-269 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1014_ok_cisco2_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8508,14 +8956,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-257 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-269 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-258 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-270 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8540,14 +8988,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-258 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-270 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-259 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-271 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1014_ok_cisco2_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8555,14 +9003,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-259 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-271 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-260 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-272 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8587,14 +9035,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-260 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-272 True 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1014_ok_cisco2_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-261 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-273 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1015_ok_cisco2_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8602,14 +9050,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-261 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-273 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-262 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-274 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8634,14 +9082,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-262 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-274 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-263 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-275 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1015_ok_cisco2_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8649,14 +9097,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-263 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-275 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-264 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-276 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8681,14 +9129,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-264 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-276 True 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1015_ok_cisco2_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-265 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: test-277 1016_ok_cisco2_show.ttl[m
   ttl:[m
     filename: 1016_ok_cisco2_show.ttl[m
     chdir: ../test[m
[36m@@ -8696,14 +9144,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-265 True 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: assert-failed-277 True 1016_ok_cisco2_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1016_ok_cisco2_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-266 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: test-278 1016_ok_cisco2_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8728,14 +9176,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-266 True 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: assert-failed-278 True 1016_ok_cisco2_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1016_ok_cisco2_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-267 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: test-279 1016_ok_cisco2_show.ttl[m
   ttl:[m
     filename: 1016_ok_cisco2_show.ttl[m
     chdir: ../test[m
[36m@@ -8743,14 +9191,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-267 True 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: assert-changed-279 True 1016_ok_cisco2_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1016_ok_cisco2_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-268 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: test-280 1016_ok_cisco2_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8775,14 +9223,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-268 True 1016_ok_cisco2_show.ttl[m
[32m+[m[32m- name: assert-changed-280 True 1016_ok_cisco2_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1016_ok_cisco2_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-269 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-281 1017_ok_qx_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1017_ok_qx_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8790,14 +9238,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-269 True 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-281 True 1017_ok_qx_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1017_ok_qx_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-270 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-282 1017_ok_qx_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8822,14 +9270,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-270 True 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-282 True 1017_ok_qx_ping_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1017_ok_qx_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-271 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-283 1017_ok_qx_ping_127-0-0-1.ttl[m
   ttl:[m
     filename: 1017_ok_qx_ping_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8837,14 +9285,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-271 True 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-283 True 1017_ok_qx_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1017_ok_qx_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-272 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: test-284 1017_ok_qx_ping_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8869,14 +9317,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-272 True 1017_ok_qx_ping_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-284 True 1017_ok_qx_ping_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1017_ok_qx_ping_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-273 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-285 1018_ok_qx_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1018_ok_qx_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8884,14 +9332,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-273 True 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-285 True 1018_ok_qx_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1018_ok_qx_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-274 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-286 1018_ok_qx_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8916,14 +9364,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-274 True 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-failed-286 True 1018_ok_qx_trace_127-0-0-1.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1018_ok_qx_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-275 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-287 1018_ok_qx_trace_127-0-0-1.ttl[m
   ttl:[m
     filename: 1018_ok_qx_trace_127-0-0-1.ttl[m
     chdir: ../test[m
[36m@@ -8931,14 +9379,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-275 True 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-287 True 1018_ok_qx_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1018_ok_qx_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-276 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: test-288 1018_ok_qx_trace_127-0-0-1.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -8963,14 +9411,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-276 True 1018_ok_qx_trace_127-0-0-1.ttl[m
[32m+[m[32m- name: assert-changed-288 True 1018_ok_qx_trace_127-0-0-1.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1018_ok_qx_trace_127-0-0-1.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-277 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: test-289 1019_ok_qx_show.ttl[m
   ttl:[m
     filename: 1019_ok_qx_show.ttl[m
     chdir: ../test[m
[36m@@ -8978,14 +9426,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-277 True 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: assert-failed-289 True 1019_ok_qx_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1019_ok_qx_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-278 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: test-290 1019_ok_qx_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -9010,14 +9458,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-278 True 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: assert-failed-290 True 1019_ok_qx_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1019_ok_qx_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-279 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: test-291 1019_ok_qx_show.ttl[m
   ttl:[m
     filename: 1019_ok_qx_show.ttl[m
     chdir: ../test[m
[36m@@ -9025,14 +9473,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-279 True 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: assert-changed-291 True 1019_ok_qx_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1019_ok_qx_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-280 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: test-292 1019_ok_qx_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -9057,14 +9505,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-280 True 1019_ok_qx_show.ttl[m
[32m+[m[32m- name: assert-changed-292 True 1019_ok_qx_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1019_ok_qx_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-281 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: test-293 1020_ok_vmware_show.ttl[m
   ttl:[m
     filename: 1020_ok_vmware_show.ttl[m
     chdir: ../test[m
[36m@@ -9072,14 +9520,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-281 True 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: assert-failed-293 True 1020_ok_vmware_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1020_ok_vmware_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-282 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: test-294 1020_ok_vmware_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -9104,14 +9552,14 @@[m
   check_mode: False[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-failed-282 True 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: assert-failed-294 True 1020_ok_vmware_show.ttl[m
   fail:[m
   when: (not ansible_check_mode) and (ttl_output.failed == True)[m
 - name: debug-stdout 1020_ok_vmware_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-283 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: test-295 1020_ok_vmware_show.ttl[m
   ttl:[m
     filename: 1020_ok_vmware_show.ttl[m
     chdir: ../test[m
[36m@@ -9119,14 +9567,14 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-283 True 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: assert-changed-295 True 1020_ok_vmware_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1020_ok_vmware_show.ttl[m
   debug:[m
      var: ttl_output.stdout_lines[m
 [m
[31m-- name: test-284 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: test-296 1020_ok_vmware_show.ttl[m
   ttl:[m
     cmd: |[m
       ;[m
[36m@@ -9151,7 +9599,7 @@[m
   check_mode: True[m
   register: ttl_output[m
   ignore_errors: False[m
[31m-- name: assert-changed-284 True 1020_ok_vmware_show.ttl[m
[32m+[m[32m- name: assert-changed-296 True 1020_ok_vmware_show.ttl[m
   fail:[m
   when: ttl_output.changed == True[m
 - name: debug-stdout 1020_ok_vmware_show.ttl[m
[1mdiff --git a/forwsl2/site_sample.yml b/forwsl2/site_sample.yml[m
[1mindex df95ec3..0e1f3fe 100644[m
[1m--- a/forwsl2/site_sample.yml[m
[1m+++ b/forwsl2/site_sample.yml[m
[36m@@ -7,7 +7,6 @@[m
       ttl:[m
         cmd: |[m
           connect 'localhost:2200 /ssh /user=username /passwd=password'[m
[31m-          pause 1[m
           flushrecv[m
           sendln 'ping localhost'[m
           wait '$'[m
[1mdiff --git a/mybuild.py b/mybuild.py[m
[1mindex 2c9cc33..c136977 100644[m
[1m--- a/mybuild.py[m
[1m+++ b/mybuild.py[m
[36m@@ -2,7 +2,7 @@[m
 import os[m
 import subprocess[m
 [m
[31m-VERSION = 1.26[m
[32m+[m[32mVERSION = 1.27[m
 [m
 [m
 def main():[m
[1mdiff --git a/nextnextping/grammer/ttl_parser_worker.py b/nextnextping/grammer/ttl_parser_worker.py[m
[1mindex 77fa95f..f23a3c4 100644[m
[1m--- a/nextnextping/grammer/ttl_parser_worker.py[m
[1m+++ b/nextnextping/grammer/ttl_parser_worker.py[m
[36m@@ -14,6 +14,8 @@[m [mimport base64[m
 import platform[m
 import getpass[m
 from abc import ABC, abstractmethod[m
[32m+[m[32mimport serial[m
[32m+[m[32mimport typing[m
 [m
 IMP_ERR = None[m
 try:[m
[36m@@ -61,12 +63,12 @@[m [mclass MyFindfirst:[m
         pass[m
 [m
     def readline(self) -> str:[m
[31m-        ans = b""[m
[32m+[m[32m        ans = b''[m
         if 0 < len(self.my_list):[m
             ans = self.my_list[0][m
             self.my_list = self.my_list[1:][m
             # print(f"MyFindfirst {str(self.my_list)}")[m
[31m-            ans = ans.encode("utf-8")[m
[32m+[m[32m            ans = ans.encode('utf-8')[m
         else:[m
             raise OSError("readline exception")[m
         return ans[m
[36m@@ -90,7 +92,7 @@[m [mclass MyAbstractShell(ABC):[m
         pass[m
 [m
     @abstractmethod[m
[31m-    def recv(self, length: int) -> str:[m
[32m+[m[32m    def recv(self, length: int):[m
         pass[m
 [m
     @abstractmethod[m
[36m@@ -101,13 +103,17 @@[m [mclass MyAbstractShell(ABC):[m
     def isActive(self) -> int:[m
         pass[m
 [m
[32m+[m[32m    @abstractmethod[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
 [m
 class MyShell(MyAbstractShell):[m
     def __init__(self, command=None):[m
         if command is None:[m
             command = ['cmd'][m
         # print("MyShell __init__ start")[m
[31m-        self.data = ""[m
[32m+[m[32m        self.data = ''[m
         self.lock = threading.Lock()[m
         self.active = 1[m
         self.process = subprocess.Popen([m
[36m@@ -118,16 +124,21 @@[m [mclass MyShell(MyAbstractShell):[m
             text=True,[m
             shell=True,[m
         )[m
[31m-        thread = MyThread(self, "stdout", self.process.stdout)[m
[32m+[m[32m        thread = MyShellThread(self, "stdout", self.process.stdout)[m
         thread.start()[m
         # print("MyShell __init__ end")[m
 [m
[32m+[m[32m    def get_lock(self) -> threading.Lock:[m
[32m+[m[32m        return self.lock[m
[32m+[m
[32m+[m[32m    @typing.override[m
     def send_ready(self) -> bool:[m
         # print("send_ready")[m
         if self.active == 0:[m
             return 0[m
         return self.process.stdin.writable()[m
 [m
[32m+[m[32m    @typing.override[m
     def send(self, message):[m
         # print(f"send /{message.strip()}/")[m
         if self.active == 0:[m
[36m@@ -135,29 +146,31 @@[m [mclass MyShell(MyAbstractShell):[m
         self.process.stdin.write(message)[m
         self.process.stdin.flush()[m
 [m
[32m+[m[32m    @typing.override[m
     def recv_ready(self) -> bool:[m
[31m-        self.process.stdout.flush()[m
[31m-        # self.process.stderr.flush()[m
[31m-        ans = False[m
         if 0 < len(self.data):[m
[31m-            ans = True[m
[31m-        # print(f"recv_ready {len(self.data)} / {ans}")[m
[31m-        return ans[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
[32m+[m[32m        if self.active == 0:[m
[32m+[m[32m            return False[m
[32m+[m[32m        self.process.stdout.flush()[m
[32m+[m[32m        return False[m
 [m
[31m-    def recv(self, length: int) -> str:[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
         # print(f"recv d=/{self.data.strip()}/")[m
         if len(self.data) <= 0:[m
[31m-            return[m
[31m-        local_data = ""[m
[31m-        with self.lock:[m
[32m+[m[32m            return b''[m
[32m+[m[32m        local_data = ''[m
[32m+[m[32m        with self.get_lock():[m
             local_data = self.data[0][m
             self.data = self.data[1:][m
[31m-        return local_data.encode("utf-8")[m
[32m+[m[32m        return local_data.encode('utf-8')[m
 [m
[32m+[m[32m    @typing.override[m
     def close(self):[m
         # print("client close")[m
         self.active = 0[m
[31m-        self.data = ""[m
[32m+[m[32m        self.data = ''[m
         local_process = self.process[m
         self.local_process = None[m
         if local_process is not None:[m
[36m@@ -167,61 +180,75 @@[m [mclass MyShell(MyAbstractShell):[m
                 # anything delete[m
                 pass[m
 [m
[32m+[m[32m    @typing.override[m
     def isActive(self) -> int:[m
         return self.active[m
 [m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
 [m
 class MyPexpect(MyAbstractShell):[m
     def __init__(self):[m
         shell_name = os.getenv("SHELL", "/bin/sh")[m
         self.child = pexpect.spawn(shell_name, timeout=0, encoding='utf-8')[m
[31m-        self.result = None[m
[32m+[m[32m        self.result = ''[m
 [m
[32m+[m[32m    @typing.override[m
     def send_ready(self) -> bool:[m
         return True[m
 [m
[32m+[m[32m    @typing.override[m
     def send(self, message):[m
         child = self.child[m
         if child is None:[m
             return[m
         child.send(message)[m
 [m
[32m+[m[32m    @typing.override[m
     def recv_ready(self) -> bool:[m
[32m+[m[32m        if self.result != "":[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
         child = self.child[m
         if child is None:[m
             return False[m
[31m-        if self.result is not None:[m
[31m-            return True[m
[31m-        index = child.expect([r".", pexpect.EOF, pexpect.TIMEOUT])[m
[31m-        if index == 0:[m
[32m+[m[32m        self.result = ""[m
[32m+[m[32m        target = ""[m
[32m+[m[32m        while True:[m
[32m+[m[32m            index = child.expect([r".", pexpect.EOF, pexpect.TIMEOUT])[m
[32m+[m[32m            if index == 2:[m
[32m+[m[32m                break  # timeout[m
[32m+[m[32m            elif index == 1:[m
[32m+[m[32m                self.close()[m
[32m+[m[32m                break  # EOF[m
[32m+[m[32m            #[m
             # child.after ã§ãƒãƒƒãƒã—ãŸæ–‡å­—åˆ—å…¨ä½“ã‚’å–å¾—[m
[31m-            self.result = child.before + child.after[m
[31m-            if 0 < len(self.result):[m
[31m-                return True[m
[31m-            else:[m
[31m-                return False[m
[31m-        elif index == 1:  # EOF[m
[31m-            self.close()[m
[31m-            return False[m
[31m-        return False  # Timeout[m
[31m-[m
[31m-    def recv(self, length: int) -> str:[m
[31m-        if self.child is None:[m
[31m-            return None[m
[31m-        work = ''[m
[31m-        if self.result is not None:[m
[31m-            if len(self.result) <= length:[m
[31m-                work = self.result[m
[31m-                self.result = None[m
[31m-            else:[m
[31m-                work = self.result[:self.result][m
[31m-                self.result = self.result[self.result + 1:][m
[31m-        elif self.recv_ready():[m
[31m-            work = self.recv(length)[m
[31m-        if self.child is None:[m
[31m-            return None[m
[31m-        return work.encode("utf-8")[m
[32m+[m[32m            target = child.before + child.after[m
[32m+[m[32m            if len(target) <= 0:[m
[32m+[m[32m                break  # åé›†ã§ããªã‹ã£ãŸ[m
[32m+[m[32m            #[m
[32m+[m[32m            # æ–‡å­—åˆ—ã‚’åŠ ç®—[m
[32m+[m[32m            self.result = self.result + target[m
[32m+[m[32m        #[m
[32m+[m[32m        return 0 < len(target)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
[32m+[m[32m        if self.result == '' and not self.recv_ready():[m
[32m+[m[32m            return ''[m
[32m+[m[32m        if self.result == '':[m
[32m+[m[32m            return ''[m
[32m+[m[32m        if len(self.result) <= length:[m
[32m+[m[32m            work = self.result[m
[32m+[m[32m            self.result = ''[m
[32m+[m[32m        else:[m
[32m+[m[32m            work = self.result[:length][m
[32m+[m[32m            self.result = self.result[length + 1:][m
[32m+[m[32m        work = work.replace("\r", "")[m
[32m+[m[32m        return work.encode('utf-8')[m
 [m
[32m+[m[32m    @typing.override[m
     def close(self):[m
         child = self.child.close()[m
         self.child = None[m
[36m@@ -230,30 +257,448 @@[m [mclass MyPexpect(MyAbstractShell):[m
         except Exception:[m
             pass[m
 [m
[32m+[m[32m    @typing.override[m
     def isActive(self) -> int:[m
         if self.child is not None:[m
             return 1[m
         return 0[m
 [m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
 [m
[31m-class MyThread(threading.Thread):[m
[32m+[m
[32m+[m[32mclass MySerial(MyAbstractShell):[m
[32m+[m[32m    def __init__(self, command: str, rate: int, flowctrl=3, flowctrl_dtr=False, flowctrl_rts=False):[m
[32m+[m[32m        self.readSer = None[m
[32m+[m[32m        if platform.system().lower() != "linux":[m
[32m+[m[32m            # for Windows[m
[32m+[m[32m            if 0 < len(command) and "0" <= command[0] and command[0] <= "9":[m
[32m+[m[32m                # 1æ–‡å­—ä»¥ä¸Šã§ 0-9ã®é–“ãªã‚‰COMã‚’è¿½åŠ ã™ã‚‹[m
[32m+[m[32m                command = "COM" + command[m
[32m+[m[32m        if flowctrl is None:[m
[32m+[m[32m            self.readSer = serial.Serial(command, rate, timeout=0.1)[m
[32m+[m[32m        else:[m
[32m+[m[32m            xonxoff = flowctrl == 1  # default False[m
[32m+[m[32m            rtscts = flowctrl == 2 or (flowctrl == 3 and flowctrl_rts)  # default False[m
[32m+[m[32m            dsrdtr = flowctrl == 4 or (flowctrl == 3 and flowctrl_dtr)  # default False[m
[32m+[m[32m            self.readSer = serial.Serial(command, rate, timeout=0.1, xonxoff=xonxoff, rtscts=rtscts, dsrdtr=dsrdtr)[m
[32m+[m[32m        self.active = True[m
[32m+[m[32m        self.data = b''[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send_ready(self) -> bool:[m
[32m+[m[32m        if not self.active:[m
[32m+[m[32m            return False[m
[32m+[m[32m        return self.readSer.writable()[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send(self, message):[m
[32m+[m[32m        if not self.active:[m
[32m+[m[32m            return[m
[32m+[m[32m        self.readSer.write(message.encode('utf-8'))[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv_ready(self) -> bool:[m
[32m+[m[32m        if 0 < len(self.data):[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
[32m+[m[32m        if not self.active:[m
[32m+[m[32m            return False[m
[32m+[m[32m        self.readSer.flush()[m
[32m+[m[32m        if not self.readSer.readable():[m
[32m+[m[32m            return False[m
[32m+[m[32m        try:[m
[32m+[m[32m            self.data = self.readSer.read(size=256)[m
[32m+[m[32m        except Exception:[m
[32m+[m[32m            self.close()  # ã‚¨ãƒ©ãƒ¼ ãŒã§ãŸã®ã§å¼·åˆ¶çµ‚äº†[m
[32m+[m[32m            return False[m
[32m+[m[32m        return 0 < len(self.data)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
[32m+[m[32m        # if not self.active:[m
[32m+[m[32m        #    return None  # EOFã®ã¨ãã¯ã¾ã èª­ã¿è¾¼ã‚ã‚‹[m
[32m+[m[32m        self.recv_ready()[m
[32m+[m[32m        if len(self.data) < length:[m
[32m+[m[32m            result = self.data[m
[32m+[m[32m            self.data = b''[m
[32m+[m[32m            return result[m
[32m+[m[32m        result = self.data[0:length][m
[32m+[m[32m        self.data = self.data[length:][m
[32m+[m[32m        return result[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def close(self):[m
[32m+[m[32m        self.active = False[m
[32m+[m[32m        try:[m
[32m+[m[32m            localReadSer = self.readSer[m
[32m+[m[32m            self.readSer = None[m
[32m+[m[32m            if localReadSer is not None:[m
[32m+[m[32m                localReadSer.close()[m
[32m+[m[32m        except Exception:[m
[32m+[m[32m            pass[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def isActive(self) -> int:[m
[32m+[m[32m        if self.active:[m
[32m+[m[32m            return 1[m
[32m+[m[32m        return 0[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
[32m+[m[32m    def exit_status_ready(self):[m
[32m+[m[32m        return not self.active[m
[32m+[m
[32m+[m
[32m+[m[32mclass MyTelnetT0(MyAbstractShell):[m
[32m+[m
[32m+[m[32m    def __init__(self, client: socket.socket):[m
[32m+[m[32m        self.client = client[m
[32m+[m[32m        self.data = b''[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send_ready(self) -> bool:[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return False[m
[32m+[m[32m        return True[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def send(self, message: str):[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return[m
[32m+[m[32m        self.send_binary(message.encode('utf-8'))[m
[32m+[m
[32m+[m[32m    def send_binary(self, message):[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return[m
[32m+[m[32m        self.client.sendall(message)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv_ready(self) -> bool:[m
[32m+[m[32m        if 0 < len(self.data):[m
[32m+[m[32m            return True  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ãªã‚‰ç„¡æ¡ä»¶OK[m
[32m+[m[32m        if self.client is None:[m
[32m+[m[32m            return False[m
[32m+[m[32m        try:[m
[32m+[m[32m            self.client.settimeout(0.1)[m
[32m+[m[32m            recv_data = self.client.recv(1024)[m
[32m+[m[32m            if recv_data is None or recv_data == b'':[m
[32m+[m[32m                self.close()[m
[32m+[m[32m                return False[m
[32m+[m[32m            self.data = self.change_stream(recv_data)[m
[32m+[m[32m        except ConnectionResetError:[m
[32m+[m[32m            self.close()[m
[32m+[m[32m            return False[m
[32m+[m[32m        except socket.timeout:[m
[32m+[m[32m            return False[m
[32m+[m[32m        return 0 < len(self.data)[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def change_stream(self, recv_data):[m
[32m+[m[32m        return recv_data[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def recv(self, length: int):[m
[32m+[m[32m        if 0 == len(self.data):  # æ®‹ã‚Šãƒ‡ãƒ¼ã‚¿ãŒãªã„[m
[32m+[m[32m            if self.client is None:  # closeã§ã‚ã‚‹[m
[32m+[m[32m                return None[m
[32m+[m[32m        self.recv_ready()[m
[32m+[m[32m        if len(self.data) < length:[m
[32m+[m[32m            result = self.data[m
[32m+[m[32m            self.data = b''[m
[32m+[m[32m            return result[m
[32m+[m[32m        result = self.data[0:length][m
[32m+[m[32m        self.data = self.data[length:][m
[32m+[m[32m        return result[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def close(self):[m
[32m+[m[32m        local_client = self.client[m
[32m+[m[32m        self.client = None[m
[32m+[m[32m        if local_client is not None:[m
[32m+[m[32m            try:[m
[32m+[m[32m                local_client.close()[m
[32m+[m[32m            except Exception:[m
[32m+[m[32m                pass[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def isActive(self) -> int:[m
[32m+[m[32m        if self.client is not None:[m
[32m+[m[32m            return 1[m
[32m+[m[32m        return 0[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def get_echo(self) -> bool:[m
[32m+[m[32m        return True[m
[32m+[m
[32m+[m[32m    def exit_status_ready(self):[m
[32m+[m[32m        return self.client is None[m
[32m+[m
[32m+[m
[32m+[m[32mclass MyTelnetT1(MyTelnetT0):[m
[32m+[m
[32m+[m[32m    _CR = b'\r'[m
[32m+[m[32m    _LF = b'\n'[m
[32m+[m
[32m+[m[32m    _NULL = b'\x00'                 # 0	Binary Transmission	[RFC856][m
[32m+[m[32m    _ECHO = b'\x01'                 # 1	Echo	[RFC857][m
[32m+[m[32m    _Reconnection = b'\x02'         # 2	Reconnection	[NIC 15391 of 1973][m
[32m+[m[32m    _Suppress_Go_Ahead = b'\x03'    # 3	Suppress Go Ahead	[RFC858][m
[32m+[m[32m    _AMSize_Negotiation = b'\x04'   # 4	Approx Message Size Negotiation	[NIC 15393 of 1973][m
[32m+[m[32m    _Status = b'\x05'               # 5	Status	[RFC859][m
[32m+[m[32m    _Timing_Mark = b'\x06'          # 6	Timing Mark	[RFC860][m
[32m+[m[32m    _RCTrans_and_Echo = b'\x07'     # 7	Remote Controlled Trans and Echo	[RFC726][m
[32m+[m[32m    _Output_Line_Width = b'\x08'    # 8	Output Line Width	[NIC 20196 of August 1978][m
[32m+[m[32m    _Output_Page_Size = b'\x09'     # 9	Output Page Size	[NIC 20197 of August 1978][m
[32m+[m[32m    _OCRDisposition = b'\x0a'       # 10	Output Carriage-Return Disposition	[RFC652][m
[32m+[m[32m    _OHTStops = b'\x0b'             # 11	Output Horizontal Tab Stops	[RFC653][m
[32m+[m[32m    _OHTDisposition = b'\x0c'       # 12	Output Horizontal Tab Disposition	[RFC654][m
[32m+[m[32m    _OFDisposition = b'\x0d'        # 13	Output Formfeed Disposition	[RFC655][m
[32m+[m[32m    _OVTabstops = b'\x0e'           # 14	Output Vertical Tabstops	[RFC656][m
[32m+[m[32m    _OVTab_Disposition = b'\x0f'    # 15	Output Vertical Tab Disposition	[RFC657][m
[32m+[m[32m    _OLDisposition = b'\x10'        # 16	Output Linefeed Disposition	[RFC658][m
[32m+[m[32m    _Extended_ASCII = b'\x11'       # 17	Extended ASCII	[RFC698][m
[32m+[m[32m    _Logout = b'\x12'               # 18	Logout	[RFC727][m
[32m+[m[32m    _Byte_Macro = b'\x13'           # 19	Byte Macro	[RFC735][m
[32m+[m[32m    _Data_Entry_Terminal = b'\x14'  # 20	Data Entry Terminal	[RFC1043][RFC732][m
[32m+[m[32m    _SUPDUP = b'\x15'               # 21	SUPDUP	[RFC736][RFC734][m
[32m+[m[32m    _SUPDUP_Output = b'\x16'        # 22	SUPDUP Output	[RFC749][m
[32m+[m[32m    _Send_Location = b'\x17'        # 23	Send Location	[RFC779][m
[32m+[m[32m    _Terminal_Type = b'\x18'        # 24	Terminal Type	[RFC1091][m
[32m+[m[32m    _End_of_Record = b'\x19'        # 25	End of Record	[RFC885][m
[32m+[m[32m    _TACACS_UI = b'\x1a'            # 26	TACACS User Identification	[RFC927][m
[32m+[m[32m    _Output_Marking = b'\x1b'       # 27	Output Marking	[RFC933][m
[32m+[m[32m    _TLocation_Number = b'\x1c'     # 28	Terminal Location Number	[RFC946][m
[32m+[m[32m    _Telnet_3270_Regime = b'\x1d'   # 29	Telnet 3270 Regime	[RFC1041][m
[32m+[m[32m    _X_3_PAD = b'\x1e'              # 30	X.3 PAD	[RFC1053][m
[32m+[m[32m    _NAWS = b'\x1f'                 # 31	Negotiate About Window Size	[RFC1073][m
[32m+[m[32m    _Terminal_Speed = b'\x20'       # 32	Terminal Speed	[RFC1079][m
[32m+[m[32m    _RFC = b'\x21'                  # 33	Remote Flow Control	[RFC1372][m
[32m+[m[32m    _Linemode = b'\x22'             # 34	Linemode	[RFC1184][m
[32m+[m[32m    _X_Display_Location = b'\x23'   # 35	X Display Location	[RFC1096][m
[32m+[m[32m    _EnvironmentOpt = b'\x24'       # 36	Environment Option	[RFC1408][m
[32m+[m[32m    _Authentication_Opt = b'\25'    # 37	Authentication Option	[RFC2941][m
[32m+[m[32m    _EncryptionOpt = b'\x26'        # 38	Encryption Option	[RFC2946][m
[32m+[m[32m    _New_EnvironmentOpt = b'\x27'   # 39	New Environment Option	[RFC1572][m
[32m+[m
[32m+[m[32m    _EOF = b'\xF6'   # 236 [RFC1184][m
[32m+[m[32m    _SE = b'\xF0'    # 240 [RFC854][RFC855][m
[32m+[m[32m    _SB = b'\xFA'    # 250 [RFC854][RFC855][m
[32m+[m[32m    _WILL = b'\xFB'  # 251 [RFC854][RFC855][m
[32m+[m[32m    _WONT = b'\xFC'  # 252 [RFC854][RFC855][m
[32m+[m[32m    _DO = b'\xFD'    # 253 [RFC854][RFC855][m
[32m+[m[32m    _DONT = b'\xFe'  # 254 [RFC854][RFC855][m
[32m+[m[32m    _IAC = b'\xff'   # 255 [RFC854][RFC855][m
[32m+[m
[32m+[m[32m    _IS = b'\x00'     # [RFC2941][m
[32m+[m[32m    _SEND = b'\x01'   # [RFC2941][m
[32m+[m[32m    _REPLY = b'\x02'  # [RFC2941][m
[32m+[m[32m    _NAME = b'\x03'   # [RFC2941][m
[32m+[m
[32m+[m[32m    def __init__(self, client: socket.socket):[m
[32m+[m[32m        super().__init__(client)[m
[32m+[m[32m        self.recv_data = b''[m
[32m+[m[32m        self.state = MyTelnetT1._NULL  # text[m
[32m+[m[32m        self.sb_se_op = b''[m
[32m+[m[32m        self.sb_se = b''[m
[32m+[m[32m        self.alread_flag = {}[m
[32m+[m[32m        self.init_sender()[m
[32m+[m
[32m+[m[32m    def init_sender(self):[m
[32m+[m[32m        """ echo """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DO + MyTelnetT1._ECHO)[m
[32m+[m
[32m+[m[32m    def is_alread_flag(self, bynary_data, do_or_will) -> bool:[m
[32m+[m[32m        key = bynary_data[m
[32m+[m[32m        if do_or_will:[m
[32m+[m[32m            key = key + b'd'[m
[32m+[m[32m        else:[m
[32m+[m[32m            key = key + b'w'[m
[32m+[m[32m        flag = False[m
[32m+[m[32m        if key in self.alread_flag:[m
[32m+[m[32m            flag = True[m
[32m+[m[32m        else:[m
[32m+[m[32m            self.alread_flag[key] = True[m
[32m+[m[32m        return flag[m
[32m+[m
[32m+[m[32m    def print(self, text):[m
[32m+[m[32m        """ for debug """[m
[32m+[m[32m        # print(text)[m
[32m+[m[32m        pass[m
[32m+[m
[32m+[m[32m    @typing.override[m
[32m+[m[32m    def change_stream(self, recv_data):[m
[32m+[m[32m        self.recv_data = self.recv_data + recv_data[m
[32m+[m[32m        mess = b''[m
[32m+[m[32m        # print(f"change_stream start {self.recv_data}")[m
[32m+[m[32m        while 0 < len(self.recv_data):[m
[32m+[m[32m            # print(f"xx {mess} / {self.recv_data} / {len(self.recv_data)} /s={self.state} / {MyTelnetT1._NULL}")[m
[32m+[m[32m            char_data = self.recv_data[0:1][m
[32m+[m[32m            self.recv_data = self.recv_data[1:][m
[32m+[m[32m            if self.state == MyTelnetT1._NULL:[m
[32m+[m[32m                if char_data == MyTelnetT1._IAC:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._CR:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._EOF:[m
[32m+[m[32m                    pass[m
[32m+[m[32m                else:[m
[32m+[m[32m                    mess = mess + char_data[m
[32m+[m[32m            elif self.state == MyTelnetT1._IAC:[m
[32m+[m[32m                if char_data == MyTelnetT1._IAC:[m
[32m+[m[32m                    # IACã‚’é€ã‚ŠãŸã„å ´åˆã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æƒ…å ±ã€‚[m
[32m+[m[32m                    # ã ãŒé€ã‚‹ã¨ UTF-8 ãŒå£Šã‚Œã‚‹ã®ã§é€ã‚‰ãªã„[m
[32m+[m[32m                    self.state = MyTelnetT1._NULL[m
[32m+[m[32m                elif char_data == MyTelnetT1._WILL:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._WONT:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._DO:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._DONT:[m
[32m+[m[32m                    self.state = char_data[m
[32m+[m[32m                elif char_data == MyTelnetT1._SB:[m
[32m+[m[32m                    self.state = MyTelnetT1._SB + b'op'[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.state = MyTelnetT1._NULL[m
[32m+[m[32m                    mess = mess + b'IAC_Unkown'[m
[32m+[m[32m            elif self.state == MyTelnetT1._WILL:[m
[32m+[m[32m                self.print(f"IAC WILL {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, True):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                elif char_data == MyTelnetT1._ECHO:[m
[32m+[m[32m                    self.do_iac_will_echo(char_data)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_will_any(char_data)[m
[32m+[m[32m                    # ä¸Šè¨˜ä»¥å¤–ã¯ _WONT ã‚’è¿”ã™[m
[32m+[m[32m                    self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DONT + char_data)[m
[32m+[m[32m                    self.print(f"res IAC DONT {char_data[0]}")[m
[32m+[m[32m            elif self.state == MyTelnetT1._WONT:[m
[32m+[m[32m                self.print(f"IAC WONT {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, True):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_do_any(char_data)  # WONTã«å¯¾ã—ã¦ã¯WONTã—ã‹è¿”ã›ãªã„[m
[32m+[m[32m            elif self.state == MyTelnetT1._DO:[m
[32m+[m[32m                self.print(f"IAC DO {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, False):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                elif char_data == MyTelnetT1._ECHO:[m
[32m+[m[32m                    self.do_iac_do_echo(char_data)[m
[32m+[m[32m                elif char_data == MyTelnetT1._NAWS:[m
[32m+[m[32m                    self.do_iac_do_NAWS(char_data)[m
[32m+[m[32m                elif char_data == MyTelnetT1._Terminal_Type:[m
[32m+[m[32m                    self.do_iac_do_Terminal_Type(char_data)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_do_any(char_data)  # ä¸Šè¨˜ä»¥å¤–ã¯ _WONT ã‚’è¿”ã™[m
[32m+[m[32m            elif self.state == MyTelnetT1._DONT:[m
[32m+[m[32m                self.print(f"IAC DONT {char_data[0]}")[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if self.is_alread_flag(char_data, False):[m
[32m+[m[32m                    pass  # ä¸€åº¦å—ä¿¡ã—ãŸã“ã¨ãŒã‚ã‚‹ã‚‚ã®ã¯ï¼’åº¦ã¨å¿œç­”ã—ãªã„[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.do_iac_will_any(char_data)  # WONTã«å¯¾ã—ã¦ã¯WONTã—ã‹è¿”ã›ãªã„[m
[32m+[m[32m            elif self.state == MyTelnetT1._SB + b'op':[m
[32m+[m[32m                # IAC SB option ã® optionå—ä»˜[m
[32m+[m[32m                self.sb_se = b''[m
[32m+[m[32m                self.sb_se_op = char_data[m
[32m+[m[32m                self.state = MyTelnetT1._SB[m
[32m+[m[32m                self.print(f"IAC1 SB {self.sb_se_op} / {char_data}")[m
[32m+[m[32m            elif self.state == MyTelnetT1._SB:[m
[32m+[m[32m                # IAC SB option å¾Œã®ãƒ‡ãƒ¼ã‚¿å—ä»˜[m
[32m+[m[32m                if char_data == MyTelnetT1._IAC:[m
[32m+[m[32m                    # IAC SB option å¾Œã®ãƒ‡ãƒ¼ã‚¿å†…ã« IAC ã‚’è¦‹ã¤ã‘ãŸ[m
[32m+[m[32m                    self.state = MyTelnetT1._IAC + MyTelnetT1._SB[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.sb_se = self.sb_se + char_data[m
[32m+[m[32m                self.print(f"IAC2 SB {self.sb_se_op} {self.sb_se} {self.sb_se_op}")[m
[32m+[m[32m            elif self.state == MyTelnetT1._IAC + MyTelnetT1._SB:[m
[32m+[m[32m                self.print(f"IAC SB {self.sb_se_op} IAC")[m
[32m+[m[32m                # IAC SB option å¾Œã®ãƒ‡ãƒ¼ã‚¿å†…ã« IAC ã‚’è¦‹ã¤ã‘ãŸæ¬¡ã®æ–‡å­—[m
[32m+[m[32m                if char_data == MyTelnetT1._SE:[m
[32m+[m[32m                    # IAC SB ... IAC SE ã¾ã§å®Œäº†ã—ãŸ[m
[32m+[m[32m                    self.state = MyTelnetT1._NULL[m
[32m+[m[32m                    self.do_iac_sb_se()[m
[32m+[m[32m                else:[m
[32m+[m[32m                    # IACã®å¾Œç¶šãŒ SBã§ãªã‹ã£ãŸã®ã§ ãƒ‡ãƒ¼ã‚¿å—ä»˜ç¶™ç¶š[m
[32m+[m[32m                    # self.print(f"IAC SB {self.sb_se_op} IAC {char_data[0]}")[m
[32m+[m[32m                    self.state = MyTelnetT1._SB[m
[32m+[m[32m                    self.sb_se = self.sb_se + MyTelnetT1._IAC + char_data[m
[32m+[m[32m            elif self.state == MyTelnetT1._CR:[m
[32m+[m[32m                self.state = MyTelnetT1._NULL[m
[32m+[m[32m                if char_data == MyTelnetT1._CR:[m
[32m+[m[32m                    mess = mess + MyTelnetT1._CR  # CR ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã§ã™[m
[32m+[m[32m                elif char_data == MyTelnetT1._NULL:  # teraterm ã ã¨ã“ã‚Œ[m
[32m+[m[32m                    mess = mess + MyTelnetT1._CR[m
[32m+[m[32m                elif char_data == MyTelnetT1._LF:  # windowsã®telnetã ã¨ã“ã‚Œ[m
[32m+[m[32m                    mess = mess + MyTelnetT1._CR[m
[32m+[m[32m                else:[m
[32m+[m[32m                    mess = mess + char_data  # CR ã‚’é™¤ã„ãŸã‚‚ã®ã‚’å…¥ã‚Œã¾ã™[m
[32m+[m[32m            else:[m
[32m+[m[32m                raise TypeError(f"Stateus error {int(self.state)}/{char_data[0]}")[m
[32m+[m[32m        # print(f"change_stream end /{mess}/")[m
[32m+[m[32m        return mess[m
[32m+[m
[32m+[m[32m    def do_iac_will_echo(self, char_data):[m
[32m+[m[32m        """ ã‚µãƒ¼ãƒãŒ echo ã«ãªã‚‹ã“ã¨ã¯å—ã‘å…¥ã‚Œã‚‹ """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DO + char_data)[m
[32m+[m[32m        self.print(f"res IAC DONT {char_data[0]}")[m
[32m+[m
[32m+[m[32m    def do_iac_do_echo(self, char_data):[m
[32m+[m[32m        """ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ echo ã«ã¯ãªã‚ŠãŸããªã„ """[m
[32m+[m[32m        self.do_iac_do_any(char_data)[m
[32m+[m
[32m+[m[32m    def do_iac_will_any(self, char_data):[m
[32m+[m[32m        """ åŸºæœ¬ DONT ã‚’è¿”ã™ """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._DONT + char_data)[m
[32m+[m[32m        self.print(f"res IAC DONT {char_data[0]}")[m
[32m+[m
[32m+[m[32m    def do_iac_do_any(self, char_data):[m
[32m+[m[32m        """ åŸºæœ¬ WONT ã‚’è¿”ã™ """[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._WONT + char_data)[m
[32m+[m[32m        self.print(f"res IAC WONT {char_data[0]}")[m
[32m+[m
[32m+[m[32m    def do_iac_do_NAWS(self, char_data):[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._WILL + char_data[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SB + char_data[m
[32m+[m[32m                         + b'\0' + b'\x50' + b'\0' + b'\x18'[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SE)[m
[32m+[m[32m        self.print("res IAC WILL NAWS IAC SB NAWS 80x24 IAC SE")[m
[32m+[m
[32m+[m[32m    def do_iac_do_Terminal_Type(self, char_data):[m
[32m+[m[32m        self.send_binary(MyTelnetT1._IAC + MyTelnetT1._WILL + char_data[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SB + char_data[m
[32m+[m[32m                         + MyTelnetT1._IS + b'VT100'[m
[32m+[m[32m                         + MyTelnetT1._IAC + MyTelnetT1._SE)[m
[32m+[m
[32m+[m[32m    def do_iac_sb_se(self):[m
[32m+[m[32m        self.print(f"IAC SB {self.sb_se_op} / {self.sb_se} IAC SE")[m
[32m+[m[32m        # TODO:[m
[32m+[m
[32m+[m
[32m+[m[32mclass MyShellThread(threading.Thread):[m
     def __init__(self, myShell: MyShell, name: str, stream):[m
[31m-        # print("MyThread __init__ start")[m
[32m+[m[32m        # print("MyShellThread __init__ start")[m
         super().__init__()[m
         self.name = name[m
         self.myShell = myShell[m
         self.stream = stream[m
[31m-        # print("MyThread __init__ end")[m
[32m+[m[32m        # print("MyShellThread __init__ end")[m
 [m
     def run(self):[m
         """å¤–éƒ¨ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã®èª­ã¿è¾¼ã¿"""[m
[31m-        # print(f"MyThread_run() start f={type(self.myShell)} n={self.name}")[m
[32m+[m[32m        # print(f"MyShellThread_run() start f={type(self.myShell)} n={self.name}")[m
         while self.myShell.isActive() != 0:[m
             ans = self.stream.read(1)[m
             # print(f"start n={self.name} a=/{ans}/")[m
[31m-            with self.myShell.lock:[m
[32m+[m[32m            with self.myShell.get_lock():[m
                 self.myShell.data = self.myShell.data + ans[m
[31m-        # print(f"MyThread_run() end n={self.name} a=/{ans}/")[m
[32m+[m[32m        # print(f"MyShellThread_run() end n={self.name} a=/{ans}/")[m
         #[m
         # activeã§ãªããªã£ãŸã®ã§å¿µã®ãŸã‚æ¶ˆã™[m
         try:[m
[36m@@ -324,9 +769,9 @@[m [mclass TtlParseTreeVisitor(ParseTreeVisitor):[m
 [m
     def visitChildren(self, node):[m
         result = {}[m
[31m-        result["name"] = node.__class__.__name__[m
[32m+[m[32m        result['name'] = node.__class__.__name__[m
         line_number = node.start.line[m
[31m-        result["line"] = line_number[m
[32m+[m[32m        result['line'] = line_number[m
         #[m
         n = node.getChildCount()[m
         if n == 0:[m
[36m@@ -338,7 +783,7 @@[m [mclass TtlParseTreeVisitor(ParseTreeVisitor):[m
             if childResult is not None:[m
                 worker_list.append(childResult)[m
         if worker_list != 0:[m
[31m-            result["child"] = worker_list[m
[32m+[m[32m            result['child'] = worker_list[m
         return result[m
 [m
     def visitTerminal(self, node):[m
[36m@@ -347,7 +792,7 @@[m [mclass TtlParseTreeVisitor(ParseTreeVisitor):[m
         if type < 0:[m
             return None[m
         x = TtlParserLexer.ruleNames[type - 1][m
[31m-        if x == "RN" or x == "WS":[m
[32m+[m[32m        if x == 'RN' or x == 'WS':[m
             return None[m
         return node.getText()[m
 [m
[36m@@ -364,7 +809,57 @@[m [mclass ThrowingErrorListener(ErrorListener):[m
         raise TypeError(f"### l={line}:{column} Token recognition error - {msg}")[m
 [m
 [m
[31m-class TtlPaserWolker(ABC):[m
[32m+[m[32mclass SplitEscape():[m
[32m+[m
[32m+[m[32m    split_escape_buffer = ''[m
[32m+[m[32m    split_escape_state = 0[m
[32m+[m
[32m+[m[32m    def split_escape(self, text: str) -> str:[m
[32m+[m[32m        '''[m
[32m+[m[32m        è£…ç½®ã‹ã‚‰åé›†ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãŒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã«ã‚ˆã‚Šè‰²ä»˜ã‘ã•ã‚Œã¦ã„ã‚‹ã¨[m
[32m+[m[32m        ãªã«ã‹ã¨å›°ã‚‹ã®ã§ ã“ã“ã§å–ã‚‹ã€‚[m
[32m+[m[32m        ãŸã ã—ã€æœ¬æ¥ã§ã‚ã‚Œã°ä»¥ä¸‹ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã¯ã¨ã‚Œã‚‹ã®ã ãŒã€[m
[32m+[m[32m        è¡Œé–“ã¾ãŸãã¨å–ã‚Œãªã„ã®ã§ç‹¬è‡ªå®Ÿè£…ã‚’å…¥ã‚ŒãŸ[m
[32m+[m[32m        ansi_escape = re.compile('\x1B\\[\\d+([;\\d]+){0,2}m')[m
[32m+[m[32m        return ansi_escape.sub('', text)[m
[32m+[m[32m        '''[m
[32m+[m[32m        result = ''[m
[32m+[m[32m        for char in text:[m
[32m+[m[32m            if self.split_escape_state == 0:[m
[32m+[m[32m                if char == "\x1b":[m
[32m+[m[32m                    self.split_escape_state = 1[m
[32m+[m[32m                    self.split_escape_buffer = char[m
[32m+[m[32m                else:[m
[32m+[m[32m                    result = result + char[m
[32m+[m[32m            elif self.split_escape_state == 1:[m
[32m+[m[32m                self.split_escape_buffer = self.split_escape_buffer + char[m
[32m+[m[32m                if char == '[':[m
[32m+[m[32m                    self.split_escape_state = 2[m
[32m+[m[32m                else:[m
[32m+[m[32m                    result = result + self.split_escape_buffer[m
[32m+[m[32m                    self.split_escape_state == 0[m
[32m+[m[32m                    self.split_escape_buffer = ''[m
[32m+[m[32m            else:[m
[32m+[m[32m                self.split_escape_buffer = self.split_escape_buffer + char[m
[32m+[m[32m                if '0' <= char and char <= '9':[m
[32m+[m[32m                    pass[m
[32m+[m[32m                elif char == ';':[m
[32m+[m[32m                    self.split_escape_state = self.split_escape_state + 1[m
[32m+[m[32m                    if 5 <= self.split_escape_state:[m
[32m+[m[32m                        result = result + self.split_escape_buffer[m
[32m+[m[32m                        self.split_escape_state = 0[m
[32m+[m[32m                        self.split_escape_buffer = ''[m
[32m+[m[32m                elif char == 'm':[m
[32m+[m[32m                    self.split_escape_state = 0[m
[32m+[m[32m                    self.split_escape_buffer = ''[m
[32m+[m[32m                else:[m
[32m+[m[32m                    result = result + self.split_escape_buffer[m
[32m+[m[32m                    self.split_escape_state = 0[m
[32m+[m[32m                    self.split_escape_buffer = ''[m
[32m+[m[32m        return result[m
[32m+[m
[32m+[m
[32m+[m[32mclass TtlPaserWolker(ABC, SplitEscape):[m
     """tera tekitou lang ã®å®Ÿè£…éƒ¨åˆ†(GUIé™¤ã)"""[m
 [m
     def __init__(self):[m
[36m@@ -376,9 +871,9 @@[m [mclass TtlPaserWolker(ABC):[m
         self.end_flag = False[m
         self.client = None[m
         self.shell = None[m
[31m-        self.stdout = ""[m
[32m+[m[32m        self.stdout = ''[m
         self.file_handle_list = {}[m
[31m-        self.title = "dummy"[m
[32m+[m[32m        self.title = 'dummy'[m
         self.title = self.getTitle()  # ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚ŒãŸã¨ãã«ã‚¿ã‚¤ãƒˆãƒ«ã‚’å·®ã—æ›¿ãˆã‚‹[m
         self.log_file_handle = None[m
         self.log_start = True[m
[36m@@ -390,12 +885,17 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         self.encrypt_file = {}[m
         self.exitcode = None[m
[32m+[m[32m        #[m
[32m+[m[32m        self.speed = 9600[m
[32m+[m[32m        self.flowctrl = 3[m
[32m+[m[32m        self.flowctrl_rts = False[m
[32m+[m[32m        self.flowctrl_dtr = False[m
 [m
     def stop(self, error=None):[m
         """å¼·åˆ¶åœæ­¢å‡¦ç†"""[m
         if error is not None:[m
[31m-            self.setValue("error", error)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('error', error)[m
[32m+[m[32m            self.setValue('result', 0)[m
         self.end_flag = True[m
         #[m
         # SSHæ¥ç¶šã—ã¦ã„ãŸã‚‰æ­¢ã‚ã‚‹[m
[36m@@ -414,7 +914,7 @@[m [mclass TtlPaserWolker(ABC):[m
     def closeClient(self):[m
         """close client"""[m
         # print("closeClient()")[m
[31m-        self.stdout = ""[m
[32m+[m[32m        self.stdout = ''[m
         self.log_connect_time = None[m
         #[m
         client = self.client[m
[36m@@ -437,17 +937,17 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def set_default_value(self, param_list: list):[m
         #[m
[31m-        self.setValue("error", "")[m
[31m-        self.setValue("result", 1)[m
[32m+[m[32m        self.setValue('error', "")[m
[32m+[m[32m        self.setValue('result', 1)[m
         #[m
         # print(f" data={json.dumps(param_list, indent=2)}")[m
         for i in range(10):[m
[31m-            self.setValue("param" + str(i + 1), "")[m
[31m-            self.setValue("param[" + str(i + 1) + "]", "")[m
[32m+[m[32m            self.setValue('param' + str(i + 1), '')[m
[32m+[m[32m            self.setValue('param[' + str(i + 1) + ']', '')[m
         #[m
         for i, param in enumerate(param_list):[m
[31m-            self.setValue("param" + str(i + 1), param)[m
[31m-            self.setValue("param[" + str(i + 1) + "]", param)[m
[32m+[m[32m            self.setValue('param' + str(i + 1), param)[m
[32m+[m[32m            self.setValue('param[' + str(i + 1) + ']', param)[m
 [m
     def execute(self, filename: str, param_list: list, data=None, ignore_result=False):[m
         try:[m
[36m@@ -457,7 +957,7 @@[m [mclass TtlPaserWolker(ABC):[m
             self.include(filename, data)[m
             #[m
             if self.exitcode is not None:[m
[31m-                self.setValue("result", self.exitcode)[m
[32m+[m[32m                self.setValue('result', self.exitcode)[m
             if not ignore_result:[m
                 result = int(self.getValue('result'))[m
                 error_data = self.getValue('error')[m
[36m@@ -475,7 +975,7 @@[m [mclass TtlPaserWolker(ABC):[m
             # print(f"filename={filename} param={self.result_file_json}")[m
             if filename not in self.result_file_json:[m
                 if data is None:[m
[31m-                    with open(filename, "r", encoding="utf-8") as f:[m
[32m+[m[32m                    with open(filename, 'r', encoding='utf-8') as f:[m
                         data = f.read()[m
                 result_json = self.include_data(data)[m
                 #[m
[36m@@ -503,7 +1003,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # å®Ÿå‡¦ç†ã“ã“ã‹ã‚‰[m
         try:[m
             #[m
[31m-            self.execute_result(self.result_file_json[filename]["child"])[m
[32m+[m[32m            self.execute_result(self.result_file_json[filename]['child'])[m
             #[m
         except TtlExitFlagException:[m
             # exitã‚³ãƒãƒ³ãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¨ãã¯æ­£å¸¸çµ‚äº†ã§ã™[m
[36m@@ -554,8 +1054,8 @@[m [mclass TtlPaserWolker(ABC):[m
         if strvar not in self.value_list:[m
             for k in self.value_list:[m
                 # print(k)[m
[31m-                if strvar + "[" in k:[m
[31m-                    return "ARRAY"  # é…åˆ—æŒ‡å®šãŒã‚ã‚‹[m
[32m+[m[32m                if strvar + '[' in k:[m
[32m+[m[32m                    return 'ARRAY'  # é…åˆ—æŒ‡å®šãŒã‚ã‚‹[m
             if error_stop:[m
                 raise TypeError(f"Value not found err v={strvar}")[m
             return None[m
[36m@@ -568,33 +1068,33 @@[m [mclass TtlPaserWolker(ABC):[m
         if self.end_flag:[m
             return[m
         for x in x_list:[m
[31m-            name = x["name"][m
[31m-            line = x["line"][m
[32m+[m[32m            name = x['name'][m
[32m+[m[32m            line = x['line'][m
             #[m
             # ã‚ˆãã‚ã‹ã‚‰ã‚“ãŒsleepå…¥ã‚Œãªã„ã¨ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ï¼Ÿ[m
             # time.sleep(0.01)[m
             #[m
[31m-            if "CommandlineContext" == name:[m
[32m+[m[32m            if 'CommandlineContext' == name:[m
                 if ifFlag != 0:[m
[31m-                    self.commandlineContext(x["child"])[m
[31m-            elif "ElseifContext" == name:[m
[32m+[m[32m                    self.commandlineContext(x['child'])[m
[32m+[m[32m            elif 'ElseifContext' == name:[m
                 if ifFlag == 0:[m
[31m-                    first = self.getDataInt(x["child"][1])[m
[32m+[m[32m                    first = self.getDataInt(x['child'][1])[m
                     if first != 0:[m
[31m-                        self.execute_result(x["child"][3:])[m
[32m+[m[32m                        self.execute_result(x['child'][3:])[m
                         ifFlag = 1[m
[31m-            elif "ElseContext" == name:[m
[32m+[m[32m            elif 'ElseContext' == name:[m
                 if ifFlag == 0:[m
[31m-                    self.execute_result(x["child"][1:])[m
[32m+[m[32m                    self.execute_result(x['child'][1:])[m
             else:[m
                 self.stop(error=f"### l={line} execute_result Unkown name={name} x={x}")[m
             if self.end_flag:[m
                 break[m
 [m
     def normpath(self, filename: str) -> str:[m
[31m-        filename = os.path.normpath(filename.replace("\\", "/"))[m
[31m-        if platform.system().lower() == "linux":[m
[31m-            result = re.search("^([a-zA-Z]):(.*)$", filename)[m
[32m+[m[32m        filename = os.path.normpath(filename.replace("\\", '/'))[m
[32m+[m[32m        if platform.system().lower() == 'linux':[m
[32m+[m[32m            result = re.search('^([a-zA-Z]):(.*)$', filename)[m
             if result:[m
                 filename = f"/mnt/{result.group(1)}/{result.group(2)}"[m
         return filename[m
[36m@@ -602,195 +1102,199 @@[m [mclass TtlPaserWolker(ABC):[m
     def commandlineContext(self, token_list):[m
         for x in token_list:[m
             # print(f"commandlineContext data={json.dumps(x, indent=2)}")[m
[31m-            name = x["name"][m
[31m-            line = x["line"][m
[31m-            if "InputContext" == name:[m
[31m-                strvar = self.getKeywordName(x["child"][0])[m
[31m-                data = x["child"][2][m
[32m+[m[32m            name = x['name'][m
[32m+[m[32m            line = x['line'][m
[32m+[m[32m            if 'InputContext' == name:[m
[32m+[m[32m                strvar = self.getKeywordName(x['child'][0])[m
[32m+[m[32m                data = x['child'][2][m
                 data = self.getData(data)[m
                 self.setValue(strvar, data)[m
[31m-            elif "CommandContext" == name:[m
[31m-                command_name = x["child"][0][m
[31m-                if "assert" == command_name:[m
[31m-                    self.doAssert(command_name, line, x["child"][1:])[m
[31m-                elif "break" == command_name:[m
[32m+[m[32m            elif 'CommandContext' == name:[m
[32m+[m[32m                command_name = x['child'][0][m
[32m+[m[32m                if 'assert' == command_name:[m
[32m+[m[32m                    self.doAssert(command_name, line, x['child'][1:])[m
[32m+[m[32m                elif 'break' == command_name:[m
                     raise TtlBreakFlagException(command_name)[m
[31m-                elif "continue" == command_name:[m
[32m+[m[32m                elif 'continue' == command_name:[m
                     raise TtlContinueFlagException(command_name)[m
[31m-                elif "end" == command_name:[m
[32m+[m[32m                elif 'end' == command_name:[m
                     self.end_flag = True[m
[31m-                elif "exit" == command_name:[m
[32m+[m[32m                elif 'exit' == command_name:[m
                     raise TtlExitFlagException(command_name)[m
[31m-                elif "return" == command_name:[m
[32m+[m[32m                elif 'return' == command_name:[m
                     raise TtlReturnFlagException(command_name)[m
[31m-                elif "include" == command_name:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif 'include' == command_name:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     self.include(p1)[m
[31m-                elif "call" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'call' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     # print(f"call label={p1}")[m
                     self.callContext(line, p1)[m
[31m-                elif "bplusrecv" == command_name:[m
[32m+[m[32m                elif 'bplusrecv' == command_name:[m
                     self.doBplusrecv(command_name, line)[m
[31m-                elif "bplussend" == command_name:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif 'bplussend' == command_name:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     self.doBplussend(command_name, line, p1)[m
[31m-                elif "callmenu" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'callmenu' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doCallmenu(command_name, line, p1)[m
[31m-                elif command_name in ["setdir", "changedir"]:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif command_name in ['setdir', 'changedir']:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     self.doChangedir(p1)[m
[31m-                elif "clearscreen" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'clearscreen' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doClearscreen(command_name, line, p1)[m
[31m-                elif command_name in ["closett", "disconnect", "unlink"]:[m
[32m+[m[32m                elif command_name in ['closett', 'disconnect', 'unlink']:[m
                     self.closeClient()[m
[31m-                elif "connect" == command_name:[m
[31m-                    self.doConnect(self.getData(x["child"][1]), line)[m
[31m-                elif "dispstr" == command_name:[m
[31m-                    self.doDispstr(x["child"][1:])[m
[31m-                elif "flushrecv" == command_name:[m
[32m+[m[32m                elif 'connect' == command_name:[m
[32m+[m[32m                    self.doConnect(self.getData(x['child'][1]), line)[m
[32m+[m[32m                elif 'dispstr' == command_name:[m
[32m+[m[32m                    self.doDispstr(x['child'][1:])[m
[32m+[m[32m                elif 'flushrecv' == command_name:[m
                     self.doFlushrecv()[m
[31m-                elif "enablekeyb" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'enablekeyb' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doEnablekeyb(command_name, line, p1)[m
[31m-                elif "getmodemstatus" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'getmodemstatus' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     self.doGetmodemstatus(command_name, line, p1)[m
[31m-                elif "gethostname" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'gethostname' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     self.doGethostname(p1)[m
[31m-                elif "gettitle" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'gettitle' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getTitle()[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "logautoclosemode" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'logautoclosemode' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doLogautoclosemode(command_name, line, p1)[m
[31m-                elif "logclose" == command_name:[m
[32m+[m[32m                elif 'logclose' == command_name:[m
                     self.doLogclose()[m
[31m-                elif "loginfo" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'loginfo' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     self.doLoginfo(command_name, line, p1)[m
[31m-                elif "logopen" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[31m-                    p_len = len(x["child"])[m
[32m+[m[32m                elif 'logopen' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
[32m+[m[32m                    p_len = len(x['child'])[m
                     p4 = 0[m
                     if 5 < p_len:[m
[31m-                        p4 = self.getDataInt(x["child"][4])[m
[32m+[m[32m                        p4 = self.getDataInt(x['child'][4])[m
                     p5 = 0[m
                     if 6 <= p_len:[m
[31m-                        p5 = self.getDataInt(x["child"][5])[m
[32m+[m[32m                        p5 = self.getDataInt(x['child'][5])[m
                     p6 = 0[m
                     if 7 <= p_len:[m
[31m-                        p6 = self.getDataInt(x["child"][6])[m
[32m+[m[32m                        p6 = self.getDataInt(x['child'][6])[m
                     p7 = 0[m
                     if 8 <= p_len:[m
[31m-                        p7 = self.getDataInt(x["child"][7])[m
[32m+[m[32m                        p7 = self.getDataInt(x['child'][7])[m
                     p8 = 0[m
                     if 9 <= p_len:[m
[31m-                        p8 = self.getDataInt(x["child"][8])[m
[32m+[m[32m                        p8 = self.getDataInt(x['child'][8])[m
                     self.doLogopen(p1, p2, p3, p4, p5, p6, p7, p8)[m
[31m-                elif "logpause" == command_name:[m
[32m+[m[32m                elif 'logpause' == command_name:[m
                     self.doLogpause()[m
[31m-                elif "logrotate" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p_len = len(self.getData(x["child"]))[m
[32m+[m[32m                elif 'logrotate' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p_len = len(self.getData(x['child']))[m
                     p2 = None[m
                     if 3 < p_len:[m
[31m-                        p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                        p2 = self.getDataInt(x['child'][2])[m
                     self.doLogrotate(command_name, line, p1, p2)[m
[31m-                elif "logstart" == command_name:[m
[32m+[m[32m                elif 'logstart' == command_name:[m
                     self.doLogstart()[m
[31m-                elif "logwrite" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'logwrite' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doLogwrite(p1)[m
[31m-                elif "recvln" == command_name:[m
[32m+[m[32m                elif 'recvln' == command_name:[m
                     self.doRecvln()[m
[31m-                elif "scprecv" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'scprecv' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     p2 = p1[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = str(self.getData(x['child'][2]))[m
                     self.doScprecv(p1, p2)[m
[31m-                elif "scpsend" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'scpsend' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     p2 = p1[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = str(self.getData(x['child'][2]))[m
                     self.doScpsend(p1, p2)[m
[31m-                elif command_name in ["send", "sendbinary", "sendtext"]:[m
[31m-                    self.doSend(x["child"][1:])[m
[31m-                elif "sendbreak" == command_name:[m
[32m+[m[32m                elif command_name in ['send', 'sendbinary', 'sendtext']:[m
[32m+[m[32m                    self.doSend(x['child'][1:])[m
[32m+[m[32m                elif 'sendbreak' == command_name:[m
                     self.doSendbreak()[m
[31m-                elif "sendln" == command_name:[m
[31m-                    self.doSendln(x["child"][1:])[m
[31m-                elif "settitle" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'sendln' == command_name:[m
[32m+[m[32m                    self.doSendln(x['child'][1:])[m
[32m+[m[32m                elif ('setbaud' == command_name) or ('setspeed' == command_name):[m
[32m+[m[32m                    self.speed = self.getDataInt(x['child'][1])[m
[32m+[m[32m                elif 'setflowctrl' == command_name:[m
[32m+[m[32m                    self.flowctrl = self.getDataInt(x['child'][1])[m
[32m+[m[32m                elif 'setdtr' == command_name:[m
[32m+[m[32m                    self.flowctrl_dtr = self.getDataInt(x['child'][1]) != 0[m
[32m+[m[32m                elif 'setrts' == command_name:[m
[32m+[m[32m                    self.flowctrl_rts = self.getDataInt(x['child'][1]) != 0[m
[32m+[m[32m                elif 'settitle' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.setTitle(p1)[m
[31m-                elif "testlink" == command_name:[m
[32m+[m[32m                elif 'testlink' == command_name:[m
                     self.doTestlink()[m
[31m-                elif command_name in ["wait", "wait4all"]:[m
[31m-                    self.doWait(x["child"][1:])[m
[31m-                elif "waitln" == command_name:[m
[31m-                    self.doWaitln(x["child"][1:])[m
[31m-                elif "execcmnd" == command_name:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[32m+[m[32m                elif command_name in ['wait', 'wait4all']:[m
[32m+[m[32m                    self.doWait(x['child'][1:])[m
[32m+[m[32m                elif 'waitln' == command_name:[m
[32m+[m[32m                    self.doWaitln(x['child'][1:])[m
[32m+[m[32m                elif 'execcmnd' == command_name:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
                     result_json = self.include_data(p1)[m
[31m-                    self.execute_result(result_json["child"])[m
[31m-                elif "mpause" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                    self.execute_result(result_json['child'])[m
[32m+[m[32m                elif 'mpause' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doPause(p1 / 1000)[m
[31m-                elif "pause" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'pause' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doPause(p1)[m
[31m-                elif "code2str" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = x["child"][2][m
[32m+[m[32m                elif 'code2str' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = x['child'][2][m
                     p2 = self.getData(p2)[m
                     if p2 == 0:[m
[31m-                        self.setValue(p1, "")[m
[32m+[m[32m                        self.setValue(p1, '')[m
                     else:[m
                         p2 = self.getChrSharp(p2)[m
                         self.setValue(p1, p2)[m
[31m-                elif "expandenv" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = ""[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'expandenv' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = ''[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = self.getData(x['child'][2])[m
                     else:[m
                         p2 = self.getData(p1)[m
                     self.doExpandenv(p1, p2)[m
[31m-                elif "int2str" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'int2str' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.setValue(p1, p2)[m
[31m-                elif "sprintf" == command_name:[m
[31m-                    self.doSprintf("inputstr", x["child"][1:])[m
[31m-                elif "sprintf2" == command_name:[m
[31m-                    p1 = x["child"][1][m
[32m+[m[32m                elif 'sprintf' == command_name:[m
[32m+[m[32m                    self.doSprintf('inputstr', x['child'][1:])[m
[32m+[m[32m                elif 'sprintf2' == command_name:[m
[32m+[m[32m                    p1 = x['child'][1][m
                     p1 = self.getKeywordName(p1)[m
[31m-                    self.doSprintf(p1, x["child"][2:])[m
[31m-                elif "str2code" == command_name:[m
[31m-                    # print("str2code")[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = x["child"][2][m
[31m-                    # print(f"p2A={p2}")[m
[32m+[m[32m                    self.doSprintf(p1, x['child'][2:])[m
[32m+[m[32m                elif 'str2code' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = x['child'][2][m
                     p2 = self.getData(p2)[m
[31m-                    # print(f"p2B={p2}")[m
                     p2 = self.getSharpChr(p2)[m
[31m-                    # print(f"p2C={p2}")[m
                     self.setValue(p1, p2)[m
[31m-                elif "str2int" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'str2int' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     self.setValue(p1, p2)[m
[31m-                elif "strcompare" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'strcompare' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     result = 0[m
                     if p1 == p2:[m
                         result = 0[m
[36m@@ -798,410 +1302,410 @@[m [mclass TtlPaserWolker(ABC):[m
                         result = -1[m
                     else:[m
                         result = 1[m
[31m-                    self.setValue("result", result)[m
[31m-                elif "strconcat" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                    self.setValue('result', result)[m
[32m+[m[32m                elif 'strconcat' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_str = self.getValue(p1)[m
[31m-                    p2_str = x["child"][2][m
[32m+[m[32m                    p2_str = x['child'][2][m
                     p1_str = p1_str + self.getData(p2_str)[m
                     self.setValue(p1, p1_str)[m
[31m-                elif "strcopy" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[31m-                    p4 = self.getKeywordName(x["child"][4])[m
[32m+[m[32m                elif 'strcopy' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
[32m+[m[32m                    p4 = self.getKeywordName(x['child'][4])[m
                     if p2 < 0:[m
                         p2 = 0[m
                     p1 = p1[p2: p2 + p3][m
                     self.setValue(p4, p1)[m
[31m-                elif "strinsert" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[32m+[m[32m                elif 'strinsert' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
                     p1_val = self.getData(p1)[m
                     # print(f"### l={line} {command_name} {p1} {p2} {p3} {p1_val}")[m
                     p1_val = p1_val[:p2] + p3 + p1_val[p2:][m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strjoin" == command_name:[m
[32m+[m[32m                elif 'strjoin' == command_name:[m
                     # print(f"### l={line} {command_name}")[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p3 = 9[m
                     # print(f"len {len(x['child'])}")[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p3 = self.getDataInt(x["child"][3])[m
[31m-                    p1_val = ""[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p3 = self.getDataInt(x['child'][3])[m
[32m+[m[32m                    p1_val = ''[m
                     for i in range(p3):[m
                         if i != 0:[m
                             p1_val = p1_val + p2[m
[31m-                        p1_val = p1_val + self.getValue("groupmatchstr" + str(i + 1))[m
[32m+[m[32m                        p1_val = p1_val + self.getValue('groupmatchstr' + str(i + 1))[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strlen" == command_name:[m
[31m-                    p1 = len(self.getData(x["child"][1]))[m
[31m-                    self.setValue("result", p1)[m
[31m-                elif "strmatch" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'strlen' == command_name:[m
[32m+[m[32m                    p1 = len(self.getData(x['child'][1]))[m
[32m+[m[32m                    self.setValue('result', p1)[m
[32m+[m[32m                elif 'strmatch' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doStrmatch(p1, p2)[m
[31m-                elif "strremove" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[32m+[m[32m                elif 'strremove' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
                     p1_val = self.getData(p1)[m
                     # print(f"### l={line} {command_name} {p1} {p2} {p3} {p1_val}")[m
                     p1_val = p1_val[:p2] + p1_val[p2 + p3:][m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strreplace" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'strreplace' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getData(p1)[m
[31m-                    p2 = self.getDataInt(x["child"][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[31m-                    p4 = str(self.getData(x["child"][4]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2]) - 1  # 1ã‚ªãƒªã‚¸ãƒ³[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
[32m+[m[32m                    p4 = str(self.getData(x['child'][4]))[m
                     self.doStrreplace(p1, p1_val, p2, p3, p4)[m
[31m-                elif "strscan" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'strscan' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     index = p1.find(p2)[m
                     if index < 0:[m
                         index = 0[m
                     else:[m
                         index = index + 1[m
                     # print(f"strscan {index}")[m
[31m-                    self.setValue("result", index)[m
[31m-                elif "strspecial" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                    self.setValue('result', index)[m
[32m+[m[32m                elif 'strspecial' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getData(p1)[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p1_val = str(self.getData(x["child"][2]))[m
[31m-                    p1_val = p1_val.encode().decode("unicode_escape")[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p1_val = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p1_val = p1_val.encode().decode('unicode_escape', errors='xmlcharrefreplace')[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "strsplit" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'strsplit' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_val = self.getData(p1)[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p3 = 10[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p3 = self.getDataInt(x["child"][3])[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p3 = self.getDataInt(x['child'][3])[m
                     for i in range(9):[m
[31m-                        self.setValue("groupmatchstr" + str(i + 1), "")[m
[32m+[m[32m                        self.setValue('groupmatchstr' + str(i + 1), '')[m
                     i = 0[m
                     while i < p3 - 1:[m
                         index = p1_val.find(p2)[m
                         if 0 <= index:[m
                             # print(f"aa i{i + 1} {p3} /{p1_val[0:index]}/ /{p1_val[index + len(p2):]}/")[m
[31m-                            self.setValue("groupmatchstr" + str(i + 1), p1_val[0:index])[m
[32m+[m[32m                            self.setValue('groupmatchstr' + str(i + 1), p1_val[0:index])[m
                             p1_val = p1_val[index + len(p2):][m
                         else:[m
                             break[m
                         i = i + 1[m
                     if 0 < len(p1_val):[m
                         # print(f"bb i{i + 1} {p3} /{p1_val}/")[m
[31m-                        self.setValue("groupmatchstr" + str(i + 1), p1_val)[m
[32m+[m[32m                        self.setValue('groupmatchstr' + str(i + 1), p1_val)[m
                     i = i + 1[m
                     # print(f"i={i}")[m
[31m-                    self.setValue("result", i)[m
[31m-                elif "strtrim" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                    self.setValue('result', i)[m
[32m+[m[32m                elif 'strtrim' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     p1_var = self.getData(p1)[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     p1_var = self.doStrtrim(p1_var, p2)[m
                     self.setValue(p1, p1_var)[m
[31m-                elif "tolower" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'tolower' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = p2.lower()[m
                     self.setValue(p1, p2)[m
[31m-                elif "toupper" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'toupper' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = p2.upper()[m
                     self.setValue(p1, p2)[m
[31m-                elif "basename" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'basename' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = self.normpath(p2)[m
                     p2 = os.path.basename(p2)[m
                     self.setValue(p1, str(p2))[m
[31m-                elif "dirname" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'dirname' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     p2 = self.normpath(p2)[m
                     # print(f"p2a={p2}")[m
[31m-                    p2 = re.sub(r"[\/]$", "", p2)[m
[32m+[m[32m                    p2 = re.sub(r'[\/]$', '', p2)[m
                     p2 = pathlib.Path(p2)[m
                     # print(f"p2b={p2}")[m
                     p2 = str(p2.parent)[m
                     # print(f"p2c={p2}")[m
                     self.setValue(p1, str(p2))[m
[31m-                elif command_name in ["fileclose", "findclose"]:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif command_name in ['fileclose', 'findclose']:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     self.doFileclose(p1)[m
[31m-                elif "fileconcat" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'fileconcat' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doFileconcat(p1, p2)[m
[31m-                elif "filecopy" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'filecopy' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doFilecopy(p1, p2)[m
[31m-                elif "filecreate" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'filecreate' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doFileopen(p1, p2, 0, 0)[m
[31m-                elif "filedelete" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'filedelete' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFiledelete(p1)[m
[31m-                elif "fileopen" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[31m-                    p3 = self.getDataInt(x["child"][3])[m
[32m+[m[32m                elif 'fileopen' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
[32m+[m[32m                    p3 = self.getDataInt(x['child'][3])[m
                     p4 = 0[m
[31m-                    if 5 <= len(x["child"]):[m
[31m-                        p4 = self.getData(x["child"][4])[m
[32m+[m[32m                    if 5 <= len(x['child']):[m
[32m+[m[32m                        p4 = self.getData(x['child'][4])[m
                     self.doFileopen(p1, p2, p3, p4)[m
[31m-                elif "filereadln" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'filereadln' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doFilereadln(line, p1, p2)[m
[31m-                elif "fileread" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[31m-                    p3 = self.getKeywordName(x["child"][3])[m
[32m+[m[32m                elif 'fileread' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
[32m+[m[32m                    p3 = self.getKeywordName(x['child'][3])[m
                     self.doFileread(line, p1, p2, p3)[m
[31m-                elif "filerename" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'filerename' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     self.doFilerename(p1, p2)[m
[31m-                elif "filesearch" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'filesearch' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFilesearch(p1)[m
[31m-                elif "filestat" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'filestat' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     p3 = None[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p3 = str(self.getKeywordName(x["child"][3]))[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p3 = str(self.getKeywordName(x['child'][3]))[m
                     p4 = None[m
[31m-                    if 4 <= len(x["child"]):[m
[31m-                        p4 = str(self.getKeywordName(x["child"][4]))[m
[32m+[m[32m                    if 4 <= len(x['child']):[m
[32m+[m[32m                        p4 = str(self.getKeywordName(x['child'][4]))[m
                     self.doFilestat(p1, p2, p3, p4)[m
[31m-                elif "filetruncate" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'filetruncate' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     self.doFiletruncate(p1, p2)[m
[31m-                elif "filewrite" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'filewrite' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doFilewrite(line, p1, p2)[m
[31m-                elif "filewriteln" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2]) + "\n"[m
[32m+[m[32m                elif 'filewriteln' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2]) + "\n"[m
                     self.doFilewrite(line, p1, p2)[m
[31m-                elif "findfirst" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = self.getKeywordName(x["child"][3])[m
[32m+[m[32m                elif 'findfirst' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = self.getKeywordName(x['child'][3])[m
                     self.doFindfirst(line, p1, p2, p3)[m
[31m-                elif "findnext" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'findnext' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doFindnext(line, p1, p2)[m
[31m-                elif "foldercreate" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'foldercreate' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFoldercreate(p1)[m
[31m-                elif "folderdelete" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'folderdelete' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFolderdelete(p1)[m
[31m-                elif "foldersearch" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[32m+[m[32m                elif 'foldersearch' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
                     self.doFoldersearch(p1)[m
[31m-                elif "getdir" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'getdir' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     path = pathlib.Path.cwd()[m
                     self.setValue(p1, str(path))[m
[31m-                elif "makepath" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[32m+[m[32m                elif 'makepath' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
                     self.doMakepath(p1, p2, p3)[m
[31m-                elif command_name in ["setpassword", "setpassword2"]:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = str(self.getData(x["child"][3]))[m
[31m-                    p4 = "anonymouse"[m
[31m-                    if 5 <= len(x["child"]):[m
[31m-                        p4 = str(self.getData(x["child"][4]))[m
[32m+[m[32m                elif command_name in ['setpassword', 'setpassword2']:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = str(self.getData(x['child'][3]))[m
[32m+[m[32m                    p4 = 'anonymouse'[m
[32m+[m[32m                    if 5 <= len(x['child']):[m
[32m+[m[32m                        p4 = str(self.getData(x['child'][4]))[m
                     self.doSetpassword(p1, p2, p3, p4)[m
[31m-                elif command_name in ["getpassword", "getpassword2"]:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[31m-                    p3 = str(self.getKeywordName(x["child"][3]))[m
[31m-                    p4 = "anonymouse"[m
[31m-                    if 5 <= len(x["child"]):[m
[31m-                        p4 = str(self.getData(x["child"][4]))[m
[32m+[m[32m                elif command_name in ['getpassword', 'getpassword2']:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
[32m+[m[32m                    p3 = str(self.getKeywordName(x['child'][3]))[m
[32m+[m[32m                    p4 = 'anonymouse'[m
[32m+[m[32m                    if 5 <= len(x['child']):[m
[32m+[m[32m                        p4 = str(self.getData(x['child'][4]))[m
                     self.doGetpassword(p1, p2, p3, p4)[m
[31m-                elif command_name in ["ispassword", "ispassword2"]:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif command_name in ['ispassword', 'ispassword2']:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doIspassword(p1, p2)[m
[31m-                elif command_name in ["delpassword", "delpassword2"]:[m
[31m-                    p1 = self.getData(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif command_name in ['delpassword', 'delpassword2']:[m
[32m+[m[32m                    p1 = self.getData(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doDelpassword(p1, p2)[m
[31m-                elif "checksum8" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum8' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum8(p1, p2)[m
[31m-                elif "checksum8file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum8file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum8file(p1, p2)[m
[31m-                elif "checksum16" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum16' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum16(p1, p2)[m
[31m-                elif "checksum16file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum16file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum16file(p1, p2)[m
[31m-                elif "checksum32" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum32' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum32(p1, p2)[m
[31m-                elif "checksum32file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'checksum32file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doChecksum32file(p1, p2)[m
[31m-                elif "crc16" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc16' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc16(p1, p2)[m
[31m-                elif "crc16file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc16file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc16file(p1, p2)[m
[31m-                elif "crc32" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc32' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc32(p1, p2)[m
[31m-                elif "crc32file" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[31m-                    p2 = self.getData(x["child"][2])[m
[32m+[m[32m                elif 'crc32file' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
[32m+[m[32m                    p2 = self.getData(x['child'][2])[m
                     self.doCrc32file(p1, p2)[m
[31m-                elif "exec" == command_name:[m
[31m-                    self.doExec(line, x["child"][1:])[m
[31m-                elif "getdate" == command_name:[m
[31m-                    self.doGetdate(x["child"][1:])[m
[31m-                elif "getenv" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = self.getKeywordName(x["child"][2])[m
[32m+[m[32m                elif 'exec' == command_name:[m
[32m+[m[32m                    self.doExec(line, x['child'][1:])[m
[32m+[m[32m                elif 'getdate' == command_name:[m
[32m+[m[32m                    self.doGetdate(x['child'][1:])[m
[32m+[m[32m                elif 'getenv' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getKeywordName(x['child'][2])[m
                     # print(f"getenv1 c=({command_name}) l={p1} r={p2}")[m
                     p1 = os.getenv(p1)[m
                     if p1 is None:[m
[31m-                        p1 = ""[m
[32m+[m[32m                        p1 = ''[m
                     # print(f"getenv2 c=({command_name}) l={p1} r={p2}")[m
                     self.setValue(p2, p1)[m
[31m-                elif "getipv4addr" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'getipv4addr' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doGetipv4addr(p1, p2)[m
[31m-                elif "getipv6addr" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = str(self.getKeywordName(x["child"][2]))[m
[32m+[m[32m                elif 'getipv6addr' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getKeywordName(x['child'][2]))[m
                     self.doGetipv6addr(p1, p2)[m
[31m-                elif "gettime" == command_name:[m
[31m-                    self.doGetdate(x["child"][1:], format="%H:%M:%S")[m
[31m-                elif "getttdir" == command_name:[m
[31m-                    p1 = self.getKeywordName(x["child"][1])[m
[32m+[m[32m                elif 'gettime' == command_name:[m
[32m+[m[32m                    self.doGetdate(x['child'][1:], format='%H:%M:%S')[m
[32m+[m[32m                elif 'getttdir' == command_name:[m
[32m+[m[32m                    p1 = self.getKeywordName(x['child'][1])[m
                     self.setValue(p1, self.current_dir)[m
[31m-                elif "getver" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                elif 'getver' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     p2 = None[m
[31m-                    if 3 <= len(x["child"]):[m
[31m-                        p2 = float(self.getData(x["child"][2]))[m
[32m+[m[32m                    if 3 <= len(x['child']):[m
[32m+[m[32m                        p2 = float(self.getData(x['child'][2]))[m
                     self.doGetver(p1, p2)[m
[31m-                elif "ifdefined" == command_name:[m
[31m-                    p1 = str(x["child"][1])[m
[32m+[m[32m                elif 'ifdefined' == command_name:[m
[32m+[m[32m                    p1 = str(x['child'][1])[m
                     self.doIfdefined(p1)[m
[31m-                elif "intdim" == command_name:[m
[31m-                    p1 = x["child"][1][m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'intdim' == command_name:[m
[32m+[m[32m                    p1 = x['child'][1][m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     for i in range(p2):[m
[31m-                        self.setValue(p1 + "[" + str(i) + "]", 0)[m
[31m-                elif "random" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                        self.setValue(p1 + '[' + str(i) + ']', 0)[m
[32m+[m[32m                elif 'random' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     p1_val = random.randint(0, p2)[m
                     self.setValue(p1, p1_val)[m
[31m-                elif "setenv" == command_name:[m
[31m-                    p1 = str(self.getData(x["child"][1]))[m
[31m-                    p2 = str(self.getData(x["child"][2]))[m
[32m+[m[32m                elif 'setenv' == command_name:[m
[32m+[m[32m                    p1 = str(self.getData(x['child'][1]))[m
[32m+[m[32m                    p2 = str(self.getData(x['child'][2]))[m
                     os.environ[p1] = p2[m
                     # print(f"setenv2 c=({command_name}) l={p1} r={p2}")[m
[31m-                elif "setexitcode" == command_name:[m
[31m-                    p1 = self.getDataInt(x["child"][1])[m
[32m+[m[32m                elif 'setexitcode' == command_name:[m
[32m+[m[32m                    p1 = self.getDataInt(x['child'][1])[m
                     self.doSetexitcode(p1)[m
[31m-                elif "strdim" == command_name:[m
[31m-                    p1 = x["child"][1][m
[31m-                    p2 = self.getDataInt(x["child"][2])[m
[32m+[m[32m                elif 'strdim' == command_name:[m
[32m+[m[32m                    p1 = x['child'][1][m
[32m+[m[32m                    p2 = self.getDataInt(x['child'][2])[m
                     for i in range(p2):[m
[31m-                        self.setValue(p1 + "[" + str(i) + "]", "")[m
[31m-                elif "uptime" == command_name:[m
[31m-                    p1 = str(self.getKeywordName(x["child"][1]))[m
[32m+[m[32m                        self.setValue(p1 + '[' + str(i) + ']', '')[m
[32m+[m[32m                elif 'uptime' == command_name:[m
[32m+[m[32m                    p1 = str(self.getKeywordName(x['child'][1]))[m
                     self.setValue(p1, int(uptime.uptime() * 1000))[m
                 else:[m
                     # print(f"### l={line} ã‚³ãƒãƒ³ãƒ‰ãŒåˆ†ã‹ã‚‰ãªã„{name}")[m
[31m-                    self.commandContext(command_name, line, x["child"][1:])[m
[31m-            elif "ForNextContext" == name:[m
[31m-                self.forNextContext(x["child"])[m
[31m-            elif "WhileEndwhileContext" == name:[m
[31m-                self.whileEndwhileContext(x["child"])[m
[31m-            elif "UntilEnduntilContext" == name:[m
[31m-                self.untilEnduntilContext(x["child"])[m
[31m-            elif "DoLoopContext" == name:[m
[31m-                self.doLoopContext(x["child"])[m
[31m-            elif "If1Context" == name:[m
[31m-                self.if1Context(x["child"])[m
[31m-            elif "If2Context" == name:[m
[31m-                self.if2Context(x["child"])[m
[31m-            elif "LabelContext" != name:[m
[32m+[m[32m                    self.commandContext(command_name, line, x['child'][1:])[m
[32m+[m[32m            elif 'ForNextContext' == name:[m
[32m+[m[32m                self.forNextContext(x['child'])[m
[32m+[m[32m            elif 'WhileEndwhileContext' == name:[m
[32m+[m[32m                self.whileEndwhileContext(x['child'])[m
[32m+[m[32m            elif 'UntilEnduntilContext' == name:[m
[32m+[m[32m                self.untilEnduntilContext(x['child'])[m
[32m+[m[32m            elif 'DoLoopContext' == name:[m
[32m+[m[32m                self.doLoopContext(x['child'])[m
[32m+[m[32m            elif 'If1Context' == name:[m
[32m+[m[32m                self.if1Context(x['child'])[m
[32m+[m[32m            elif 'If2Context' == name:[m
[32m+[m[32m                self.if2Context(x['child'])[m
[32m+[m[32m            elif 'LabelContext' != name:[m
                 pass[m
             else:[m
[31m-                self.stop(error=f"### l={line} Unkown name={name}")[m
[32m+[m[32m                self.stop(error=f'### l={line} Unkown name={name}')[m
             if self.end_flag:[m
                 break[m
 [m
     def commandContext(self, name, line, data_list):[m
         """(GUIç³»ã‚’)ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã›ã¦ä½¿ã†"""[m
         # GUIã§ã—ã‹ã§ããªã„ã®ã§ãƒ€ãƒ‹ãƒ¼ã‚’å…¥ã‚Œã¦ãŠã[m
[31m-        if name in ["passwordbox", "inputbox", "listbox"]:[m
[32m+[m[32m        if name in ['passwordbox', 'inputbox', 'listbox']:[m
             # print(f"super.commandContext {name} start")[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("inputstr", "aaa")[m
[32m+[m[32m            self.setValue('inputstr', 'aaa')[m
             # print(f"super.commandContext {name} end")[m
         elif name in [[m
[31m-            "bringupbox",[m
[31m-            "closesbox",[m
[31m-            "messagebox",[m
[31m-            "statusbox",[m
[31m-            "setdlgpos",[m
[32m+[m[32m            'bringupbox',[m
[32m+[m[32m            'closesbox',[m
[32m+[m[32m            'messagebox',[m
[32m+[m[32m            'statusbox',[m
[32m+[m[32m            'setdlgpos',[m
         ]:[m
             self.printCommand(name, line, data_list)[m
[31m-        elif "dirnamebox" == name:[m
[32m+[m[32m        elif 'dirnamebox' == name:[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("result", 1)[m
[31m-            self.setValue("inputstr", str(os.getcwd()))[m
[31m-        elif "filenamebox" == name:[m
[32m+[m[32m            self.setValue('result', 1)[m
[32m+[m[32m            self.setValue('inputstr', str(os.getcwd()))[m
[32m+[m[32m        elif 'filenamebox' == name:[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("result", 0)[m
[31m-            self.setValue("inputstr", "tmp.txt")[m
[31m-        elif name in ["yesnobox"]:[m
[32m+[m[32m            self.setValue('result', 0)[m
[32m+[m[32m            self.setValue('inputstr', 'tmp.txt')[m
[32m+[m[32m        elif name in ['yesnobox']:[m
             self.printCommand(name, line, data_list)[m
[31m-            self.setValue("result", 1)[m
[31m-        elif name in ["showtt"]:[m
[32m+[m[32m            self.setValue('result', 1)[m
[32m+[m[32m        elif name in ['showtt']:[m
             self.printCommand(name, line, data_list)[m
             self.setValue(self.getKeywordName(data_list[0]), 0)[m
[31m-        elif name in ["setdlgpos", "show", "callmenu", "enablekeyb"]:[m
[32m+[m[32m        elif name in ['setdlgpos', 'show', 'callmenu', 'enablekeyb']:[m
             pass[m
         else:[m
             self.printCommand(name, line, data_list)[m
[36m@@ -1220,12 +1724,12 @@[m [mclass TtlPaserWolker(ABC):[m
             if isinstance(result, int):[m
                 result = str(result)[m
             elif isinstance(result, Label):[m
[31m-                result = "LABEL"[m
[32m+[m[32m                result = 'LABEL'[m
             if keywordName is None:[m
                 message = message + f" p({result})"[m
             else:[m
                 message = message + f" p({keywordName}/{result})"[m
[31m-        self.setLog(message + "\n")[m
[32m+[m[32m        self.setLogInner(message + "\n")[m
         return message[m
 [m
     def correctLabel(self):[m
[36m@@ -1237,20 +1741,20 @@[m [mclass TtlPaserWolker(ABC):[m
         i = -1[m
         for token_dict in token_list_list:[m
             i = i + 1[m
[31m-            name = token_dict["name"]  # StatementContext[m
[32m+[m[32m            name = token_dict['name']  # StatementContext[m
             # print(f"correctLabelAll i={i} {name}")[m
             if "StatementContext" == name:[m
                 # print("hit")[m
[31m-                self.correctLabelAll(token_dict["child"])  # StatementContext[m
[31m-            elif "CommandlineContext" == name:[m
[32m+[m[32m                self.correctLabelAll(token_dict['child'])  # StatementContext[m
[32m+[m[32m            elif 'CommandlineContext' == name:[m
                 # print("hit2")[m
                 j = -1[m
[31m-                next_list = token_dict["child"][m
[32m+[m[32m                next_list = token_dict['child'][m
                 for next in next_list:[m
                     j = j + 1[m
[31m-                    if "LabelContext" == next["name"]:[m
[32m+[m[32m                    if 'LabelContext' == next['name']:[m
                         # print(f"hot3 {next['child']}")[m
[31m-                        label_name = next["child"][1][m
[32m+[m[32m                        label_name = next['child'][1][m
                         # print("hit4")[m
                         label = Label(token_list_list[i + 1:])[m
                         # print(f"xxx data={label_name} // {label.getTokenList()}")[m
[36m@@ -1341,7 +1845,7 @@[m [mclass TtlPaserWolker(ABC):[m
                         # do/loop[m
                         # print(f"do/loop={data}")[m
                         pass[m
[31m-                    elif "CommandlineContext" == data["name"]:[m
[32m+[m[32m                    elif 'CommandlineContext' == data['name']:[m
                         # print(f"LineContext={data}")[m
                         self.execute_result([data])[m
                     else:[m
[36m@@ -1373,7 +1877,7 @@[m [mclass TtlPaserWolker(ABC):[m
             result = int(result)[m
         except (TypeError, ValueError) as e:[m
             if isinstance(data, dict):[m
[31m-                if "line" in data:[m
[32m+[m[32m                if 'line' in data:[m
                     raise TypeError(f"### l={data['line']} {type(e).__name__} e={e}")[m
             raise  # ãã®ã¾ã¾ä¸Šæµã¸é€ã‚‹[m
         return result[m
[36m@@ -1383,39 +1887,39 @@[m [mclass TtlPaserWolker(ABC):[m
         result = ""[m
         if isinstance(data, str):[m
             result = self.getValue(data)[m
[31m-        elif "name" not in data:[m
[32m+[m[32m        elif 'name' not in data:[m
             raise TypeError(f"unkown name data={str(data)}")[m
[31m-        elif "P11ExpressionContext" == data["name"]:[m
[31m-            result = self.p11ExpressionContext(data["child"])[m
[31m-        elif "P10ExpressionContext" == data["name"]:[m
[31m-            result = self.p10ExpressionContext(data["child"])[m
[31m-        elif "P9ExpressionContext" == data["name"]:[m
[31m-            result = self.p9ExpressionContext(data["child"])[m
[31m-        elif "P8ExpressionContext" == data["name"]:[m
[31m-            result = self.p8ExpressionContext(data["child"])[m
[31m-        elif "P7ExpressionContext" == data["name"]:[m
[31m-            result = self.p7ExpressionContext(data["child"])[m
[31m-        elif "P6ExpressionContext" == data["name"]:[m
[31m-            result = self.p6ExpressionContext(data["child"])[m
[31m-        elif "P5ExpressionContext" == data["name"]:[m
[31m-            result = self.p5ExpressionContext(data["child"])[m
[31m-        elif "P4ExpressionContext" == data["name"]:[m
[31m-            result = self.p4ExpressionContext(data["child"])[m
[31m-        elif "P3ExpressionContext" == data["name"]:[m
[31m-            result = self.p3ExpressionContext(data["child"])[m
[31m-        elif "P2ExpressionContext" == data["name"]:[m
[31m-            result = self.p2ExpressionContext(data["child"])[m
[31m-        elif "P1ExpressionContext" == data["name"]:[m
[31m-            result = self.p1ExpressionContext(data["child"])[m
[31m-        elif "IntExpressionContext" == data["name"]:[m
[31m-            result = self.intExpressionContext(data["child"])[m
[31m-        elif "StrExpressionContext" == data["name"]:[m
[31m-            result = self.strExpressionContext(data["child"])[m
[31m-        elif "IntContextContext" == data["name"]:[m
[31m-            result = self.intContext(data["child"])[m
[31m-        elif "StrContextContext" == data["name"]:[m
[31m-            result = self.strContext(data["child"])[m
[31m-        elif "KeywordContext" == data["name"]:[m
[32m+[m[32m        elif 'P11ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p11ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P10ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p10ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P9ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p9ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P8ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p8ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P7ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p7ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P6ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p6ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P5ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p5ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P4ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p4ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P3ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p3ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P2ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p2ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'P1ExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.p1ExpressionContext(data['child'])[m
[32m+[m[32m        elif 'IntExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.intExpressionContext(data['child'])[m
[32m+[m[32m        elif 'StrExpressionContext' == data['name']:[m
[32m+[m[32m            result = self.strExpressionContext(data['child'])[m
[32m+[m[32m        elif 'IntContextContext' == data['name']:[m
[32m+[m[32m            result = self.intContext(data['child'])[m
[32m+[m[32m        elif 'StrContextContext' == data['name']:[m
[32m+[m[32m            result = self.strContext(data['child'])[m
[32m+[m[32m        elif 'KeywordContext' == data['name']:[m
             result = self.keywordContext(data)[m
         else:[m
             raise TypeError(f"unkown keyword n={data['name']}")[m
[36m@@ -1454,7 +1958,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # print(f"p9ExpressionContext count={2} data={data[2]['name']} child={data[2]['child']} ")[m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "==" == oper or "=" == oper:[m
[32m+[m[32m        if '==' == oper or '=' == oper:[m
             result = val1 == val2[m
         else:  # <> or !=[m
             result = val1 != val2[m
[36m@@ -1470,11 +1974,11 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "<" == oper:[m
[32m+[m[32m        if '<' == oper:[m
             result = val1 < val2[m
[31m-        elif "<=" == oper:[m
[32m+[m[32m        elif '<=' == oper:[m
             result = val1 <= val2[m
[31m-        elif ">" == oper:[m
[32m+[m[32m        elif '>' == oper:[m
             result = val1 > val2[m
         else:  # '>='[m
             result = val1 >= val2[m
[36m@@ -1523,11 +2027,11 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if ">>>" == oper:[m
[32m+[m[32m        if '>>>' == oper:[m
             result = val1 >> val2[m
[31m-        elif ">>" == oper:[m
[32m+[m[32m        elif '>>' == oper:[m
             result = val1 >> val2[m
[31m-        elif "<<" == oper:[m
[32m+[m[32m        elif '<<' == oper:[m
             result = val1 << val2[m
         return result[m
 [m
[36m@@ -1539,9 +2043,9 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "+" == oper:[m
[32m+[m[32m        if '+' == oper:[m
             result = val1 + val2[m
[31m-        elif "-" == oper:[m
[32m+[m[32m        elif '-' == oper:[m
             result = val1 - val2[m
         return result[m
 [m
[36m@@ -1553,14 +2057,14 @@[m [mclass TtlPaserWolker(ABC):[m
         oper = data[1][m
         val2 = self.getDataInt(data[2])[m
         result = 0[m
[31m-        if "*" == oper:[m
[32m+[m[32m        if '*' == oper:[m
             result = val1 * val2[m
[31m-        elif "/" == oper:[m
[32m+[m[32m        elif '/' == oper:[m
             try:[m
                 result = val1 // val2[m
             except ZeroDivisionError as e:[m
                 raise TypeError(f"ZeroDivisionError e={str(e)}")[m
[31m-        elif "%" == oper:[m
[32m+[m[32m        elif '%' == oper:[m
             try:[m
                 result = val1 % val2[m
             except ZeroDivisionError as e:[m
[36m@@ -1589,10 +2093,10 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def strContext(self, data_list):[m
         # print(f"str={data_list}")[m
[31m-        result = ""[m
[32m+[m[32m        result = ''[m
         for data in data_list:[m
             state = 0[m
[31m-            old = ""[m
[32m+[m[32m            old = ''[m
             for i in range(len(data)):[m
                 hit_flag = False[m
                 ch0 = data[i][m
[36m@@ -1604,14 +2108,14 @@[m [mclass TtlPaserWolker(ABC):[m
                     elif ch0 == '"':[m
                         state = 2[m
                         hit_flag = True[m
[31m-                    elif ch0 == "#":[m
[32m+[m[32m                    elif ch0 == '#':[m
                         hit_flag = True[m
                     else:[m
                         old = old + ch0[m
                     if hit_flag:[m
                         result = result + self.getChrSharp_str(old)[m
[31m-                        old = ""  # clear[m
[31m-                        if ch0 == "#":[m
[32m+[m[32m                        old = ''  # clear[m
[32m+[m[32m                        if ch0 == '#':[m
                             old = ch0[m
                 elif state == 1:[m
                     if ch0 == "'":[m
[36m@@ -1629,21 +2133,21 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def getChrSharp_str(self, base) -> str:[m
         if len(base) <= 0:[m
[31m-            return ""[m
[32m+[m[32m            return ''[m
         #[m
         # print(f"\tbaseB={base}")[m
[31m-        if "#" == base[0]:[m
[32m+[m[32m        if '#' == base[0]:[m
             # print(f"\tbaseC={base} data={base[1:]}")[m
             base = self.getChrSharp(self.getAsciiNum(base[1:]))[m
             # print(f"\tbaseD={base} data={base[1:]}")[m
[31m-        elif "$" == base[0]:[m
[32m+[m[32m        elif '$' == base[0]:[m
             base = self.getAsciiNum(base)[m
         return base[m
 [m
     def getChrSharp(self, data: int) -> str:[m
         if data <= 0:[m
             return chr(data & 0xFF)[m
[31m-        result = ""[m
[32m+[m[32m        result = ''[m
         while 0 < data:[m
             result = chr(data & 0xFF) + result[m
             data = data >> 8[m
[36m@@ -1652,9 +2156,9 @@[m [mclass TtlPaserWolker(ABC):[m
     def getSharpChr(self, data: str) -> int:[m
         # print(f"getSharpChr {data}")[m
         if len(data) <= 0:[m
[31m-            return ""[m
[32m+[m[32m            return ''[m
         result = 0[m
[31m-        while "" != data:[m
[32m+[m[32m        while '' != data:[m
             result = (result * 256) + ord(data[0])[m
             data = data[1:][m
         return result[m
[36m@@ -1663,7 +2167,7 @@[m [mclass TtlPaserWolker(ABC):[m
         result = 0[m
         data = data_list[0][m
         # print(f"intContext={data}")[m
[31m-        if 0 < len(data) and data[0] == "$":[m
[32m+[m[32m        if 0 < len(data) and data[0] == '$':[m
             result = self.getAsciiNum(data)[m
         else:[m
             result = int(data)[m
[36m@@ -1671,7 +2175,7 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def getAsciiNum(self, data: str) -> int:[m
         # print(f"getAsciiNum={data} len={len(data)} data[0]={data[0]}")[m
[31m-        if (0 < len(data)) and ("$" == data[0]):[m
[32m+[m[32m        if (0 < len(data)) and ('$' == data[0]):[m
             ans = int(data[1:], 16)[m
             # print(f"data[1:]={data[1:]} ans={ans}")[m
             return ans[m
[36m@@ -1680,7 +2184,7 @@[m [mclass TtlPaserWolker(ABC):[m
     def getKeywordName(self, data):[m
         """æ§‹æ–‡å†…ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åã‚’å–å¾—ã™ã‚‹"""[m
         # print(f"keywordName {data}")[m
[31m-        if "name" not in data:[m
[32m+[m[32m        if 'name' not in data:[m
             if isinstance(data, str):[m
                 return data[m
             elif isinstance(data, list):[m
[36m@@ -1688,14 +2192,14 @@[m [mclass TtlPaserWolker(ABC):[m
             raise TypeError("keywordName name not in data")[m
         #[m
         # this is dict[m
[31m-        if "StrExpressionContext" == data["name"]:[m
[31m-            return self.getKeywordName(data["child"][0])[m
[31m-        elif "KeywordContext" != data["name"]:[m
[32m+[m[32m        if 'StrExpressionContext' == data['name']:[m
[32m+[m[32m            return self.getKeywordName(data['child'][0])[m
[32m+[m[32m        elif 'KeywordContext' != data['name']:[m
             raise TypeError([m
                 f"### l={data['line']} keywordName name is not KeywordContext {data}"[m
             )[m
         #[m
[31m-        data = data["child"][m
[32m+[m[32m        data = data['child'][m
         # print(f"data={data} len={len(data)}")[m
         if len(data) == 1:[m
             # å˜ç´”æŒ‡å®š[m
[36m@@ -1704,7 +2208,7 @@[m [mclass TtlPaserWolker(ABC):[m
             # é…åˆ—å¯¾ç­–[m
             index = data[2][m
             index = self.getData(index)[m
[31m-            return data[0] + "[" + str(int(index)) + "]"[m
[32m+[m[32m            return data[0] + '[' + str(int(index)) + ']'[m
 [m
     def keywordContext(self, data):[m
         """æ§‹æ–‡å†…ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰å€¤ã‚’æŠ½å‡ºã™ã‚‹"""[m
[36m@@ -1749,74 +2253,119 @@[m [mclass TtlPaserWolker(ABC):[m
         """æ¥ç¶šã™ã‚‹"""[m
         # print(f"do connect data={data}")[m
         if self.client is not None:[m
[31m-            self.setValue("error", "Already connected")[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('error', 'Already connected')[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         param_list = re.split(r"[ \t]+", data)[m
[31m-        server = "localhost"[m
[32m+[m[32m        server = 'localhost'[m
         user = None[m
         passwd = None[m
         keyfile = None[m
[31m-        port_number = 22[m
[32m+[m[32m        com_key = None[m
[32m+[m[32m        port_number = None[m
         param_cmd = False[m
[32m+[m[32m        telnet = False[m
[32m+[m[32m        telnet_t = 0[m
         for param in param_list:[m
             if len(param) <= 0:[m
                 continue[m
[31m-            if param[0] != "/":[m
[31m-                server = param.split(":")[m
[32m+[m[32m            if param[0] != '/':[m
[32m+[m[32m                server = param.split(':')[m
                 if len(server) == 1:[m
                     server = server[0][m
                 elif len(server) == 2:[m
                     port_number = int(server[1])[m
                     server = server[0][m
                 else:[m
[31m-                    self.setValue("error", "Invalid server name")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                    self.setValue('error', 'Invalid server name')[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
             else:[m
[31m-                user_string = "user="[m
[31m-                passwd_string = "passwd="[m
[31m-                keyfile_string = "keyfile="[m
[32m+[m[32m                user_string = 'user='[m
[32m+[m[32m                passwd_string = 'passwd='[m
[32m+[m[32m                keyfile_string = 'keyfile='[m
[32m+[m[32m                com_string = 'C='[m
                 param = param[1:][m
                 # print(f"\tparam={param}")[m
                 if "ssh" == param:[m
                     pass[m
[31m-                elif "1" == param:[m
[31m-                    self.setValue("error", "SSH1 not support")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                elif '1' == param:[m
[32m+[m[32m                    self.setValue('error', 'SSH1 not support')[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
[31m-                elif "2" == param:[m
[32m+[m[32m                elif '2' == param:[m
                     pass  # SSH2[m
[31m-                elif "cmd" == param:[m
[32m+[m[32m                elif 'cmd' == param:[m
                     param_cmd = True[m
[31m-                elif "ask4passwd" == param:[m
[31m-                    self.setValue("error", "Not Support ask4passwd error!")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                elif 't=0' == param.lower():[m
[32m+[m[32m                    telnet_t = 0[m
[32m+[m[32m                elif 't=1' == param.lower():[m
[32m+[m[32m                    telnet_t = 1[m
[32m+[m[32m                elif 'nossh' == param.lower():[m
[32m+[m[32m                    telnet = True[m
[32m+[m[32m                elif 'ask4passwd' == param:[m
[32m+[m[32m                    self.setValue('error', 'Not Support ask4passwd error!')[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
[31m-                elif "auth=password" == param:[m
[32m+[m[32m                elif 'auth=password' == param:[m
                     pass  # ã‚ã‹ã‚‰ã‚“[m
[31m-                elif "auth=publickey" == param:[m
[32m+[m[32m                elif 'auth=publickey' == param:[m
                     pass  # ã‚ã‹ã‚‰ã‚“[m
[31m-                elif "auth=challenge" == param:[m
[32m+[m[32m                elif 'auth=challenge' == param:[m
                     pass  # ã‚ã‹ã‚‰ã‚“[m
[31m-                elif re.search("^" + user_string, param):[m
[32m+[m[32m                elif re.search('^' + user_string, param):[m
                     user = param[len(user_string):][m
[31m-                elif re.search("^" + passwd_string, param):[m
[32m+[m[32m                elif re.search('^' + passwd_string, param):[m
                     passwd = param[len(passwd_string):][m
[31m-                elif re.search("^" + keyfile_string, param):[m
[32m+[m[32m                elif re.search('^' + keyfile_string, param):[m
                     keyfile = param[len(keyfile_string):][m
                     keyfile = self.normpath(keyfile)[m
[32m+[m[32m                elif re.search('^' + com_string, param):[m
[32m+[m[32m                    com_key = param[len(com_string):][m
[32m+[m[32m                    com_key = self.normpath(com_key)[m
                 else:[m
                     # çŸ¥ã‚‰ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¥ãŸã‚‰åœæ­¢ã™ã‚‹[m
[31m-                    self.setValue("error", f"unkown paramater={param}")[m
[31m-                    self.setValue("result", 0)[m
[32m+[m[32m                    self.setValue('error', f"unkown paramater={param}")[m
[32m+[m[32m                    self.setValue('result', 0)[m
                     return[m
         #[m
         # å‰ã®æ¥ç¶šã¯å‰Šé™¤[m
         self.closeClient()[m
[32m+[m[32m        #[m
[32m+[m[32m        if port_number is None:  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å¤‰ãˆã¦ã„ãªã„å ´åˆ[m
[32m+[m[32m            if telnet:[m
[32m+[m[32m                port_number = 23[m
[32m+[m[32m            else:[m
[32m+[m[32m                port_number = 22[m
[32m+[m
         #[m
         # ã“ã“ã‹ã‚‰æ¥ç¶šå‡¦ç†[m
[31m-        if not param_cmd:[m
[32m+[m[32m        if com_key is not None:[m
[32m+[m[32m            try:[m
[32m+[m[32m                self.shell = MySerial([m
[32m+[m[32m                    com_key, self.speed,[m
[32m+[m[32m                    flowctrl=self.flowctrl,[m
[32m+[m[32m                    flowctrl_dtr=self.flowctrl_dtr,[m
[32m+[m[32m                    flowctrl_rts=self.flowctrl_rts)[m
[32m+[m[32m                self.setValue('result', 2)[m
[32m+[m[32m            except Exception as e:[m
[32m+[m[32m                self.setValue('error', f"### l={line} {type(e).__name__} e={e}")[m
[32m+[m[32m                self.setValue('result', 0)[m
[32m+[m[32m                self.closeClient()[m
[32m+[m[32m        elif telnet:[m
[32m+[m[32m            try:[m
[32m+[m[32m                client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)[m
[32m+[m[32m                client.connect((server, port_number))[m
[32m+[m[32m                if telnet_t == 0:[m
[32m+[m[32m                    self.shell = MyTelnetT0(client)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    self.shell = MyTelnetT1(client)[m
[32m+[m[32m                self.setValue('result', 2)[m
[32m+[m[32m            except Exception as e:[m
[32m+[m[32m                self.setValue('error', f"### l={line} {type(e).__name__} e={e}")[m
[32m+[m[32m                self.setValue('result', 0)[m
[32m+[m[32m                self.closeClient()[m
[32m+[m[32m        elif not param_cmd:[m
             try:[m
                 self.client = paramiko.SSHClient()[m
                 self.client.set_missing_host_key_policy(paramiko.AutoAddPolicy())[m
[36m@@ -1838,7 +2387,7 @@[m [mclass TtlPaserWolker(ABC):[m
                 #[m
                 # æ¥ç¶šæˆåŠŸ[m
                 #[m
[31m-                self.setValue("result", 2)[m
[32m+[m[32m                self.setValue('result', 2)[m
                 self.log_connect_time = time.time()[m
                 # print("connect OK !")[m
                 #[m
[36m@@ -1848,8 +2397,8 @@[m [mclass TtlPaserWolker(ABC):[m
                 paramiko.AuthenticationException,[m
                 paramiko.SSHException,[m
             ) as e:[m
[31m-                self.setValue("error", f"### l={line} {type(e).__name__} e={e}")[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('error', f"### l={line} {type(e).__name__} e={e}")[m
[32m+[m[32m                self.setValue('result', 0)[m
                 self.closeClient()[m
         else:[m
             if platform.system().lower() == "linux":[m
[36m@@ -1860,7 +2409,7 @@[m [mclass TtlPaserWolker(ABC):[m
                 self.shell = MyShell()[m
             #[m
             # æ¥ç¶šæˆåŠŸ[m
[31m-            self.setValue("result", 2)[m
[32m+[m[32m            self.setValue('result', 2)[m
 [m
     def doDispstr(self, data_list):[m
         for data in data_list:[m
[36m@@ -1877,7 +2426,7 @@[m [mclass TtlPaserWolker(ABC):[m
         """getmodemstatus å‡¦ç†ç”¨"""[m
         # print(f"{p1}")[m
         self.setValue(p1, 0)[m
[31m-        self.setValue("result", 1)  # å¿…ãšå¤±æ•—[m
[32m+[m[32m        self.setValue('result', 1)  # å¿…ãšå¤±æ•—[m
 [m
     def doGethostname(self, p1):[m
         """ãƒ›ã‚¹ãƒˆåã®å–å¾—"""[m
[36m@@ -1893,9 +2442,9 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def doTestlink(self):[m
         if self.shell is None or not self.shell.active:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         else:[m
[31m-            self.setValue("result", 2)[m
[32m+[m[32m            self.setValue('result', 2)[m
 [m
     def doSend(self, data_list):[m
         # print(f"doSend() d={data_list}")[m
[36m@@ -1951,7 +2500,7 @@[m [mclass TtlPaserWolker(ABC):[m
     def doFlushrecv(self):[m
         """do flush"""[m
         # ã™ã§ã«èª­ã‚“ã ã‚‚ã®ã‚’ç©ºã«ã™ã‚‹[m
[31m-        self.stdout = ""[m
[32m+[m[32m        self.stdout = ''[m
         #[m
         # ã¾ã èª­ã‚ã¦ãªã„ã‚‚ã®ã‚’ç©ºã«ã™ã‚‹[m
         while not self.end_flag:[m
[36m@@ -1963,9 +2512,10 @@[m [mclass TtlPaserWolker(ABC):[m
             if not local_ssh.recv_ready():[m
                 break[m
             #[m
[31m-            output = local_ssh.recv(1024).decode("utf-8")[m
[32m+[m[32m            output = local_ssh.recv(1024).decode('utf-8', errors='xmlcharrefreplace')[m
             if output is None:[m
                 break[m
[32m+[m[32m            output = self.split_escape(output)  # escapeæ–‡å­—ã‚’å¹ãé£›ã°ã™[m
             self.setLogInner(output)[m
 [m
     def doWaitAll(self, result_list):[m
[36m@@ -1974,7 +2524,7 @@[m [mclass TtlPaserWolker(ABC):[m
         now_time = time.time()[m
         result = 0[m
         hit_flag = False[m
[31m-        self.setValue("result", 0)[m
[32m+[m[32m        self.setValue('result', 0)[m
         while not self.end_flag and not hit_flag:[m
             #[m
             if m_timeout != 0:[m
[36m@@ -2006,7 +2556,7 @@[m [mclass TtlPaserWolker(ABC):[m
                 # print(f"remain1=/{self.stdout}/ cutlen={max + result_len}")[m
                 self.stdout = self.stdout[max + result_len:][m
                 # print(f"remain2=/{self.stdout.strip()}/")[m
[31m-                self.setValue("result", result)[m
[32m+[m[32m                self.setValue('result', result)[m
                 # ãƒ’ãƒƒãƒˆã—ã¦ã„ãŸã‚‰çµ‚äº†[m
                 break[m
             #[m
[36m@@ -2018,10 +2568,12 @@[m [mclass TtlPaserWolker(ABC):[m
             if local_ssh.recv_ready():[m
                 now_time = time.time()  # æœ€å¾Œã®æ™‚é–“æ›´æ–°[m
                 # print("recv start! ============")[m
[31m-                output = local_ssh.recv(1024).decode("utf-8")[m
[32m+[m[32m                output = local_ssh.recv(1024)[m
                 # print(f"recv! end {output} ============")[m
                 if output is None:[m
                     break[m
[32m+[m[32m                output = output.decode('utf-8', errors='xmlcharrefreplace')[m
[32m+[m[32m                output = self.split_escape(output)  # escapeæ–‡å­—ã‚’å¹ãé£›ã°ã™[m
                 self.setLogInner(output)[m
                 self.stdout = self.stdout + output[m
                 #[m
[36m@@ -2031,10 +2583,10 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def getTimer(self) -> float:[m
         m_timeout = 0.0[m
[31m-        x = self.getValue("timeout", error_stop=False)[m
[32m+[m[32m        x = self.getValue('timeout', error_stop=False)[m
         if x is not None:[m
             m_timeout = int(x)[m
[31m-        x = self.getValue("mtimeout", error_stop=False)[m
[32m+[m[32m        x = self.getValue('mtimeout', error_stop=False)[m
         if x is not None:[m
             m_timeout = m_timeout + (int(x) / 1000)[m
         return m_timeout[m
[36m@@ -2093,7 +2645,7 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚ã‚Šãªã‚‰æœ€åˆã«æ›¸ãè¾¼ã‚€[m
         if self.log_timestamp_type != -1:[m
[31m-            self.log_file_handle.write(self.getTimestamp().encode("utf-8"))[m
[32m+[m[32m            self.log_file_handle.write(self.getTimestamp().encode('utf-8'))[m
 [m
     def doLogpause(self):[m
         self.log_start = False[m
[36m@@ -2106,7 +2658,7 @@[m [mclass TtlPaserWolker(ABC):[m
         self.log_start = True[m
 [m
     def doLogwrite(self, strvar: str):[m
[31m-        """ç„¡æ¡ä»¶ã§æ›¸ãè¾¼ã‚€"""[m
[32m+[m[32m        """ log write """[m
         if self.log_file_handle is None:[m
             # ãƒ­ã‚°ãŒé–‹ã‹ã‚Œã¦ã„ãªã„[m
             return[m
[36m@@ -2114,34 +2666,34 @@[m [mclass TtlPaserWolker(ABC):[m
         if self.log_timestamp_type == -1:[m
             # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ä¸è¦[m
             if isinstance(strvar, str):[m
[31m-                strvar = strvar.encode("utf-8")[m
[32m+[m[32m                strvar = strvar.encode('utf-8')[m
             self.log_file_handle.write(strvar)[m
         else:[m
             # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹[m
             while True:[m
[31m-                if strvar == "":[m
[32m+[m[32m                if strvar == '':[m
                     break[m
                 index = strvar.find("\n")[m
                 if index < 0:[m
                     if isinstance(strvar, str):[m
[31m-                        strvar = strvar.encode("utf-8")[m
[32m+[m[32m                        strvar = strvar.encode('utf-8')[m
                     self.log_file_handle.write(strvar)[m
                     break[m
                 target = strvar[: index + 1][m
                 if isinstance(target, str):[m
[31m-                    target = target.encode("utf-8")[m
[32m+[m[32m                    target = target.encode('utf-8')[m
                 self.log_file_handle.write(target)[m
[31m-                self.log_file_handle.write(self.getTimestamp().encode("utf-8"))[m
[32m+[m[32m                self.log_file_handle.write(self.getTimestamp().encode('utf-8'))[m
                 strvar = strvar[index + 1:][m
 [m
     def getTimestamp(self) -> str:[m
         """ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å…¥ã‚Œã‚‹"""[m
         if self.log_timestamp_type == 0:[m
             # ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ [m
[31m-            return "[" + datetime.now().strftime("%Y-%m-%d %H:%M:%S") + "]"[m
[32m+[m[32m            return '[' + datetime.now().strftime('%Y-%m-%d %H:%M:%S') + ']'[m
         elif self.log_timestamp_type == 1:[m
             # UTC[m
[31m-            return "[" + datetime.now(timezone.utc).strftime("%Y-%m-%d %H:%M:%S") + "]"[m
[32m+[m[32m            return '[' + datetime.now(timezone.utc).strftime('%Y-%m-%d %H:%M:%S') + ']'[m
         elif self.log_timestamp_type == 2:[m
             # çµŒéæ™‚é–“ (Logging)[m
             return self.getTimestampElapsed(self.log_login_time)[m
[36m@@ -2161,8 +2713,12 @@[m [mclass TtlPaserWolker(ABC):[m
         return f"[{day} {hours:02}:{minutes:02}:{seconds:02}]"[m
 [m
     def setLogInner(self, strvar: str):[m
[31m-        """ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ãŒå¿…è¦ãªã‚‰ã“ã¡ã‚‰ã‚’ä½¿ã„ã¾ã™"""[m
[32m+[m[32m        """ ãƒ­ã‚°æ›¸ãè¾¼ã¿å‰ã«äº‹å‰å‡¦ç†ã‚’è¡Œã„ã¾ã™ """[m
         #[m
[32m+[m[32m        strvar = strvar.replace("\r\n", "\n")[m
[32m+[m[32m        strvar = strvar.replace("\r", "\n")[m
[32m+[m[32m        if "\n" != os.linesep:[m
[32m+[m[32m            strvar = strvar.replace("\n", os.linesep)[m
         # ãƒ­ã‚°å‡ºåŠ›/ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹æ–¹ã«æ¸¡ã™[m
         self.setLog(strvar)[m
         #[m
[36m@@ -2176,46 +2732,46 @@[m [mclass TtlPaserWolker(ABC):[m
         pass[m
 [m
     def doChecksum8(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.getChecksum(p1, p2_byte, 0x0F)[m
 [m
     def doChecksum8file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.getChecksum(p1, p2_byte, 0x0F)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doChecksum16(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.getChecksum(p1, p2_byte, 0xFF)[m
 [m
     def doChecksum16file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.getChecksum(p1, p2_byte, 0xFF)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doChecksum32(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.getChecksum(p1, p2_byte, 0xFFFF)[m
 [m
     def doChecksum32file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.getChecksum(p1, p2_byte, 0xFFFF)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def getChecksum(self, p1: str, p2_byte, mask: int):[m
         sum = 0[m
[36m@@ -2225,18 +2781,18 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(p1, sum)[m
 [m
     def doCrc16(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.crc16_IBM_SDLC(p1, p2_byte)[m
 [m
     def doCrc16file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.crc16_IBM_SDLC(p1, p2_byte)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def crc16_IBM_SDLC(self, p1: str, data: bytes):[m
         r = 0xFFFF[m
[36m@@ -2251,18 +2807,18 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(p1, r)[m
 [m
     def doCrc32(self, p1: str, p2: str):[m
[31m-        p2_byte = p2.encode("utf-8")[m
[32m+[m[32m        p2_byte = p2.encode('utf-8')[m
         self.crc32_IBM_SDLC(p1, p2_byte)[m
 [m
     def doCrc32file(self, p1: str, p2: str):[m
         self.setValue(p1, 0)  # default value[m
         try:[m
[31m-            with open(p2, "rb") as f:[m
[32m+[m[32m            with open(p2, 'rb') as f:[m
                 p2_byte = f.read()[m
                 self.crc32_IBM_SDLC(p1, p2_byte)[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         except Exception:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def crc32_IBM_SDLC(self, p1: str, data: bytes):[m
         r = 0xFFFFFFFF[m
[36m@@ -2284,31 +2840,31 @@[m [mclass TtlPaserWolker(ABC):[m
         show = 1  # SW_SHOWNORMAL[m
         if 2 <= (data_len):[m
             show = self.getData(data_line[1]).lower()[m
[31m-            if "show" == show:[m
[32m+[m[32m            if 'show' == show:[m
                 pass[m
[31m-            elif "minimize" == show:[m
[32m+[m[32m            elif 'minimize' == show:[m
                 show = 6  # SW_MINIMIZE[m
[31m-            elif "maximize" == show:[m
[32m+[m[32m            elif 'maximize' == show:[m
                 show = 3  # SW_MAXIMIZE[m
[31m-            elif "hide" == show:[m
[32m+[m[32m            elif 'hide' == show:[m
                 show = 0  # SW_HIDE[m
             else:[m
                 raise TypeError(f"### l={line} doExec type error")[m
         wait = 0[m
         if 3 <= (data_len):[m
             wait = self.getDataInt(data_line[2])[m
[31m-        base_directory = "."[m
[32m+[m[32m        base_directory = '.'[m
         if 4 <= (data_len):[m
             base_directory = self.getData(data_line[3])[m
             if not os.path.isdir(base_directory):[m
[31m-                base_directory = "."[m
[32m+[m[32m                base_directory = '.'[m
         # print(f"\tcommand_list={command_list}")[m
         # print(f"\tshow={show}")[m
         # print(f"\twait={wait}")[m
         # print(f"\tbase_directory={base_directory}")[m
         #[m
         si = None[m
[31m-        if platform.system().lower() != "linux":[m
[32m+[m[32m        if platform.system().lower() != 'linux':[m
             si = subprocess.STARTUPINFO()[m
             si.dwFlags |= subprocess.STARTF_USESHOWWINDOW[m
             si.wShowWindow = 0  # SW_HIDE[m
[36m@@ -2317,9 +2873,9 @@[m [mclass TtlPaserWolker(ABC):[m
         )[m
         if wait != 0:[m
             p.wait()  # ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚äº†ã™ã‚‹ã¾ã§å¾…æ©Ÿ[m
[31m-            self.setValue("result", p.returncode)[m
[32m+[m[32m            self.setValue('result', p.returncode)[m
 [m
[31m-    def doGetdate(self, data_line, format="%Y-%m-%d"):[m
[32m+[m[32m    def doGetdate(self, data_line, format='%Y-%m-%d'):[m
         date = self.getKeywordName(data_line[0])[m
         data_len = len(data_line)[m
         if 2 <= data_len:[m
[36m@@ -2329,7 +2885,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # print(f"timezone={local_timezone}")[m
         if 3 <= data_len:[m
             local_timezone = self.getData(data_line[2])[m
[31m-        date_str = ""[m
[32m+[m[32m        date_str = ''[m
         if local_timezone is None:[m
             local_now = datetime.now()[m
         else:[m
[36m@@ -2338,25 +2894,25 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(date, date_str)[m
 [m
     def doExpandenv(self, p1, p2):[m
[31m-        if platform.system().lower() != "linux":[m
[32m+[m[32m        if platform.system().lower() != 'linux':[m
             p2 = os.path.expandvars(p2)[m
         else:[m
             pattern = r"%(.*?)%"[m
             p2 = re.sub(pattern, lambda match: f"%{match.group(1).lower()}%", p2)[m
[31m-            p2 = p2.replace("%windir%", "c:\\windows")[m
[31m-            p2 = p2.replace("%systemroot%", "/root")[m
[31m-            p2 = p2.replace("%programfiles%", "/usr/local")[m
[31m-            p2 = p2.replace("%programfiles(x86)%", "/usr/local")[m
[31m-            p2 = p2.replace("%userprofile%", os.environ.get("HOME"))[m
[31m-            p2 = p2.replace("%appdata%", "/usr/local")[m
[31m-            p2 = p2.replace("%localappdata%", "/usr/local")[m
[31m-            p2 = p2.replace("%temp%", "/tmp")[m
[31m-            p2 = p2.replace("%tmp%", "/tmp")[m
[31m-            p2 = p2.replace("%computerprogramfiles%", "/usr/local")[m
[31m-            p2 = p2.replace("%public%", os.environ.get("HOME"))[m
[31m-            p2 = p2.replace("%computername%", socket.gethostname())[m
[31m-            p2 = p2.replace("%username%", getpass.getuser())[m
[31m-            p2 = p2.replace("%path%", os.environ.get("PATH"))[m
[32m+[m[32m            p2 = p2.replace('%windir%', 'c:\\windows')[m
[32m+[m[32m            p2 = p2.replace('%systemroot%', '/root')[m
[32m+[m[32m            p2 = p2.replace('%programfiles%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%programfiles(x86)%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%userprofile%', os.environ.get('HOME'))[m
[32m+[m[32m            p2 = p2.replace('%appdata%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%localappdata%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%temp%', '/tmp')[m
[32m+[m[32m            p2 = p2.replace('%tmp%', '/tmp')[m
[32m+[m[32m            p2 = p2.replace('%computerprogramfiles%', '/usr/local')[m
[32m+[m[32m            p2 = p2.replace('%public%', os.environ.get('HOME'))[m
[32m+[m[32m            p2 = p2.replace('%computername%', socket.gethostname())[m
[32m+[m[32m            p2 = p2.replace('%username%', getpass.getuser())[m
[32m+[m[32m            p2 = p2.replace('%path%', os.environ.get('PATH'))[m
         #[m
         self.setValue(p1, p2)[m
 [m
[36m@@ -2370,7 +2926,7 @@[m [mclass TtlPaserWolker(ABC):[m
         strvar = format % tuple(data_new)[m
         # print(f"strvar={strvar}")[m
         self.setValue(inputstr, strvar)[m
[31m-        self.setValue("result", 0)[m
[32m+[m[32m        self.setValue('result', 0)[m
 [m
     def doPause(self, p1):[m
         """æŒ‡å®šã•ã‚ŒãŸç§’æ•°å¾…ã¤"""[m
[36m@@ -2391,7 +2947,7 @@[m [mclass TtlPaserWolker(ABC):[m
 [m
     def doStrtrim(self, p1_var: str, p2: str) -> str:[m
         # ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’å¤‰æ›ã™ã‚‹[m
[31m-        p2 = p2.encode().decode("unicode_escape")[m
[32m+[m[32m        p2 = p2.encode().decode('unicode_escape', errors='xmlcharrefreplace')[m
 [m
         # å‰æ–¹æ–¹å‘[m
         while 0 < len(p1_var):[m
[36m@@ -2414,24 +2970,24 @@[m [mclass TtlPaserWolker(ABC):[m
         worker = {}[m
         filename = self.normpath(filename)[m
         worker = self.get_encrypt_file(filename)[m
[31m-        encrypt_byte = encrypt_str.encode("utf-8")[m
[32m+[m[32m        encrypt_byte = encrypt_str.encode('utf-8')[m
         encrypt_byte = encrypt_byte.ljust(32, b"\0")  # 32byteä»¥ä¸‹ãªã‚‰å¢—ã‚„ã™[m
         encrypt_byte = encrypt_byte[:32]  # 32byteä»¥ä¸Šã‚’ç„¡è¦–ã™ã‚‹[m
         encrypt_byte = base64.urlsafe_b64encode(encrypt_byte)[m
         cipher = Fernet(encrypt_byte)[m
         #[m
[31m-        target_0 = password.encode("utf-8")  # æ–‡å­—ã‚’ã‚»ãƒƒãƒˆ[m
[31m-        target_1 = f"{password}_{encrypt_str}".encode("utf-8")[m
[32m+[m[32m        target_0 = password.encode('utf-8')  # æ–‡å­—ã‚’ã‚»ãƒƒãƒˆ[m
[32m+[m[32m        target_1 = f"{password}_{encrypt_str}".encode('utf-8')[m
         # print(f"d {password_name} {password} 0={target_0}")[m
         target_0 = cipher.encrypt(target_0)  # byteåˆ—ã«å¤‰æ›´ã—ã¦æš—å·åŒ–[m
         target_1 = cipher.encrypt(target_1)[m
[31m-        target_0 = base64.b64encode(target_0).decode()  # base64ã«å¤‰æ›´ã—ã¦æ–‡å­—ã«ã™ã‚‹[m
[31m-        target_1 = base64.b64encode(target_1).decode()[m
[32m+[m[32m        target_0 = base64.b64encode(target_0).decode('utf-8', errors='xmlcharrefreplace')  # base64ã«å¤‰æ›´ã—ã¦æ–‡å­—ã«ã™ã‚‹[m
[32m+[m[32m        target_1 = base64.b64encode(target_1).decode('utf-8', errors='xmlcharrefreplace')[m
         worker[password_name] = [target_0, target_1][m
         # print(f"c {password_name} {password}  0={target_0}")[m
         result = self.set_encrypt_file(filename, worker)[m
         # print(f"doSetpassword2 str={filename} p={password_name} p={password} w={worker}")[m
[31m-        self.setValue("result", result)[m
[32m+[m[32m        self.setValue('result', result)[m
         # print(f"doSetpassword3 str={filename} p={password_name} p={password} w={worker}")[m
 [m
     def doGetpassword([m
[36m@@ -2442,7 +2998,7 @@[m [mclass TtlPaserWolker(ABC):[m
         worker = self.get_encrypt_file(filename)[m
         # print(f"doGetpassword worker={worker}")[m
         if password_name in worker and 2 <= len(worker[password_name]):[m
[31m-            encrypt_byte = encrypt_str.encode("utf-8")[m
[32m+[m[32m            encrypt_byte = encrypt_str.encode('utf-8')[m
             encrypt_byte = encrypt_byte.ljust(32, b"\0")  # 32byteä»¥ä¸‹ãªã‚‰å¢—ã‚„ã™[m
             encrypt_byte = encrypt_byte[:32]  # 32byteä»¥ä¸Šã‚’ç„¡è¦–ã™ã‚‹[m
             encrypt_byte = base64.urlsafe_b64encode(encrypt_byte)[m
[36m@@ -2452,22 +3008,22 @@[m [mclass TtlPaserWolker(ABC):[m
             target_0 = base64.b64decode(worker[password_name][0].encode())[m
             target_1 = base64.b64decode(worker[password_name][1].encode())[m
             try:[m
[31m-                target_0 = cipher.decrypt(target_0).decode("utf-8")[m
[31m-                target_1 = cipher.decrypt(target_1).decode("utf-8")[m
[32m+[m[32m                target_0 = cipher.decrypt(target_0).decode('utf-8', errors='xmlcharrefreplace')[m
[32m+[m[32m                target_1 = cipher.decrypt(target_1).decode('utf-8', errors='xmlcharrefreplace')[m
             except InvalidToken:[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
                 return[m
             # print(f"e {password_name} 0={target_0}")[m
             # print(f"e {password_name} 0={target_1}")[m
             #[m
             if f"{target_0}_{encrypt_str}" == target_1:[m
                 self.setValue(p3, target_0)[m
[31m-                self.setValue("result", 1)[m
[32m+[m[32m                self.setValue('result', 1)[m
             else:[m
                 # encriptãŒä¸€è‡´ã—ãªã‹ã£ãŸ[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doIspassword(self, filename: str, password_name: str):[m
         # print(f"doGetpassword p3={p3}")[m
[36m@@ -2475,9 +3031,9 @@[m [mclass TtlPaserWolker(ABC):[m
         worker = self.get_encrypt_file(filename)[m
         # print(f"doGetpassword worker={worker}")[m
         if password_name in worker:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doDelpassword(self, filename: str, password_name: str):[m
         # print(f"doGetpassword p3={p3}")[m
[36m@@ -2498,7 +3054,7 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         # ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿[m
         try:[m
[31m-            with open(filename, "wt") as f:[m
[32m+[m[32m            with open(filename, 'wt') as f:[m
                 f.write(original_text)[m
         except (FileNotFoundError, IOError):[m
             return 0[m
[36m@@ -2516,7 +3072,7 @@[m [mclass TtlPaserWolker(ABC):[m
         # ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã™ã‚‹[m
         worker = {}[m
         try:[m
[31m-            with open(filename, "rt") as f:[m
[32m+[m[32m            with open(filename, 'rt') as f:[m
                 worker = json.loads(f.read())[m
                 self.encrypt_file[filename] = worker[m
         except (FileNotFoundError, IOError, json.decoder.JSONDecodeError):[m
[36m@@ -2531,30 +3087,30 @@[m [mclass TtlPaserWolker(ABC):[m
             self.doFileClose(file_handle)[m
         filename = self.normpath(filename)[m
         self.file_handle_list[file_handle] = {}[m
[31m-        self.file_handle_list[file_handle]["file_handle"] = None[m
[31m-        self.file_handle_list[file_handle]["filename"] = filename[m
[31m-        self.file_handle_list[file_handle]["append_flag"] = append_flag[m
[31m-        self.file_handle_list[file_handle]["readonly_flag"] = readonly_flag[m
[31m-        self.getValue("result", 0)[m
[32m+[m[32m        self.file_handle_list[file_handle]['file_handle'] = None[m
[32m+[m[32m        self.file_handle_list[file_handle]['filename'] = filename[m
[32m+[m[32m        self.file_handle_list[file_handle]['append_flag'] = append_flag[m
[32m+[m[32m        self.file_handle_list[file_handle]['readonly_flag'] = readonly_flag[m
[32m+[m[32m        self.getValue('result', 0)[m
 [m
     def doFindfirst(self, line, file_handle, file_name: str, strvar: str):[m
         """ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ³ãƒ‰ãƒ«ã‚’ä½œã‚‹"""[m
         if file_handle in self.file_handle_list:[m
             self.doFileClose(file_handle)[m
         self.file_handle_list[file_handle] = {}[m
[31m-        self.file_handle_list[file_handle]["file_handle"] = MyFindfirst(file_name)[m
[31m-        self.file_handle_list[file_handle]["filename"] = file_name[m
[31m-        self.file_handle_list[file_handle]["append_flag"] = False[m
[31m-        self.file_handle_list[file_handle]["readonly_flag"] = True[m
[32m+[m[32m        self.file_handle_list[file_handle]['file_handle'] = MyFindfirst(file_name)[m
[32m+[m[32m        self.file_handle_list[file_handle]['filename'] = file_name[m
[32m+[m[32m        self.file_handle_list[file_handle]['append_flag'] = False[m
[32m+[m[32m        self.file_handle_list[file_handle]['readonly_flag'] = True[m
         self.doFindnext(line, file_handle, strvar)[m
 [m
     def doFindnext(self, line, file_handle, strvar: str):[m
         """æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã™ã‚‹"""[m
         self.doFilereadln(line, file_handle, strvar)[m
[31m-        if self.getValue("result") == 0:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m        if self.getValue('result') == 0:[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFileclose(self, file_handle):[m
         """ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ³ãƒ‰ãƒ«ãŒã„ãŸã‚‰æ¶ˆã™"""[m
[36m@@ -2565,7 +3121,7 @@[m [mclass TtlPaserWolker(ABC):[m
         self.file_handle_list[file_handle] = None[m
         del self.file_handle_list[file_handle][m
         #[m
[31m-        file_handle_file = file_handle_base["file_handle"][m
[32m+[m[32m        file_handle_file = file_handle_base['file_handle'][m
         if file_handle_file is None:[m
             return[m
         try:[m
[36m@@ -2577,23 +3133,23 @@[m [mclass TtlPaserWolker(ABC):[m
         if file_handle not in self.file_handle_list:[m
             raise TypeError(f"### l={line} file_handle not found f={file_handle}")[m
         file_handle_base = self.file_handle_list[file_handle][m
[31m-        file_handle_file = file_handle_base["file_handle"][m
[32m+[m[32m        file_handle_file = file_handle_base['file_handle'][m
         if file_handle_file is None:[m
             option = 'wb'[m
[31m-            if file_handle_base["append_flag"] != 0:[m
[32m+[m[32m            if file_handle_base['append_flag'] != 0:[m
                 option = 'ab'[m
[31m-            file_handle_file = open(file_handle_base["filename"], option)[m
[31m-            file_handle_base["file_handle"] = file_handle_file[m
[31m-        file_handle_file.write(data.encode("utf-8"))[m
[32m+[m[32m            file_handle_file = open(file_handle_base['filename'], option)[m
[32m+[m[32m            file_handle_base['file_handle'] = file_handle_file[m
[32m+[m[32m        file_handle_file.write(data.encode('utf-8'))[m
 [m
     def openHandle(self, line, file_handle):[m
         if file_handle not in self.file_handle_list:[m
             raise TypeError(f"### l={line} file_handle not found f={file_handle}")[m
         file_handle_base = self.file_handle_list[file_handle][m
[31m-        file_handle_file = file_handle_base["file_handle"][m
[32m+[m[32m        file_handle_file = file_handle_base['file_handle'][m
         if file_handle_file is None:[m
[31m-            file_handle_file = open(file_handle_base["filename"], "rb")[m
[31m-            file_handle_base["file_handle"] = file_handle_file[m
[32m+[m[32m            file_handle_file = open(file_handle_base['filename'], 'rb')[m
[32m+[m[32m            file_handle_base['file_handle'] = file_handle_file[m
         return file_handle_file[m
 [m
     def doFileread(self, line, file_handle, read_byte, strvar):[m
[36m@@ -2601,61 +3157,63 @@[m [mclass TtlPaserWolker(ABC):[m
         #[m
         text = file_handle_file.read(read_byte)[m
         if text is not None:[m
[31m-            self.setValue(strvar, text.decode())[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue(strvar, text.decode('utf-8', errors='xmlcharrefreplace'))[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue(strvar, "")[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue(strvar, '')[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilereadln(self, line, file_handle, strvar):[m
         file_handle_file = self.openHandle(line, file_handle)[m
         #[m
         try:[m
             text = file_handle_file.readline()[m
[31m-            self.setValue(strvar, text.decode())[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            text = text.decode('utf-8', errors='xmlcharrefreplace')[m
[32m+[m[32m            text = text.rstrip('\n').rstrip('\r')[m
[32m+[m[32m            self.setValue(strvar, text)[m
[32m+[m[32m            self.setValue('result', 0)[m
         except OSError:[m
[31m-            self.setValue(strvar, "")[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue(strvar, '')[m
[32m+[m[32m            self.setValue('result', 1)[m
 [m
     def doFileconcat(self, p1, p2):[m
         p1 = self.normpath(p1)[m
         p2 = self.normpath(p2)[m
         if p1 == p2:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
[31m-            with open(p1, "ab") as f1:[m
[31m-                with open(p2, "rb") as f2:[m
[32m+[m[32m            with open(p1, 'ab') as f1:[m
[32m+[m[32m                with open(p2, 'rb') as f2:[m
                     f1.write(f2.read())[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilecopy(self, p1, p2):[m
         p1 = self.normpath(p1)[m
         p2 = self.normpath(p2)[m
         if p1 == p2:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
[31m-            with open(p1, "rb") as f1:[m
[31m-                with open(p2, "wb") as f2:[m
[32m+[m[32m            with open(p1, 'rb') as f1:[m
[32m+[m[32m                with open(p2, 'wb') as f2:[m
                     f2.write(f1.read())[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFiledelete(self, filename):[m
         filename = self.normpath(filename)[m
         if not os.path.exists(filename):[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
             os.remove(filename)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilerename(self, p1, p2):[m
         p1 = self.normpath(p1)[m
[36m@@ -2663,18 +3221,18 @@[m [mclass TtlPaserWolker(ABC):[m
         # print(f"doFilerename0 {p1} {p2}")[m
         if p1 == p2:[m
             # print(f"doFilerename1 {p1} {p2}")[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
             return[m
         if not os.path.exists(p1):[m
             # print(f"doFilerename2 {p1} {p2}")[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
             return[m
         self.doFiledelete(p2)[m
         try:[m
             os.rename(p1, p2)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         except OSError:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
 [m
     def doStrreplace(self, strvar, strvar_val, index, regex, newstr):[m
         strvar_pre = strvar_val[0:index][m
[36m@@ -2682,31 +3240,31 @@[m [mclass TtlPaserWolker(ABC):[m
         strvar_val = strvar_pre + re.sub(regex, newstr, strvar_val)[m
         try:[m
             self.setValue(strvar, strvar_val)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except (re.error, TypeError, ValueError):[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doStrmatch(self, target_string, string_with_regular_expressio):[m
         # print(f"strmatch {target_string} {string_with_regular_expressio}")[m
         match = re.search(string_with_regular_expressio, target_string)[m
         if match:[m
             # print(f"hit strmatch {target_string} {string_with_regular_expressio}")[m
[31m-            self.setValue("result", match.start() + 1)[m
[32m+[m[32m            self.setValue('result', match.start() + 1)[m
             i = 0[m
             for grp in match.groups():[m
[31m-                self.setValue("groupmatchstr" + str(i + 1), grp)[m
[32m+[m[32m                self.setValue('groupmatchstr' + str(i + 1), grp)[m
                 i = i + 1[m
                 if 10 <= i:[m
                     break[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilesearch(self, filename):[m
         filename = self.normpath(filename)[m
         if os.path.exists(filename):[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFilestat(self, filename, size, mtime, drive):[m
         try:[m
[36m@@ -2720,14 +3278,14 @@[m [mclass TtlPaserWolker(ABC):[m
             if drive is not None:[m
                 drive_val, xx = os.path.splitdrive(filename)[m
                 self.setValue(drive, drive_val)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         except FileNotFoundError:[m
             self.setValue(size, 0)[m
             if mtime is not None:[m
[31m-                self.setValue(mtime, "")[m
[32m+[m[32m                self.setValue(mtime, '')[m
             if drive is not None:[m
[31m-                self.setValue(drive, "")[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m                self.setValue(drive, '')[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doFiletruncate(self, filename: str, size: int):[m
         size_val = 0[m
[36m@@ -2742,41 +3300,41 @@[m [mclass TtlPaserWolker(ABC):[m
         try:[m
             if size < size_val:[m
                 # åˆ‡ã‚Šè©°ã‚ãŒå¿…è¦[m
[31m-                with open(filename, "r+b") as f:[m
[32m+[m[32m                with open(filename, 'r+b') as f:[m
                     fd = f.fileno()[m
                     os.truncate(fd, size)[m
             else:[m
                 # ã‚¼ãƒ­ãƒã‚¤ãƒˆåŠ ç®—[m
[31m-                with open(filename, "ab") as f:[m
[32m+[m[32m                with open(filename, 'ab') as f:[m
                     f.write(bytes(size - size_val))[m
         except OSError:[m
[31m-            self.setValue("result", -1)[m
[32m+[m[32m            self.setValue('result', -1)[m
 [m
     def doFoldercreate(self, folder_name):[m
         try:[m
             folder_name = self.normpath(folder_name)[m
             os.mkdir(folder_name)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except FileNotFoundError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFolderdelete(self, folder_path):[m
         folder_path = self.normpath(folder_path)[m
         if not os.path.isdir(folder_path):[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         try:[m
             os.rmdir(folder_path)[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         except OSError:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doFoldersearch(self, folder_path):[m
         folder_path = self.normpath(folder_path)[m
         if os.path.isdir(folder_path):[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doMakepath(self, strvar, dir, name):[m
         dir = self.normpath(dir)[m
[36m@@ -2789,7 +3347,7 @@[m [mclass TtlPaserWolker(ABC):[m
         if ip is None:[m
             self.setValue(intvar, 0)[m
             return[m
[31m-        self.setValue(string_array + "[0]", ip)[m
[32m+[m[32m        self.setValue(string_array + '[0]', ip)[m
         self.setValue(intvar, 1)[m
 [m
     def doGetipv6addr(self, string_array, intvar):[m
[36m@@ -2797,7 +3355,7 @@[m [mclass TtlPaserWolker(ABC):[m
         i = 0[m
         if infos is None:[m
             self.setValue(intvar, 0)[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
             return[m
         for info in infos:[m
             ipv6 = info[4][0][m
[36m@@ -2806,9 +3364,9 @@[m [mclass TtlPaserWolker(ABC):[m
             i = i + 1[m
         self.setValue(intvar, i)[m
         if 0 < i:[m
[31m-            self.setValue("result", 1)[m
[32m+[m[32m            self.setValue('result', 1)[m
         else:[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
 [m
     def doGetver(self, strvar: str, target_version: float):[m
         """ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ± ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ä½¿ã£ã¦ãã ã•ã„"""[m
[36m@@ -2817,11 +3375,11 @@[m [mclass TtlPaserWolker(ABC):[m
         self.setValue(strvar, str(now_version))[m
         if target_version is not None:[m
             if now_version == target_version:[m
[31m-                self.setValue("result", 0)[m
[32m+[m[32m                self.setValue('result', 0)[m
             elif now_version < target_version:[m
[31m-                self.setValue("result", -1)[m
[32m+[m[32m                self.setValue('result', -1)[m
             else:[m
[31m-                self.setValue("result", 1)[m
[32m+[m[32m                self.setValue('result', 1)[m
         # print("doGetver end")[m
 [m
     def setTitle(self, title: str):[m
[36m@@ -2846,15 +3404,15 @@[m [mclass TtlPaserWolker(ABC):[m
         else:[m
             for value in self.value_list:[m
                 # print(f"hit2 {value}/{strvar}")[m
[31m-                if strvar + "[" in value:[m
[32m+[m[32m                if strvar + '[' in value:[m
                     if isinstance(self.getValue(value), int):[m
                         result = 5[m
                     else:[m
                         result = 6[m
                     break[m
[31m-            self.setValue("result", 0)[m
[32m+[m[32m            self.setValue('result', 0)[m
         # print(f"doIfdefined v={strvar} d={result}")[m
[31m-        self.setValue("result", result)[m
[32m+[m[32m        self.setValue('result', result)[m
 [m
     def doScprecv(self, p1, p2):[m
         """SCP å—ä¿¡"""[m
[1mdiff --git a/nextnextping/grammer/version.py b/nextnextping/grammer/version.py[m
[1mindex 19be6cd..9f03427 100644[m
[1m--- a/nextnextping/grammer/version.py[m
[1m+++ b/nextnextping/grammer/version.py[m
[36m@@ -1,2 +1,2 @@[m
 [m
[31m-VERSION = 1.26[m
[32m+[m[32mVERSION = 1.27[m
[1mdiff --git a/nextnextping/nextnextping.py b/nextnextping/nextnextping.py[m
[1mindex 4c027bc..fe242aa 100644[m
[1m--- a/nextnextping/nextnextping.py[m
[1m+++ b/nextnextping/nextnextping.py[m
[36m@@ -921,7 +921,7 @@[m [mclass MyThread():[m
         try:[m
             self.myTtlPaserWolker = MyTtlPaserWolker(self.threading, self.next_next_ping, self.next_next_ping.log[type][param])[m
         except Exception as e:[m
[31m-            self.myTtlPaserWolker.setLog(f"Exception create {str(e)}")[m
[32m+[m[32m            self.myTtlPaserWolker.setLogInner(f"Exception create {str(e)}")[m
             return 0  # this is NG![m
         try:[m
             if not os.path.isabs(filename):[m
[36m@@ -934,7 +934,7 @@[m [mclass MyThread():[m
             #[m
             self.myTtlPaserWolker.execute(filename, param_list_next)[m
         except Exception as e:[m
[31m-            self.myTtlPaserWolker.setLog(f"Exception execute {str(e)}")[m
[32m+[m[32m            self.myTtlPaserWolker.setLogInner(f"Exception execute {str(e)}")[m
             return 0  # this is NG![m
         finally:[m
             # ãªã«ãŒã‚ã‚ã†ã¨workerã¯çµ¶å¯¾ã«æ®ºã™[m
[1mdiff --git a/nextnextping/pyttl.py b/nextnextping/pyttl.py[m
[1mindex 6e2ffd8..96ffbe9 100644[m
[1m--- a/nextnextping/pyttl.py[m
[1m+++ b/nextnextping/pyttl.py[m
[36m@@ -14,6 +14,7 @@[m [mclass MyTtlPaserWolker(TtlPaserWolker):[m
 [m
     def setLog(self, strvar):[m
         """ log setting """[m
[32m+[m[32m        # print(f"[{strvar}]")[m
         print(strvar, end="")[m
 [m
 [m
[1mdiff --git a/pyproject.toml b/pyproject.toml[m
[1mindex 00d8e2f..867afd3 100644[m
[1m--- a/pyproject.toml[m
[1m+++ b/pyproject.toml[m
[36m@@ -12,7 +12,8 @@[m [mdependencies = [[m
     "antlr4-python3-runtime",[m
     "uptime",[m
     "pexpect",[m
[31m-    "cryptography"[m
[32m+[m[32m    "cryptography",[m
[32m+[m[32m    "pyserial"[m
 ][m
 [m
 [tool.pytest.ini_options][m
[1mdiff --git a/test/test_nextnextping.py b/test/test_nextnextping.py[m
[1mdeleted file mode 100644[m
[1mindex 4675efc..0000000[m
[1m--- a/test/test_nextnextping.py[m
[1m+++ /dev/null[m
[36m@@ -1,975 +0,0 @@[m
[31m-#!/usr/bin/python[m
[31m-# -*- coding: utf-8 -*-[m
[31m-import time[m
[31m-import os[m
[31m-import socket[m
[31m-import threading[m
[31m-import paramiko[m
[31m-import sys[m
[31m-import re[m
[31m-import random[m
[31m-import pathlib[m
[31m-from paramiko import SFTPServerInterface, SFTPServer, SFTPAttributes, SFTPHandle, SFTP_OK[m
[31m-try:[m
[31m-    from nextnextping.pyttl import pyttl[m
[31m-except ModuleNotFoundError:[m
[31m-    sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))[m
[31m-    from nextnextping.pyttl import pyttl[m
[31m-[m
[31m-PING = """PING localhost (127.0.0.1) 56(84) bytes of data.[m
[31m-64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.070 ms[m
[31m-[m
[31m---- localhost ping statistics ---[m
[31m-1 packets transmitted, 1 received, 0% packet loss, time 0ms[m
[31m-rtt min/avg/max/mdev = 0.070/0.070/0.070/0.000 ms[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-PING_CISCO = """[m
[31m-Type escape sequence to abort.[m
[31m-Sending 5, 100-byte ICMP Echos to 10.1.1.1, timeout is 2 seconds:[m
[31m-!!!!![m
[31m-Success rate is 100 percent (5/5), round-trip min/avg/max = 1/3/5 ms[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-SHOW_RUNNING_CONFIG = """Building configuration...[m
[31m-[m
[31m-Current configuration : 1234 bytes[m
[31m-![m
[31m-version 15.2[m
[31m-service timestamps debug datetime msec[m
[31m-service timestamps log datetime msec[m
[31m-no service password-encryption[m
[31m-![m
[31m-hostname SW-Floor-1[m
[31m-![m
[31m-![m
[31m-boot-start-marker[m
[31m-boot-end-marker[m
[31m-![m
[31m-![m
[31m-no aaa new-model[m
[31m-![m
[31m-![m
[31m-interface GigabitEthernet0/1[m
[31m- description "Uplink to Core Router"[m
[31m- ip address 192.168.1.1 255.255.255.0[m
[31m- no shutdown[m
[31m-![m
[31m-interface GigabitEthernet0/2[m
[31m- description "Server Port 1"[m
[31m- switchport mode access[m
[31m- switchport access vlan 10[m
[31m- no shutdown[m
[31m-![m
[31m-interface GigabitEthernet0/3[m
[31m- description "Access Point"[m
[31m- no shutdown[m
[31m-![m
[31m-![m
[31m-line con 0[m
[31m-line vty 0 4[m
[31m- login local[m
[31m-![m
[31m-![m
[31m-end[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-ENABLE_ERROR = "% Uncrecognized Command\r\n"[m
[31m-[m
[31m-TRACERT = """[m
[31m-Tracing route to t-ando [::1][m
[31m-over a maximum of 30 hops:[m
[31m-[m
[31m-  1    <1 ms    <1 ms    <1 ms  t-ando [::1][m
[31m-[m
[31m-Trace complete.[m
[31m-[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-TRACEROUTE = """traceroute to localhost (127.0.0.1), 30 hops max, 60 byte packets[m
[31m- 1  localhost (127.0.0.1)  0.099 ms  0.075 ms  0.071 ms[m
[31m-"""[m
[31m-[m
[31m-TRACEPATH = """traceroute to localhost (127.0.0.1), 30 hops max, 60 byte packets[m
[31m- 1  localhost (127.0.0.1)  0.099 ms  0.075 ms  0.071 ms[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-DISPLAY_CURRENT_CONFIGURATION = """#[m
[31m-sysname QX-S3526[m
[31m-#[m
[31m-vlan 1[m
[31m- name default[m
[31m-#[m
[31m-interface GigabitEthernet0/1[m
[31m- port access vlan 10[m
[31m-#[m
[31m-interface GigabitEthernet0/2[m
[31m- port access vlan 20[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-DISPLAY_CURRENT_CONFIGURATION_MORE = """#[m
[31m-interface Vlan-interface1[m
[31m- ip address 192.168.1.1 255.255.255.0[m
[31m-#[m
[31m-user-interface console 0[m
[31m- authentication-mode password[m
[31m- set authentication password cipher ********[m
[31m-#[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-IFCONFIG = """eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1440[m
[31m-        inet xx.xx.209.61  netmask 255.255.240.0  broadcast xx.xx.223.255[m
[31m-        inet6 xx::xx:5dff:feae:24d3  prefixlen 64  scopeid 0x20<link>[m
[31m-        ether xx:xx:5d:ae:24:d3  txqueuelen 1000  (Ethernet)[m
[31m-        RX packets 114  bytes 212332 (212.3 KB)[m
[31m-        RX errors 0  dropped 0  overruns 0  frame 0[m
[31m-        TX packets 112  bytes 7731 (7.7 KB)[m
[31m-        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0[m
[31m-[m
[31m-lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536[m
[31m-        inet 127.0.0.1  netmask 255.0.0.0[m
[31m-        inet6 ::1  prefixlen 128  scopeid 0x10<host>[m
[31m-        loop  txqueuelen 1000  (Local Loopback)[m
[31m-        RX packets 14  bytes 1710 (1.7 KB)[m
[31m-        RX errors 0  dropped 0  overruns 0  frame 0[m
[31m-        TX packets 14  bytes 1710 (1.7 KB)[m
[31m-        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0[m
[31m-[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-SHOW_IP_INTERFACE_BRIEF = """Interface        IP-Address      OK? Method Status                Protocol[m
[31m-GigabitEthernet0/1 192.168.1.1     YES manual up                    up[m
[31m-GigabitEthernet0/2 192.168.2.1     YES manual up                    down[m
[31m-GigabitEthernet0/3 unassigned      YES manual administratively down down[m
[31m-""".replace('\n', '\r\n')[m
[31m-[m
[31m-[m
[31m-class StubServer(paramiko.ServerInterface):[m
[31m-    """ SSHã‚µãƒ¼ãƒã®å®Ÿè£… """[m
[31m-[m
[31m-    def __init__(self):[m
[31m-        """ ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ """[m
[31m-        self.event = threading.Event()[m
[31m-        self.sftp_flag = False[m
[31m-        self.username = "anonymouse"[m
[31m-[m
[31m-    def check_channel_request(self, kind, chanid):[m
[31m-        """ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è¨±å¯ """[m
[31m-        # print(f"test check_channel_request kind={kind} ")[m
[31m-        if kind == "session":[m
[31m-            return paramiko.OPEN_SUCCEEDED[m
[31m-        return paramiko.OPEN_FAILED_ADMINISTRATIVELY_PROHIBITED[m
[31m-[m
[31m-    def check_auth_password(self, username, password):[m
[31m-        """ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ """[m
[31m-        print(f"test username={username}  password=*****")[m
[31m-        self.username = username[m
[31m-        return paramiko.AUTH_SUCCESSFUL[m
[31m-[m
[31m-    def check_auth_publickey(self, username, key):[m
[31m-        """ èªè¨¼ã®è¨±å¯ """[m
[31m-        return paramiko.AUTH_SUCCESSFUL[m
[31m-[m
[31m-    def check_auth_gssapi_with_mic([m
[31m-        self, username, gss_authenticated=paramiko.AUTH_FAILED, cc_file=None[m
[31m-    ):[m
[31m-        """ èªè¨¼ã®è¨±å¯ """[m
[31m-        return paramiko.AUTH_SUCCESSFUL[m
[31m-[m
[31m-    def check_auth_gssapi_keyex([m
[31m-        self, username, gss_authenticated=paramiko.AUTH_FAILED, cc_file=None[m
[31m-    ):[m
[31m-        """ èªè¨¼ã®è¨±å¯ """[m
[31m-        return paramiko.AUTH_SUCCESSFUL[m
[31m-[m
[31m-    def get_allowed_auths(self, username):[m
[31m-        """ èªè¨¼ã®è¨±å¯ """[m
[31m-        return "password,publickey"[m
[31m-[m
[31m-    def check_channel_shell_request(self, channel):[m
[31m-        """ shellã®è¨±å¯ """[m
[31m-        print("test check_channel_shell_request")[m
[31m-        self.sftp_flag = False[m
[31m-        self.event.set()[m
[31m-        return True[m
[31m-[m
[31m-    def check_channel_pty_request(self, channel, term, width, height, pixelwidth, pixelheight, modes):[m
[31m-        """ ptyã®è¨±å¯ """[m
[31m-        return True[m
[31m-[m
[31m-    def check_channel_subsystem_request(self, channel, name):[m
[31m-        """ ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ è¦æ±‚ã®å‡¦ç† """[m
[31m-        print(f"test check_channel_subsystem_request {name}")[m
[31m-        self.sftp_flag = True[m
[31m-        self.event.set()[m
[31m-        return super().check_channel_subsystem_request(channel, name)[m
[31m-[m
[31m-    def is_sftp_flag(self) -> bool:[m
[31m-        """ sftpã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹ """[m
[31m-        return self.sftp_flag[m
[31m-[m
[31m-    def get_username(self) -> str:[m
[31m-        """ sftpã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹ """[m
[31m-        return self.username[m
[31m-[m
[31m-[m
[31m-class StubSFTPServer (SFTPServerInterface):[m
[31m-    ROOT = os.getcwd()[m
[31m-[m
[31m-    def _realpath(self, path):[m
[31m-        return self.ROOT + self.canonicalize(path)[m
[31m-[m
[31m-    def list_folder(self, path):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            out = [][m
[31m-            flist = os.listdir(path)[m
[31m-            for fname in flist:[m
[31m-                attr = SFTPAttributes.from_stat(os.stat(os.path.join(path, fname)))[m
[31m-                attr.filename = fname[m
[31m-                out.append(attr)[m
[31m-            return out[m
[31m-        except OSError as e:[m
[31m-            print("test list_folder OSError")[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-[m
[31m-    def stat(self, path):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            return SFTPAttributes.from_stat(os.stat(path))[m
[31m-        except OSError as e:[m
[31m-            print("test stat OSError")[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-[m
[31m-    def lstat(self, path):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            return SFTPAttributes.from_stat(os.lstat(path))[m
[31m-        except OSError as e:[m
[31m-            print("test lstat OSError")[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-[m
[31m-    def open(self, path, flags, attr):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            binary_flag = getattr(os, 'O_BINARY', 0)[m
[31m-            flags |= binary_flag[m
[31m-            mode = getattr(attr, 'st_mode', None)[m
[31m-            if mode is not None:[m
[31m-                fd = os.open(path, flags, mode)[m
[31m-            else:[m
[31m-                # os.open() defaults to 0777 which is[m
[31m-                # an odd default mode for files[m
[31m-                fd = os.open(path, flags, 0o666)[m
[31m-        except OSError as e:[m
[31m-            print("test open/0o666 OSError")[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        if (flags & os.O_CREAT) and (attr is not None):[m
[31m-            attr._flags &= ~attr.FLAG_PERMISSIONS[m
[31m-            SFTPServer.set_file_attr(path, attr)[m
[31m-        if flags & os.O_WRONLY:[m
[31m-            if flags & os.O_APPEND:[m
[31m-                fstr = 'ab'[m
[31m-            else:[m
[31m-                fstr = 'wb'[m
[31m-        elif flags & os.O_RDWR:[m
[31m-            if flags & os.O_APPEND:[m
[31m-                fstr = 'a+b'[m
[31m-            else:[m
[31m-                fstr = 'r+b'[m
[31m-        else:[m
[31m-            # O_RDONLY (== 0)[m
[31m-            fstr = 'rb'[m
[31m-        try:[m
[31m-            f = os.fdopen(fd, fstr)[m
[31m-        except OSError as e:[m
[31m-            print("test open/fdopen OSError")[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        fobj = StubSFTPHandle(flags)[m
[31m-        fobj.filename = path[m
[31m-        fobj.readfile = f[m
[31m-        fobj.writefile = f[m
[31m-        return fobj[m
[31m-[m
[31m-    def remove(self, path):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            os.remove(path)[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        return SFTP_OK[m
[31m-[m
[31m-    def rename(self, oldpath, newpath):[m
[31m-        oldpath = self._realpath(oldpath)[m
[31m-        newpath = self._realpath(newpath)[m
[31m-        try:[m
[31m-            os.rename(oldpath, newpath)[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        return SFTP_OK[m
[31m-[m
[31m-    def mkdir(self, path, attr):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            os.mkdir(path)[m
[31m-            if attr is not None:[m
[31m-                SFTPServer.set_file_attr(path, attr)[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        return SFTP_OK[m
[31m-[m
[31m-    def rmdir(self, path):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            os.rmdir(path)[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        return SFTP_OK[m
[31m-[m
[31m-    def chattr(self, path, attr):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            SFTPServer.set_file_attr(path, attr)[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        return SFTP_OK[m
[31m-[m
[31m-    def symlink(self, target_path, path):[m
[31m-        path = self._realpath(path)[m
[31m-        if (len(target_path) > 0) and (target_path[0] == '/'):[m
[31m-            # absolute symlink[m
[31m-            target_path = os.path.join(self.ROOT, target_path[1:])[m
[31m-            if target_path[:2] == '//':[m
[31m-                # bug in os.path.join[m
[31m-                target_path = target_path[1:][m
[31m-        else:[m
[31m-            # compute relative to path[m
[31m-            abspath = os.path.join(os.path.dirname(path), target_path)[m
[31m-            if abspath[:len(self.ROOT)] != self.ROOT:[m
[31m-                # this symlink isn't going to work anyway -- just break it immediately[m
[31m-                target_path = '<error>'[m
[31m-        try:[m
[31m-            os.symlink(target_path, path)[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        return SFTP_OK[m
[31m-[m
[31m-    def readlink(self, path):[m
[31m-        path = self._realpath(path)[m
[31m-        try:[m
[31m-            symlink = os.readlink(path)[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-        # if it's absolute, remove the root[m
[31m-        if os.path.isabs(symlink):[m
[31m-            if symlink[:len(self.ROOT)] == self.ROOT:[m
[31m-                symlink = symlink[len(self.ROOT):][m
[31m-                if (len(symlink) == 0) or (symlink[0] != '/'):[m
[31m-                    symlink = '/' + symlink[m
[31m-            else:[m
[31m-                symlink = '<error>'[m
[31m-        return symlink[m
[31m-[m
[31m-[m
[31m-class StubSFTPHandle (SFTPHandle):[m
[31m-    def stat(self):[m
[31m-        try:[m
[31m-            return SFTPAttributes.from_stat(os.fstat(self.readfile.fileno()))[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-[m
[31m-    def chattr(self, attr):[m
[31m-        # python doesn't have equivalents to fchown or fchmod, so we have to[m
[31m-        # use the stored filename[m
[31m-        try:[m
[31m-            SFTPServer.set_file_attr(self.filename, attr)[m
[31m-            return SFTP_OK[m
[31m-        except OSError as e:[m
[31m-            return SFTPServer.convert_errno(e.errno)[m
[31m-[m
[31m-[m
[31m-class ServerStarter():[m
[31m-    """ å®Ÿéš›ã®ã‚µãƒ¼ãƒèµ·å‹•éƒ¨åˆ† """[m
[31m-[m
[31m-    KEY_FILE = "test_rsa.key"  # ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½ç½®[m
[31m-[m
[31m-    def __init__(self, port: int):[m
[31m-        """ ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ """[m
[31m-        if os.path.isfile(ServerStarter.KEY_FILE):[m
[31m-            self.host_key = paramiko.RSAKey(filename=ServerStarter.KEY_FILE)[m
[31m-        else:[m
[31m-            self.host_key = paramiko.RSAKey.generate(2048)[m
[31m-            self.host_key.write_private_key_file(ServerStarter.KEY_FILE)[m
[31m-        #[m
[31m-        self.DoGSSAPIKeyExchange = True[m
[31m-        self.port = port[m
[31m-        self.stop_flag = False[m
[31m-        self.channel = None[m
[31m-        self.client = None[m
[31m-        self.transport = None[m
[31m-        self.server_socket = None[m
[31m-        self.state = [][m
[31m-        self.password_ng_flag = False[m
[31m-        self.prompt = None[m
[31m-        self.set_state('$')[m
[31m-[m
[31m-    def set_state(self, state: str):[m
[31m-        """ å¤–éƒ¨ã‹ã‚‰çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ """[m
[31m-        # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰NGãƒ•ãƒ©ã‚°ã®è§£æ”¾[m
[31m-        self.password_ng_flag = False[m
[31m-        # çŠ¶æ…‹ã®åˆæœŸåŒ–[m
[31m-        self.state = [][m
[31m-        # çŠ¶æ…‹æ›´æ–°[m
[31m-        self.push_state(state)[m
[31m-[m
[31m-    def push_state(self, state_base: str):[m
[31m-        state_base = state_base.lower()[m
[31m-        # print(f"test push_state ({state_base})")[m
[31m-        #[m
[31m-        trigger_flag = False[m
[31m-        for trigger in ServerStarter.TRIGGER:[m
[31m-            if state_base == "":[m
[31m-                continue[m
[31m-            if trigger[0] == state_base or trigger[2] == state_base:[m
[31m-                trigger_flag = True[m
[31m-                break[m
[31m-        if trigger_flag:[m
[31m-            pass[m
[31m-        elif 'sudo' in state_base:[m
[31m-            state_base = 'sudo'[m
[31m-        elif 'cisco1' in state_base or 'c1' in state_base:[m
[31m-            state_base = 'c1'[m
[31m-        elif 'cisco2' in state_base or 'c2' in state_base:[m
[31m-            state_base = 'c2'[m
[31m-        elif 'qx-s' in state_base or 'qx' in state_base:[m
[31m-            state_base = 'qx'[m
[31m-        elif 'linux' in state_base or 'ubuntu' in state_base:[m
[31m-            state_base = '$'[m
[31m-        elif 'user' in state_base:[m
[31m-            state_base = 'user'[m
[31m-        elif 'pass' in state_base:[m
[31m-            state_base = 'pass'[m
[31m-        elif 'y/n' in state_base:[m
[31m-            state_base = 'y/n'[m
[31m-        elif 'more' in state_base:[m
[31m-            state_base = 'more'[m
[31m-        elif 'vm' in state_base:  # vmware[m
[31m-            state_base = 'vm'[m
[31m-        else:[m
[31m-            state_base = "$"[m
[31m-        self.state.append(state_base)[m
[31m-        self.update_prompt()[m
[31m-        # print(f"test push_state {state_base} // {self.state} // {self.prompt}")[m
[31m-[m
[31m-    def peek_state(self) -> str:[m
[31m-        # print(f"test peek_state ({self.state[-1]})")[m
[31m-        return self.state[-1][m
[31m-[m
[31m-    def pop_state(self) -> bool:[m
[31m-        if len(self.state) <= 1:[m
[31m-            return False[m
[31m-        self.state.pop()[m
[31m-        self.update_prompt()[m
[31m-        return True[m
[31m-[m
[31m-    def update_prompt(self):[m
[31m-        """ ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°ã™ã‚‹ """[m
[31m-        state = self.state[-1][m
[31m-        # print(f"update_prompt {state}")[m
[31m-        trigger_flag = False[m
[31m-        for trigger in ServerStarter.TRIGGER:[m
[31m-            if trigger[2] == '':[m
[31m-                continue[m
[31m-            if trigger[2] == state:[m
[31m-                self.prompt = trigger[3][m
[31m-                trigger_flag = True[m
[31m-                break[m
[31m-        if trigger_flag:[m
[31m-            pass[m
[31m-        elif 'sudo' == state:[m
[31m-            self.prompt = '[sudo] password for user_name:'[m
[31m-        elif 'c1' == state:[m
[31m-            self.prompt = 'Router>'  # for cisco not enable[m
[31m-        elif 'c2' == state:[m
[31m-            self.prompt = 'Router# '  # for cisco enable[m
[31m-        elif 'qx' == state:[m
[31m-            self.prompt = '<Switch> '  # for qx-s[m
[31m-        elif '$' == state:[m
[31m-            self.prompt = 'root@localhost:~$ '  # for linux[m
[31m-        elif 'user' == state:[m
[31m-            self.prompt = 'User:'[m
[31m-        elif 'pass' == state:[m
[31m-            self.prompt = 'Password:'[m
[31m-        elif 'y/n' == state:[m
[31m-            if random.randint(0, 1):[m
[31m-                self.prompt = 'Are you sure you want to continue connecting (yes/no)?'[m
[31m-            else:[m
[31m-                self.prompt = "Are you sure you want to continue connecting (yes/no/[fingerprint])?"[m
[31m-        elif 'vm' == state:[m
[31m-            self.prompt = '[root@localhost:~] '[m
[31m-        else:[m
[31m-            self.prompt = 'root@localhost:~$ '  # for linux[m
[31m-        # print(f"update_prompt s={state} p={self.prompt}")[m
[31m-[m
[31m-    def cleint_close(self):[m
[31m-        """ ã“ã®å‡¦ç†ãŒå‘¼ã°ã‚ŒãŸã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ """[m
[31m-        print("test clinet close!")[m
[31m-        #[m
[31m-        local_transport = self.transport[m
[31m-        self.transport = None[m
[31m-        if local_transport is not None:[m
[31m-            try:[m
[31m-                local_transport.close()[m
[31m-            except Exception:[m
[31m-                pass[m
[31m-        #[m
[31m-        local_chan = self.channel[m
[31m-        self.channel = None[m
[31m-        if local_chan is not None:[m
[31m-            try:[m
[31m-                local_chan.close()[m
[31m-            except Exception:[m
[31m-                pass[m
[31m-        #[m
[31m-        local_client = self.client[m
[31m-        self.client = None[m
[31m-        if local_client is not None:[m
[31m-            try:[m
[31m-                local_client.close()[m
[31m-            except Exception:[m
[31m-                pass[m
[31m-[m
[31m-    def close(self):[m
[31m-        """ ã“ã®å‡¦ç†ãŒå‘¼ã°ã‚ŒãŸã‚‰ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ """[m
[31m-        #[m
[31m-        print("test close start!")[m
[31m-        #[m
[31m-        self.stop()[m
[31m-        self.cleint_close()[m
[31m-        #[m
[31m-        local_sock = self.server_socket[m
[31m-        self.server_socket = None[m
[31m-        if local_sock is not None:[m
[31m-            try:[m
[31m-                local_sock.close()[m
[31m-            except Exception:[m
[31m-                pass[m
[31m-[m
[31m-    def stop(self):[m
[31m-        """ ã“ã®å‡¦ç†ãŒå‘¼ã°ã‚ŒãŸã‚‰åœæ­¢ã™ã‚‹ """[m
[31m-        self.stop_flag = True[m
[31m-[m
[31m-    def start(self):[m
[31m-        """ å®Ÿå‡¦ç† """[m
[31m-        # now connect[m
[31m-        try:[m
[31m-            print(f"test bind p={self.port}")[m
[31m-            self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)[m
[31m-            self.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)[m
[31m-            self.server_socket.bind(("", self.port))[m
[31m-            #[m
[31m-            if self.server_socket is None:[m
[31m-                return paramiko.SSHException("self.server_socket is None")[m
[31m-            #[m
[31m-            # print("test Listen start ...")[m
[31m-            self.server_socket.listen(100)[m
[31m-            #[m
[31m-            while not self.stop_flag:[m
[31m-                print("test while loop start!")[m
[31m-                #[m
[31m-                local_socket = self.server_socket[m
[31m-                if local_socket is None:[m
[31m-                    return paramiko.SSHException("self.server_socket is None")[m
[31m-                self.client, _ = local_socket.accept()[m
[31m-                #[m
[31m-                self.invoke_accept()[m
[31m-                #[m
[31m-        except OSError as e:[m
[31m-            print(f"test *** Caught OSError: {str(e.__class__)} : {str(e)}")[m
[31m-            return 1[m
[31m-        except paramiko.SSHException as e:[m
[31m-            print(f"test *** Caught SSHException: {str(e.__class__)} : {str(e)}")[m
[31m-            return 1[m
[31m-        finally:[m
[31m-            print("test finally self.close()")[m
[31m-            self.close()[m
[31m-        return 0[m
[31m-[m
[31m-    def invoke_accept(self):[m
[31m-        """ self.server_socket.accept()å¾Œã®å‡¦ç†ã€‚æœ¬æ¥ã§ã‚ã‚Œã°ã‚¹ãƒ¬ãƒƒãƒ‰åŒ–ã™ã¹ãå€‹æ‰€ """[m
[31m-        print("test invoke_accept")[m
[31m-        try:[m
[31m-            #[m
[31m-            print("test Got a connection!")[m
[31m-            self.transport = paramiko.Transport(self.client, gss_kex=self.DoGSSAPIKeyExchange)[m
[31m-            # self.transport.set_gss_host(socket.getfqdn(""))[m
[31m-            # self.transport.load_server_moduli()[m
[31m-            self.transport.add_server_key(self.host_key)[m
[31m-            self.transport.set_subsystem_handler('sftp', paramiko.SFTPServer, StubSFTPServer)[m
[31m-            #[m
[31m-            print("test Server start!")[m
[31m-            server = StubServer()[m
[31m-            self.transport.start_server(server=server)[m
[31m-            #[m
[31m-            # wait for auth[m
[31m-            self.channel = self.transport.accept()[m
[31m-            if self.channel is None:[m
[31m-                print("test *** No channel.")[m
[31m-                return[m
[31m-            #[m
[31m-            # ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ãŒé–‹å§‹ã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ[m
[31m-            server.event.wait()[m
[31m-            #[m
[31m-            # clientå‡¦ç†[m
[31m-            print("test invoke_client")[m
[31m-            self.invoke_client(server)[m
[31m-            #[m
[31m-        except OSError as e:[m
[31m-            print(f"test *** Client OSError: {str(e.__class__)} : {str(e)}")[m
[31m-        except paramiko.SSHException as e:[m
[31m-            print(f"test *** Client SSHException: {str(e.__class__)} : {str(e)}")[m
[31m-        finally:[m
[31m-            print("test finally self.cleint_close()")[m
[31m-            self.cleint_close()[m
[31m-        return[m
[31m-[m
[31m-    TRIGGER = [[m
[31m-        ["", "^\\s*ping\\s+", '', '', PING],[m
[31m-        ["", "^\\s*tracert", '', '', TRACERT],[m
[31m-        ["", "^\\s*traceroute", '', '', TRACEROUTE],[m
[31m-        ["", "^\\s*tracepath", '', '', TRACEPATH],[m
[31m-        ["", "^\\s*ifconfig", '', '', IFCONFIG],[m
[31m-        ["c1", "^\\s*ping\\s+", '', '', PING_CISCO],[m
[31m-        ["c2", "^\\s*show\\s+ip\\s+interface\\s+brief", '', '', SHOW_IP_INTERFACE_BRIEF],[m
[31m-        ["c2", "^\\s*config(ure)?\\s+terminal", "config", 'Router(config)# ', ''],[m
[31m-        ["c2", "^\\s*ping\\s+", '', '', PING_CISCO],[m
[31m-        ["c2", "^\\s*show\\s+running-config", '', '', SHOW_RUNNING_CONFIG],[m
[31m-        ["config", "^\\s*vlan\\s+", "config-vlan", 'Router(config-vlan)# ', ''],[m
[31m-        ["config", "^\\s*interface\\s+", "config-if", 'Router(config-if)# ', ''],[m
[31m-        ["config", "^\\s*class-map\\s+", "config-cmap", 'Router(config-cmap)# ', ''],[m
[31m-        ["config", "^\\s*policy-map\\s+", "config-pmap", 'Router(config-pmap)# ', ''],[m
[31m-        ["config-pmap", "^\\s*class\\s+", "config-pmap-c", 'Router(config-pmap-c)# ', ''],[m
[31m-        ["qx", "^\\s*display\\s+current-configuration", 'more', '-- More --', DISPLAY_CURRENT_CONFIGURATION],[m
[31m-        ["qx", "^\\s*system-view", "qx-config", '[Switch]', ''],[m
[31m-        ["qx-config", "^\\s*interface\\s+gigabitethernet", "qx-gbe", '[Switch-GigabitEthernet] ', ''],[m
[31m-        ["qx-config", "^\\s*interface\\s+vlan", "qx-Vlan", '[Switch-Vlan-interface] ', ''],[m
[31m-        ["qx-config", "^\\s*traffic\\s+classifier", "qx-classifier", '[Switch-classifier] ', ''],[m
[31m-        ["qx-config", "^\\s*qos\\s+policy", "qx-qospolicy", '[Switch-qospolicy] ', ''],[m
[31m-        ["qx-config", "^\\s*traffic\\s+behavior", "qx-behavior", '[Switch-behavior] ', ''][m
[31m-    ][m
[31m-[m
[31m-    def invoke_client(self, server: StubServer):[m
[31m-        """ shellã®å®Ÿè£… """[m
[31m-        #[m
[31m-        if not server.event.is_set():[m
[31m-            print("test *** Client never asked for a shell.")[m
[31m-            return[m
[31m-[m
[31m-        # print(f"test is_set() OK! f={server.is_sftp_flag()}")[m
[31m-        if server.is_sftp_flag():[m
[31m-            # SFTpã®ã¨ãã¯ã“ã¡ã‚‰ã§ç„¡é™å¾…ã¡ã‚’ã™ã‚‹[m
[31m-            try:[m
[31m-                while self.transport is not None and self.transport.is_active():[m
[31m-                    time.sleep(1)[m
[31m-            finally:[m
[31m-                print("test finally (sftp)")[m
[31m-                return[m
[31m-        #[m
[31m-        username = server.get_username()[m
[31m-        self.set_state(username)[m
[31m-        # print(f"test username={username} state={self.peek_state()} p={self.prompt}")[m
[31m-        #[m
[31m-        self.channel.send(f"{self.prompt}")[m
[31m-        message = ''[m
[31m-        while not self.stop_flag:[m
[31m-            #[m
[31m-            if self.channel is None or not self.channel.active:[m
[31m-                break[m
[31m-            elif self.channel.recv_ready():[m
[31m-                output = self.channel.recv(1).decode("utf-8")[m
[31m-                if "\r" == output:[m
[31m-                    self.channel.send("\r\n")[m
[31m-                elif "\n" == output:[m
[31m-                    self.channel.send("\r\n")[m
[31m-                else:[m
[31m-                    if self.peek_state() != 'pass':[m
[31m-                        self.channel.send(output)[m
[31m-                    message = message + output[m
[31m-                    continue[m
[31m-                #[m
[31m-                trigger_flag = False[m
[31m-                for trigger in ServerStarter.TRIGGER:[m
[31m-                    if self.peek_state() != trigger[0] and '' != trigger[0]:[m
[31m-                        continue[m
[31m-                    resultX = re.search(trigger[1], message)[m
[31m-                    if resultX:[m
[31m-                        if '' != trigger[4]:[m
[31m-                            self.channel.send(trigger[4])[m
[31m-                        if '' != trigger[2]:[m
[31m-                            self.push_state(trigger[2])[m
[31m-                        trigger_flag = True[m
[31m-                        break[m
[31m-                result3 = re.search("^\\s*ssh\\s+([-_a-zA-Z0-9@]+)", message)[m
[31m-                if trigger_flag:[m
[31m-                    pass[m
[31m-                elif self.peek_state() in ['y/n', 'user', 'sudo']:[m
[31m-                    # print(f"test peek={self.peek_state()}")[m
[31m-                    self.pop_state()[m
[31m-                elif 'pass' in self.peek_state():[m
[31m-                    if not self.password_ng_flag:[m
[31m-                        self.pop_state()[m
[31m-                elif 'more' == self.peek_state():[m
[31m-                    self.channel.send(DISPLAY_CURRENT_CONFIGURATION_MORE)[m
[31m-                    self.pop_state()[m
[31m-                elif result3:[m
[31m-                    # æ–°ã—ã„çŠ¶æ…‹ã‚’ç©ã‚€[m
[31m-                    ssh_state_flag = result3.group(1)[m
[31m-                    if 'password_ng' in ssh_state_flag:[m
[31m-                        self.password_ng_flag = True[m
[31m-                    else:[m
[31m-                        self.password_ng_flag = False[m
[31m-                    self.push_state(ssh_state_flag)[m
[31m-                    self.push_state('pass')[m
[31m-                    #[m
[31m-                    if random.randint(0, 1):[m
[31m-                        # ãƒ©ãƒ³ãƒ€ãƒ ã«y/nã‚’èã[m
[31m-                        self.push_state('y/n')[m
[31m-                    #[m
[31m-                elif re.search("^\\s*allexit", message):[m
[31m-                    #[m
[31m-                    # å®Œå…¨åœæ­¢ã™ã‚‹[m
[31m-                    self.close()  # è‡ªåˆ†ã‚’åœæ­¢[m
[31m-                    os._exit(0)  # ä»–ã‚‚å¼·åˆ¶åœæ­¢[m
[31m-                    #[m
[31m-                elif re.search("^\\s*(exit|quit)", message):[m
[31m-                    if not self.pop_state():[m
[31m-                        self.cleint_close()[m
[31m-                        return[m
[31m-                elif re.search("^\\s*sudo\\s+.*", message):[m
[31m-                    if self.peek_state() == '$':[m
[31m-                        if random.randint(0, 1):[m
[31m-                            # ãƒ©ãƒ³ãƒ€ãƒ ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’èã[m
[31m-                            self.push_state('sudo')[m
[31m-                elif re.search("^\\s*enable", message):[m
[31m-                    if self.peek_state() == 'c1':[m
[31m-                        # æ–°ã—ã„çŠ¶æ…‹ã‚’ç©ã‚€[m
[31m-                        self.push_state('c2')[m
[31m-                        # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’èã[m
[31m-                        self.push_state('pass')[m
[31m-                    else:[m
[31m-                        self.channel.send(ENABLE_ERROR)[m
[31m-                #[m
[31m-                # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ¸¡ã™[m
[31m-                self.channel.send(f'{self.prompt}')[m
[31m-                message = ''[m
[31m-            elif self.channel.exit_status_ready():[m
[31m-                print("test Session ended")[m
[31m-                break[m
[31m-            else:[m
[31m-                time.sleep(0.1)[m
[31m-        print("test recv_ready end!")[m
[31m-        return[m
[31m-[m
[31m-[m
[31m-def test_paramater():[m
[31m-    """ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é–¢ä¿‚ã®ãƒ†ã‚¹ãƒˆ """[m
[31m-    # pyttl[m
[31m-    # ä½•ã‚‚ãªã„ã¨ãã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹[m
[31m-    ok_flag = True[m
[31m-    dummy_argv = ["pyttl"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl ãƒ•ã‚¡ã‚¤ãƒ«åãªã—[m
[31m-    ok_flag = True[m
[31m-    dummy_argv = ["pyttl", "-c"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl ãƒ•ã‚¡ã‚¤ãƒ«åãªã—[m
[31m-    ok_flag = True[m
[31m-    dummy_argv = ["pyttl", "-r"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸[m
[31m-    ok_flag = True[m
[31m-    dummy_argv = ["pyttl", "-h"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl ãƒ•ã‚¡ã‚¤ãƒ«åã‚¨ãƒ©ãƒ¼[m
[31m-    ok_flag = False[m
[31m-    dummy_argv = ["pyttl", "aaa"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl result==0ã®ã¨ãã¯ã‚¨ãƒ©ãƒ¼[m
[31m-    ok_flag = False[m
[31m-    dummy_argv = ["pyttl", "-r", "test/0001_ng_test.ttl"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl ãƒã‚§ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã¨ãã¯ã‚¨ãƒ©ãƒ¼ãŒã§ãªã„[m
[31m-    ok_flag = True[m
[31m-    dummy_argv = ["pyttl", "-r", "-c", "test/0001_ng_test.ttl"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl ãƒã‚§ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã¨ãã¯ã‚¨ãƒ©ãƒ¼ãŒã§ãªã„[m
[31m-    ok_flag = True[m
[31m-    dummy_argv = ["pyttl", "-c", "test/0001_ng_test.ttl"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-    #[m
[31m-    # pyttl result==0ã®ã¨ãã§ã‚‚ resultãƒã‚§ãƒƒã‚¯ã—ãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ã¯ã§ãªã„[m
[31m-    ok_flag = True[m
[31m-    dummy_argv = ["pyttl", "test/0001_ng_test.ttl"][m
[31m-    my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-[m
[31m-[m
[31m-class TTLLoader():[m
[31m-    """ TTLã‚’èª­ã¿è¾¼ã‚€ """[m
[31m-[m
[31m-    def __init__(self):[m
[31m-        """ ttl ã®ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ«ãƒ€ """[m
[31m-        self.closeFlag = False[m
[31m-[m
[31m-    def close(self):[m
[31m-        """ çµ‚äº†ã™ã‚‹ """[m
[31m-        self.closeFlag = True[m
[31m-[m
[31m-    def start(self, files=None):[m
[31m-        """ å®Ÿå‡¦ç†ã‚’ã™ã‚‹ """[m
[31m-        #[m
[31m-        serverStarter = ServerStarter(2200)[m
[31m-        # ã‚¹ãƒ¬ãƒƒãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ[m
[31m-        th = threading.Thread(target=serverStarter.start, daemon=True)[m
[31m-        # ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‹å§‹[m
[31m-        th.start()[m
[31m-        #[m
[31m-        # ã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’ä¿æŒã™ã‚‹[m
[31m-        current_folder = os.getcwd()[m
[31m-        #[m
[31m-        target_result = re.search("test$", current_folder)[m
[31m-        if not target_result:[m
[31m-            # ã‚‚ã—ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã§ãªã‹ã£ãŸã‚‰ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•[m
[31m-            test_folder = os.path.join(current_folder, 'test')[m
[31m-            os.chdir(test_folder)[m
[31m-        #[m
[31m-        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚‹[m
[31m-        os.makedirs("build", exist_ok=True)[m
[31m-        #[m
[31m-        try:[m
[31m-            if files is None:[m
[31m-                # ãƒ•ã‚¡ã‚¤ãƒ«ãŒã„ãªã‹ã£ãŸã‚‰ãƒªã‚¹ãƒˆã‚’å–ã£ã¦ãã‚‹[m
[31m-                files_old = os.listdir('.')[m
[31m-                files = [][m
[31m-                for file in files_old:[m
[31m-                    if '.ttl' not in file:[m
[31m-                        continue[m
[31m-                    if 'base.ttl' in file:[m
[31m-                        continue[m
[31m-                    files.append(file)[m
[31m-            #[m
[31m-            for file in files:[m
[31m-                #[m
[31m-                if self.closeFlag:[m
[31m-                    assert 1, "test NG get close event!"[m
[31m-                #[m
[31m-                #[m
[31m-                print()[m
[31m-                ok_flag = False[m
[31m-                if '_ok_' in file:[m
[31m-                    print("test is OK test")[m
[31m-                    ok_flag = True[m
[31m-                else:[m
[31m-                    print("test is NG test")[m
[31m-                    ok_flag = False[m
[31m-                #[m
[31m-                print(f"test file={file}")[m
[31m-                dummy_argv = ["pyttl", "-r", file, 'param1', 'param2', 'param3'][m
[31m-                my_pyttl(ok_flag, dummy_argv, False, False)[m
[31m-                #[m
[31m-                print(f"test file={file} --check")[m
[31m-                dummy_argv = ["pyttl", "-r", "--check", file, 'param1', 'param2', 'param3'][m
[31m-                my_pyttl(ok_flag, dummy_argv, True, False)[m
[31m-                #[m
[31m-                print(f"test file={file} not -r")[m
[31m-                dummy_argv = ["pyttl", file, 'param1', 'param2', 'param3'][m
[31m-                my_pyttl(ok_flag, dummy_argv, False, True)[m
[31m-                #[m
[31m-        finally:[m
[31m-            # ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚‚ã¨ã«æˆ»ã™[m
[31m-            os.chdir(current_folder)[m
[31m-            #[m
[31m-            # ã‚µãƒ¼ãƒã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹[m
[31m-            print("test_load_ttl finally")[m
[31m-            serverStarter.close()[m
[31m-[m
[31m-[m
[31m-def my_pyttl(ok_flag, dummy_argv, check_mode, ignore_result):[m
[31m-    if check_mode and ignore_result:[m
[31m-        assert False, f"Exception (check_mode,ignore_result is True) {ok_flag},{check_mode},{ignore_result}"[m
[31m-    try:[m
[31m-        pyttl(dummy_argv)[m
[31m-    except Exception as e:[m
[31m-        if not ok_flag:[m
[31m-            return  # OKãƒ•ãƒ©ã‚°ãŒFalseãªã‚‰æ­£å¸¸[m
[31m-        else:[m
[31m-            assert False, str(e)  # OKãƒ•ãƒ©ã‚°ã§ãªã„ãªã‚‰ç•°å¸¸[m
[31m-    #[m
[31m-    # æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®å ´åˆã€[m
[31m-    if not ok_flag:[m
[31m-        # OKãƒ•ãƒ©ã‚°ãŒè½ã¡ã¦ã„ã¦ã€ã‹ã¤ã€[m
[31m-        #    checkmode ãŒ Ture ã¾ãŸã¯[m
[31m-        #    ignorresulte_result ãŒ True ãªã‚‰å•é¡Œãªã„[m
[31m-        assert check_mode or ignore_result, f"A Exception ok_flagg is {check_mode}, but not success {ok_flag},{check_mode},{ignore_result}"[m
[31m-[m
[31m-[m
[31m-def test_load_ttl():[m
[31m-    """ ttlãƒ•ã‚¡ã‚¤ãƒ«ãŒå‹•ä½œã™ã‚‹ã‹ç¢ºèªã™ã‚‹ """[m
[31m-    tTLLoader = TTLLoader()[m
[31m-    tTLLoader.start()[m
[31m-    #[m
[31m-[m
[31m-[m
[31m-def main():[m
[31m-    if len(sys.argv) <= 1:[m
[31m-        #[m
[31m-        # ã‚¹ãƒ¬ãƒƒãƒ‰ã ã‘ç«‹ã¦ã‚‹(teratermã§ã®è©•ä¾¡ç”¨)[m
[31m-        serverStarter = ServerStarter(2200)[m
[31m-        #[m
[31m-        # ã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’ä¿æŒã™ã‚‹[m
[31m-        current_folder = os.getcwd()[m
[31m-        #[m
[31m-        # ã‚¹ãƒ¬ãƒƒãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ[m
[31m-        th = threading.Thread(target=serverStarter.start, daemon=True)[m
[31m-        # ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‹å§‹[m
[31m-        th.start()[m
[31m-        #[m
[31m-        try:[m
[31m-            print("test command#", end="")[m
[31m-            while True:[m
[31m-                cmd = input()[m
[31m-                if cmd == "exit":[m
[31m-                    break[m
[31m-                print("test command#", end="")[m
[31m-        except AssertionError as e:[m
[31m-            print(f"AssertionError happen: {e}")[m
[31m-        finally:[m
[31m-            print("test start finally")[m
[31m-            serverStarter.close()[m
[31m-            sys.exit(-1)[m
[31m-        #[m
[31m-        # ã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’å…ƒã«æˆ»ã™[m
[31m-        os.chdir(current_folder)[m
[31m-        #[m
[31m-    else:[m
[31m-        # ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹[m
[31m-        file_name = sys.argv[1][m
[31m-        file_name = pathlib.Path(file_name)[m
[31m-        if not file_name.is_absolute():[m
[31m-            # ç›¸å¯¾ãƒ‘ã‚¹ãªã‚‰çµ¶å¯¾ãƒ‘ã‚¹ã«æ›¸ãæ›ãˆã‚‹[m
[31m-            file_name = pathlib.Path.cwd() / file_name[m
[31m-        file_name = str(file_name)[m
[31m-        tTLLoader = TTLLoader()[m
[31m-        tTLLoader.start(files=[file_name])[m
[31m-        #[m
[31m-[m
[31m-[m
[31m-if __name__ == "__main__":[m
[31m-    main()[m
[31m-#[m
