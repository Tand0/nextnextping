
; 
testlink
if result == 2 then
    closett
endif

command = "%systemroot%"
expandenv str command
strcompare str "/root"
if 0==result then
    assert 1 "this is linux"
    connect '/cmd'
    assert result == 2  "connect OK" error

    ; text
    flushrecv
    command = 'pwd'
    sendln command
    wait command
    result = 0
    wait '#' '>' "$"
    assert result == 3 "wait OK" result error

    ; text
    flushrecv
    command = 'ls'
    sendln command
    wait command
    result = 0
    wait '#' "$" '>'
    assert result == 2 "wait OK" result error

else
    assert 1 "this is windows"

    ; connected
    error=''
    assert 1  "connect start"
    connect '/cmd'
    assert result == 2  "connect OK" error

    ; text
    result = 0
    flushrecv
    sendln 'echo hell-world'
    wait '>' '#' 
    assert result == 1  "wait OK" error

    ; text
    command = 'dir'
    sendln command
    wait command
    result = 0
    wait '#' '>'
    assert result == 2 "wait OK" result error

    recvln
    recvln
    recvln
    pause 1

    ; text
    command = 'dir'
    sendln command
    wait command
    while 1
        result = 0
        wait '<DIR>' '>'
        if result == 0 then
            assert 0 "timeout wait OK" 'title'
            end
        elseif result == 1 then
            continue
        endif
        break
    endwhile

    ; exit
    send 'exit'
    sendln
    pause 2
    disconnect
    testlink
    assert result != 2  "wait OK" error
    ; closett

    pause 1

endif

error=''
result = 1

